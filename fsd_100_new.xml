<ReflexService contextTDR="[errCode]|[detailz]|FLASH DATAMANIA;Status=S01;FSD;pck=[product_product_id];charge=[chargeAppsid];bonus=[bonusAppsid];[nominal];balance=[balance];type=[category];prev-sapc-action=nothing done;sapc-action=[sapc];sapc-prov=[add_p];prev-sapc-pck=[sapcpackages];sapc-pck=[product_sapc_package];subscriptionType=[subscriptionType];discount_id=[discount_id];counter=[counter_counter];counterMatched=[counterMatched];discount_timeframe=[discount_timeframe];timeframe=[timeframe];charge=[charge];bonus=[bonus];home=[location.home];[desc];imei=[imei];postGet_discId=[postGet_discId];verify_product_id=[verify_product_id];postVerify_prodId=[postVerify_prodId];SMS_MGM=[SMS_MGM];command=[command];allowFSDProvSAPC=[allowFSDProvSAPC];QoSProfile=[QoSProfile];allow2ndCharge=[allow2ndCharge]#[2ndCharge.0];pricePlan=[pricePlan];dayToday=[dayToday];existingProfile=[checkProfile.infoSapcPackages];lacci=[getDSP.lac]#[getDSP.ci];subsType=[subsType];isFlu=[isFlu];bonusExtend=[bonusExtend];curCounterDisc=[fpdc_counter];maxCounterDisc=[discount_maxCount];curCounterProd=[fpdc2_counter];maxCounterProd=[product_maxCount];added_task=[chunk_added_task.0];trxid_added_task=[chunk_added_task.4];isSmart=[isSmart];targetNumber=[bonusMsisdn];openINGw=[openINGw];program_name=[get_program_name];isMkios=[isMkios];mkios_trxid=[charge.txid];site=[_PCRF_NAME];prov3GPlus=[syncProv3GPlus];added_task2=[chunk_added_task2.0];isAgent=[isAgent];isBunet=[validateBunet.0];igiCounter=[igiCounter];igiGiMoGeMo=[IGI_giftMoreGetMore];note=[note];counter_inperiod=[res_counter];newImei=[getDSP.newImeiFlag];is3G=[is3G];provOldImei=[syncProvOldImei];formatAddedTask=[format_addedtask];newAdded_task1=[add1];newAdded_task2=[add2];newAdded_task3=[add3];newAdded_task4=[add4];newAdded_task5=[add5];CheckRechargeNeed=[CheckRechargeNeed];renewalType=[product_renewal_type];loopCounter=[loop_count];voucherCode=[voucherCode]#[getCode_status];flagProduct=[get_valTable]#[verify_valTable];channel=[channel];simType=[getDSP.simType];upccProfileCount=[sapcExplode.size];counter_restriction=[fsd_counter_counter_restriction];counter_redeem=[fsd_counter_counter_redeem];elrefgetjson=[elrefgetjson];CheckWhitelistErinTDR=[CheckWhitelistErinTDR];XGETYisReset=[XGETYisReset];month_today=[month_today];month_lastactivation=[month_lastactivation];counterXgetY=[counterXgetY];rule_resetcounter=[jsonrulediscount.reset_counter];XgetYResetExceedThreshold=[isExceedThreshold];resetRestrictCounter=[resetRestrictCounter];cpname_prefix=[CPnamesubs];cpname=[cpname];eligibleGiftA#=[eligibleGift];counter_gift=[_counter_gift];newEndDateGift=[newEndDateGift];countImeiWithoutWhitelist=[counterImeiWithoutWhitelist];counter_imei=[imeiClaim2_counter];allowGetDiscId=[allowGetDiscId];dm=[dm_success];dm_rollback=[dm_rollback_success];SAPCProduct=[product_sapc_package];SAPCDiscount=[discount_sapc_package];ProvAddSapcPackage=[ProvAddSapcPackage];ProvSapcPackage=[ProvSapcPackage];activeDate=[lengthOfStay];LOS=[dblos_days];productSubCategory=[product_sub_category];foundBonusID=[foundBonusID];incrementEndDate=[loop_day_increment_endDate];incrementResetDate=[loop_day_increment_ResetDate];new_end_date=[new_end_date];new_reset_date=[new_reset_date];dateToday=[dateToday];isFirstPurchase=[isFirstPurchase];tcashloop_counter=[tcash_counter];isFirstPurchase=[isFirstPurchase];isStay=[isStay];isIncrementTcashLoop=[isIncrementTcashLoop];isResetTcashLoop=[isResetTcashLoop];tcash_loop_isChangeProd=[tcash_loop_isChangeProd];nominalTcash=[nominalTcash];checkPairingTcash=[checkPairingTcash];injectTcash=[injectTcash];tcashTrxDate=[tcash_trx_date];TcashSequence=[tcash_sequence];getLoc=[getLoc];verifyMGM=[verifyMGM];FAstatus=[fa_status];AddSapcProd=[product_additional_sapc_package];AddSapcDisc=[discount_additional_sapc_package];bonus2=[bonus2];bonus3=[bonus3];bonus4=[bonus4];bonus5=[bonus5];bonus6=[bonus6];bonus7=[bonus7];bonus8=[bonus8];bonus9=[bonus9];actStatusNbp=[actStatusNbp];respPostNbp=[respPostNbp];actStatusNbp2=[actStatusNbp2];respPostNbp2=[respPostNbp2];actStatusNbp3=[actStatusNbp3];respPostNbp3=[respPostNbp3];actStatusNbp4=[actStatusNbp4];respPostNbp4=[respPostNbp4];actStatusNbp5=[actStatusNbp5];respPostNbp5=[respPostNbp5];Note=BR4722" sysErrorResponse="Maaf, permintaan Anda tidak dapat Kami proses. Untuk informasi lebih lanjut, mohon hubungi 133 atau 155" finalResponse="[SMS]" falseResponse="Maaf, permintaan Anda tidak dapat Kami proses. Untuk informasi lebih lanjut, mohon hubungi 133 atau 155 (FSYS)">
   <Actions>
      <!--FSD 100-->
      <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="FSYS||00||00||NOSMS"/>
      <SA class="SyncAssignVariable" var="get_program_name" value=""/>
      <SA class="SyncAssignVariable" var="flagNotHitCallback||nominal||product_volume" value="0||0||0"/>
      <SA class="SyncIf" var="mappingParam" compare="null">
         <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="FSYS||subscriptionTypeNotDefined||pleaseCheckServiceMapping||{dbconfig:fsd.[category].notif.syserror}"/>
         <SA class="SyncBreak"/>
      </SA>
      <!--Mapping param-->
      <SA class="SyncExplode" var="m" input="[mappingParam]" separator="\|"/>
      <SA class="SyncAssignVariable" var="subscriptionType" value="[m.0]"/>
      <SA class="SyncAssignVariable" var="category" value="[m.1]"/>
      <SA class="SyncAssignVariable" var="chnl" value="[m.2]"/>
      <SA class="SyncAssignVariable" var="backup_msg" value="[msg]"/>
      <!--Package set-->
      <SA class="SyncExplode" var="k" input="[keywords]" separator="\s+"/>
      <SA class="SyncIf" var="k.0" compare="">
         <SA class="SyncAssignVariable" var="k.0" value="1000"/>
      </SA>
      <SA class="SyncIf" var="keywords" compare="">
         <SA class="SyncAssignVariable" var="k.0" value="1000"/>
      </SA>
      <SA class="SyncAssignVariable" var="package" value="[k.0]"/>
      <SA class="SyncStringUtility" type="replaceAll" param1="[package]" param2="k" param3="000" var="package"/>
      <SA class="SyncStringUtility" type="replaceAll" param1="[package]" param2="K" param3="000" var="package"/>
      <!--check url notif-->
      <SA class="SyncAssignVariable" var="keyword_info" value=""/>
      <SA class="SyncStringUtility" var="_keyword_info" type="indexOf" param1="[package]" param2="smau"/>
      <SA class="SyncIf" var="_keyword_info" compare="-1" negation="true">
         <SA class="SyncAssignVariable" var="keyword_info" value="[k.1]"/>
      </SA>
      <!--MKIOS request-->
      <SA class="SyncAssignVariable" var="isMkios" value="[mp_mkios]"/>
      <!--MGM-->
      <SA class="SyncTempRequest" option="query" service="MGM" id="checkTempRequestMGM2"/>
      <SA class="SyncSwitch" input="checkTempRequestMGM2">
         <Case code="1">
            <SA class="SyncIf" var="command" compare="HELP">
               <SA class="SyncIf" var="package" compare="[verifyMGM]" negation="true">
                  <SA class="SyncAssignVariable" var="command" value=""/>
               </SA>
            </SA>
            <SA class="SyncTempRequest" service="MGM" option="remove"/>
         </Case>
         <Case code="default">
            <SA class="SyncSwitch" input="isMkios">
               <Case code="TRUE">
                  <SA class="SyncAssignVariable" var="command" value="MKIOS"/>
                  <SA class="SyncAssignVariable" var="notifCommand" value="MKIOS."/>
                  <SA class="SyncAssignVariable" var="confirmMsisdn" value="[msisdn]"/>
                  <SA class="SyncAssignVariable" var="chargeMsisdn" value="[msisdn]"/>
                  <SA class="SyncAssignVariable" var="tempMsisdn" value="[msisdn]"/>
                  <SA class="SyncAssignVariable" var="rewardMsisdn" value="[msisdn]"/>
                  <SA class="SyncStringUtility" var="bonusMsisdn" type="formatMsisdn" param1="[k.1]"/>
                  <SA class="SyncAssignVariable" var="mkios_pin" value="[k.2]"/>
               </Case>
               <Case code="default">
                  <SA class="SyncAssignVariable" var="command" value=""/>
                  <SA class="SyncAssignVariable" var="notifCommand" value=""/>
                  <SA class="SyncAssignVariable" var="confirmMsisdn" value="[msisdn]"/>
                  <SA class="SyncAssignVariable" var="chargeMsisdn" value="[msisdn]"/>
                  <SA class="SyncAssignVariable" var="tempMsisdn" value="[msisdn]"/>
                  <SA class="SyncAssignVariable" var="rewardMsisdn" value="[msisdn]"/>
                  <SA class="SyncAssignVariable" var="bonusMsisdn" value="[msisdn]"/>
               </Case>
            </SA>
         </Case>
      </SA>
      <!--Assign field b_number in TDR log-->
      <SA class="SyncAssignVariable" var="b_number" value="[bonusMsisdn]"/>
      <!--Duplicate Request Prevention-->
      <SA class="SyncTempRequest" option="query" service="FSD" id="checkTempRequest"/>
      <SA class="SyncIf" var="checkTempRequest" compare="1">
         <SA class="SyncAssignVariable" var="errCode||detailz||SMS" value="OK01||alreadyRuningRequest||{dbconfig:fsd.[category].notif.duplicateRequest}"/>
         <SA class="SyncBreak"/>
      </SA>
      <!--Update Temp Request-->
      <SA id="UpdateStateTempService" class="SyncTempRequest" service="FSD" state="1" option="save"/>
      <!--Mapping param Json-->
      <SA class="SyncAssignVariable" var="additional_notif_flu" value=""/>
      <SA class="SyncAssignVariable" var="isFlu" value="[mp_flu]"/>
      <SA class="SyncIf" var="isFlu" compare="1">
         <SA class="SyncDbSingleQuery" dataSource="jdbc/whitelist" varPrefix="check_">SELECT param FROM flu_whitelist WHERE msisdn='[bonusMsisdn]'</SA>
         <SA class="SyncIf" var="check_param" compare="null">
            <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="OK01||notInWhitelist||00||NOSMS"/>
            <SA class="SyncTempRequest" service="FSD" option="remove"/>
            <SA class="SyncBreak"/>
         </SA>
         <SA class="SyncAssignVariable" var="additional_notif_flu" value="{dbconfig:flu.notif.syserror}"/>
      </SA>
      <!--Mapping Param Json for SMART product-->
      <SA class="SyncAssignVariable" var="isSmart" value="[mp_smart]"/>
      <SA class="SyncIf" var="isSmart" compare="1">
         <SA class="SyncTempRequest" option="query" service="SMART" id="checkTempRequestSMART"/>
         <SA class="SyncSwitch" input="checkTempRequestSMART">
            <Case code="1"></Case>
            <Case code="default">
               <SA class="SyncAssignVariable" var="errCode||detailz||SMS" value="OK01||Not Request Yet||{dbconfig:smartCharging.notif.noPackageSelection}"/>
               <SA class="SyncTempRequest" service="FSD" option="remove"/>
               <SA class="SyncIf" var="isFlu" compare="1">
                  <SA class="SyncAssignVariable" var="SMS" value="NOSMS"/>
               </SA>
               <SA class="SyncBreak"/>
            </Case>
         </SA>
      </SA>
      <!--SubsType Check-->
      <SA var="getDSP" class="SyncGetDSP" msisdn="[bonusMsisdn]" DSPTimeout="{dbconfig:reflex.dspReference.timeout}"/>
      <SA class="SyncIf" var="getDSP" compare="1" negation="true">
         <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="FR09||[getDSP]||Failed Get Info From DSP||{dbconfig:fsd.[category].notif.syserror}_-_[additional_notif_flu]"/>
         <SA class="SyncTempRequest" service="FSD" option="remove"/>
         <SA class="SyncIf" var="isFlu" compare="1">
            <SA class="SyncAssignVariable" var="SMS" value="NOSMS"/>
         </SA>
         <SA class="SyncBreak"/>
      </SA>
      <SA class="SyncAssignVariable" var="subsType" value="[getDSP.subsType]"/>
      <SA class="SyncSwitch" input="subsType">
         <Case code="1"></Case>
         <Case code="2">
            <SA class="SyncIf" var="command" compare="" negation="true">
               <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="OK01||postPaidNumber||subsType=[subsType]||{dbconfig:fsd.notif.[notifCommand]notAllowPostpaid}"/>
               <SA class="SyncTempRequest" service="FSD" option="remove"/>
               <SA class="SyncIf" var="isFlu" compare="1">
                  <SA class="SyncAssignVariable" var="SMS" value="NOSMS"/>
               </SA>
               <SA class="SyncBreak"/>
            </SA>
            <SA saveValue="true" id="SMS_sync" class="SyncHttpGet" assertValue="^.*$">http://{dbconfig:flash.smalldeno.postpaid.fa.url}adn=[adn]&amp;msg=[backup_msg]&amp;msisdn=[bonusMsisdn]</SA>
            <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="OK01||passthroughFA||[SMS_sync]||NOSMS"/>
            <SA class="SyncTempRequest" service="FSD" option="remove"/>
            <SA class="SyncIf" var="isFlu" compare="1">
               <SA class="SyncAssignVariable" var="SMS" value="NOSMS"/>
            </SA>
            <SA class="SyncBreak"/>
         </Case>
         <Case code="default">
            <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="OK01||subsTypeNotDefined([getDSP.skey])||subsType not Defined Yet||{dbconfig:fsd.[category].notif.syserror}_-_[additional_notif_flu]"/>
            <SA class="SyncTempRequest" service="FSD" option="remove"/>
            <SA class="SyncIf" var="isFlu" compare="1">
               <SA class="SyncAssignVariable" var="SMS" value="NOSMS"/>
            </SA>
            <SA class="SyncBreak"/>
         </Case>
      </SA>
      <!--Validate lac ci-->
      <SA class="SyncIf" var="isMkios" compare="TRUE">
         <!--SubsType Check-->
         <SA var="getDSP2" class="SyncGetDSP" msisdn="[rewardMsisdn]" DSPTimeout="{dbconfig:reflex.dspReference.timeout}"/>
         <SA class="SyncIf" var="getDSP2" compare="1" negation="true">
            <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="FR09||[getDSP2]||Failed Get Info From DSP||{dbconfig:fsd.[category].notif.syserror}_-_[additional_notif_flu]"/>
            <SA class="SyncTempRequest" service="FSD" option="remove"/>
            <SA class="SyncIf" var="isFlu" compare="1">
               <SA class="SyncAssignVariable" var="SMS" value="NOSMS"/>
            </SA>
            <SA class="SyncBreak"/>
         </SA>
         <SA class="SyncIf" var="getDSP2.isRS" compare="0">
            <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="OK01||notRSNumber||not RS number||{dbconfig:fsd.[category].notif.notRSNumber}"/>
            <SA class="SyncTempRequest" service="FSD" option="remove"/>
            <SA class="SyncIf" var="isFlu" compare="1">
               <SA class="SyncAssignVariable" var="SMS" value="NOSMS"/>
            </SA>
            <SA class="SyncBreak"/>
         </SA>
         <SA class="SyncIf" var="getDSP2.lac" compare="|null|NULL">
            <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="FR09||lacNotFound||lac not Found||{dbconfig:fsd.[category].notif.syserror}_-_[additional_notif_flu]"/>
            <SA class="SyncTempRequest" service="FSD" option="remove"/>
            <SA class="SyncIf" var="isFlu" compare="1">
               <SA class="SyncAssignVariable" var="SMS" value="NOSMS"/>
            </SA>
            <SA class="SyncBreak"/>
         </SA>
         <SA class="SyncAssignVariable" var="mkios_lac" value="[getDSP2.lac]"/>
         <SA class="SyncIf" var="getDSP2.ci" compare="|null|NULL">
            <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="FR09||ciNotFound||ci not Found||{dbconfig:fsd.[category].notif.syserror}_-_[additional_notif_flu]"/>
            <SA class="SyncIf" var="isFlu" compare="1">
               <SA class="SyncAssignVariable" var="SMS" value="NOSMS"/>
            </SA>
            <SA class="SyncTempRequest" service="FSD" option="remove"/>
            <SA class="SyncBreak"/>
         </SA>
         <SA class="SyncAssignVariable" var="mkios_ci" value="[getDSP2.ci]"/>
      </SA>
      <!--Validate lac ci for Recharge-->
      <SA class="SyncIf" var="category" compare="RECHARGE">
         <SA class="SyncIf" var="getDSP.lac" compare="|null|NULL">
            <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="FR09||lacNotFound||lac not Found||{dbconfig:fsd.[category].notif.syserror}_-_[additional_notif_flu]"/>
            <SA class="SyncIf" var="isFlu" compare="1">
               <SA class="SyncAssignVariable" var="SMS" value="NOSMS"/>
            </SA>
            <SA class="SyncTempRequest" service="FSD" option="remove"/>
            <SA class="SyncBreak"/>
         </SA>
         <SA class="SyncAssignVariable" var="recharge_lac" value="[getDSP.lac]"/>
         <SA class="SyncIf" var="getDSP.ci" compare="|null|NULL">
            <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="FR09||ciNotFound||ci not Found||{dbconfig:fsd.[category].notif.syserror}_-_[additional_notif_flu]"/>
            <SA class="SyncIf" var="isFlu" compare="1">
               <SA class="SyncAssignVariable" var="SMS" value="NOSMS"/>
            </SA>
            <SA class="SyncTempRequest" service="FSD" option="remove"/>
            <SA class="SyncBreak"/>
         </SA>
         <SA class="SyncAssignVariable" var="recharge_ci" value="[getDSP.ci]"/>
      </SA>
      <!--Check Restriction with FU-->
      <SA class="SyncDbSingleQuery" dataSource="dbsession" varPrefix="fu_" requestor="[bonusMsisdn]">SELECT msisdn FROM fu_subscription WHERE msisdn='[bonusMsisdn]' AND (category='PrepaidUL' OR category='SNC' OR category='OperaMini' OR category='NokiaUL')</SA>
      <SA class="SyncIf" var="fu_msisdn" compare="null" negation="true">
         <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="OK01||alreadyHasUL||00||{dbconfig:fsd.[category].notif.[notifCommand]alreadyHasUL}"/>
         <SA class="SyncIf" var="isFlu" compare="1">
            <SA class="SyncAssignVariable" var="SMS" value="NOSMS"/>
         </SA>
         <SA class="SyncTempRequest" service="FSD" option="remove"/>
         <SA class="SyncBreak"/>
      </SA>
      <!--Check Restriction with BB Extreme-->
      <SA class="SyncDbSingleQuery" dataSource="dbsession" varPrefix="bb_" requestor="[bonusMsisdn]">SELECT msisdn FROM bb_subscription WHERE msisdn = '[bonusMsisdn]' AND (product_id = 555 OR product_id = 100931)</SA>
      <SA class="SyncIf" var="bb_msisdn" compare="null" negation="true">
         <SA class="SyncAssignVariable" var="errCode||detailz||SMS||desc" value="OK01||bbExActive||{dbconfig:fsd.[category].notif.[notifCommand]bbExActive}||00"/>
         <SA class="SyncTempRequest" service="FSD" option="remove"/>
         <SA class="SyncIf" var="isFlu" compare="1">
            <SA class="SyncAssignVariable" var="SMS" value="NOSMS"/>
         </SA>
         <SA class="SyncBreak"/>
      </SA>
      <!--Check Existing Subscription-->
      <SA class="SyncAssignVariable" var="purchase_type" value="null"/>
      <SA class="SyncSwitch" input="category">
         <case code="RECHARGE">
            <!--<SA class="SyncDbSingleQuery" dataSource="dbsession" varPrefix="_" requestor="[bonusMsisdn]">
					SELECT msisdn, product_id, discount_id, purchase_type FROM fsd_subscription WHERE msisdn='[bonusMsisdn]' AND category='[category]'
				</SA>
				<SA class="SyncIf" var="_msisdn" compare="null" negation="true">
					<SA class="SyncAssignVariable" var="errCode||detailz||SMS||desc" value="OK01||alreadyRecharge||{dbconfig:fsd.[category].notif.[notifCommand]alreadyRecharge}||00" />
					<SA class="SyncTempRequest" service="FSD" option="remove"/>
					<SA class="SyncIf" var="isFlu" compare="1">
						<SA class="SyncAssignVariable" var="SMS" value="NOSMS" />
					</SA>
					<SA class="SyncBreak"/>
				</SA>-->
         </case>
         <case code="default">
            <SA class="SyncDbSingleQuery" dataSource="dbsession" varPrefix="_" requestor="[bonusMsisdn]">SELECT msisdn, product_id, discount_id, purchase_type FROM fsd_subscription WHERE msisdn='[bonusMsisdn]' AND category='[category]'</SA>
            <SA class="SyncIf" var="_msisdn" compare="null" negation="true">
               <SA class="SyncStringUtility" var="purchase_type" type="touppercase" param1="[_purchase_type]"/>
            </SA>
         </case>
      </SA>
      <!--Define Subscription Type-->
      <SA class="SyncAssignVariable" var="tambahanSQL" value="AND 1"/>
      <SA class="SyncStringUtility" var="subscriptionType" type="touppercase" param1="[subscriptionType]"/>
      <SA class="SyncSwitch" input="subscriptionType">
         <case code="SUB">
            <SA class="SyncAssignVariable" var="tambahanSQL" value="AND auto_renewal='1'"/>
         </case>
      </SA>
      <!--Get Product-->
      <SA class="SyncGetPrepaidType" var="prepaidType" msisdn="[bonusMsisdn]"/>
      <SA class="SyncIf" var="prepaidType" compare="|null|NULL">
         <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="FR09||prepaidType=[prepaidType]||Failed Get PrepaidType||{dbconfig:fsd.notif.syserror}"/>
         <SA class="SyncTempRequest" service="FSD" option="remove"/>
         <SA class="SyncBreak"/>
      </SA>
      <SA class="SyncDbSingleQuery" dataSource="jdbc/whitelist" varPrefix="product_">SELECT *, bonus_appsid_[prepaidType] AS bonus_appsid FROM fsd_product WHERE prepaid_type LIKE '%|[prepaidType]|%' AND category='[category]' AND package_keyword = '[package]' [tambahanSQL]</SA>
      <SA class="SyncIf" var="product_product_id" compare="null">
         <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="OK01||productNotAvailable||[prepaidType]-[product_product_id]-[package]||{dbconfig:fsd.[category].notif.[notifCommand]productNotAvailable}"/>
         <SA class="SyncIf" var="isFlu" compare="1">
            <SA class="SyncAssignVariable" var="SMS" value="NOSMS"/>
         </SA>
         <SA class="SyncTempRequest" service="FSD" option="remove"/>
         <SA class="SyncBreak"/>
      </SA>
      <!--Validate Channel-->
      <SA class="SyncAssignVariable" var="forceProduct" value="FALSE"/>
      <SA class="SyncIf" var="product_channel_auth" compare="|null|NULL" negation="true">
         <SA class="JsonParse" var="jsonChannel" input="[product_channel_auth]"/>
         <SA class="SyncSwitch" input="jsonChannel.type">
            <case code="whitelist">
               <SA class="SyncIf" var="channel" compare="[jsonChannel.list]" negation="true">
                  <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="OK01||channelNotEligibleForProduct||[product_product_id]-[jsonChannel.list]||{dbconfig:fsd.[category].notif.[notifCommand]productNotAvailable}"/>
                  <SA class="SyncIf" var="isFlu" compare="1">
                     <SA class="SyncAssignVariable" var="SMS" value="NOSMS"/>
                  </SA>
                  <SA class="SyncTempRequest" service="FSD" option="remove"/>
                  <SA class="SyncBreak"/>
               </SA>
            </case>
            <case code="blacklist">
               <SA class="SyncIf" var="channel" compare="[jsonChannel.list]">
                  <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="OK01||channelNotEligibleForProduct||[product_product_id]-[jsonChannel.list]||{dbconfig:fsd.[category].notif.[notifCommand]productNotAvailable}"/>
                  <SA class="SyncIf" var="isFlu" compare="1">
                     <SA class="SyncAssignVariable" var="SMS" value="NOSMS"/>
                  </SA>
                  <SA class="SyncTempRequest" service="FSD" option="remove"/>
                  <SA class="SyncBreak"/>
               </SA>
            </case>
         </SA>
      </SA>
      <!--Check loopcircle product-->
      <SA class="SyncStringUtility" var="product_renewal_type" type="tolowercase" param1="[product_renewal_type]"/>
      <SA class="SyncIf" var="product_renewal_type" compare="circle">
         <SA class="SyncDbSingleQuery" dataSource="jdbc/whitelist" varPrefix="loop_">SELECT * FROM loopcircle_msisdn WHERE msisdn='[msisdn]'</SA>
         <SA class="SyncIf" var="loop_msisdn" compare="|null|NULL" negation="true">
            <SA class="SyncAssignVariable" var="daysEligible" value="{dbconfig:loopcircle.eligibleSubDays}"/>
            <SA id="valNotEligible" class="SyncAssertExpression" var="loop_count" operator="&lt;" value="[daysEligible]" saveValue="true"/>
            <SA class="SyncIf" var="valNotEligible" compare="1">
               <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="OK01||MsisdnNotAllowed||lowerThanEligibleDays||{dbconfig:loopcircle.notif.NotEnoughCounterPOI}"/>
               <SA class="SyncTempRequest" service="FSD" option="remove"/>
               <SA class="SyncBreak"/>
            </SA>
         </SA>
      </SA>
      <!--IGI-Bunet Check-->
      <SA class="SyncAssignVariable" var="IGI_giftMoreGetMore" value="FALSE"/>
      <SA class="SyncAssignVariable" var="IGI_GiMoGeMo_NotifSuccess" value=""/>
      <SA class="SyncIf" var="product_eligible_reference" compare="|null|NULL" negation="true">
         <SA class="JsonParse" var="json" input="[product_eligible_reference]"/>
         <SA class="SyncIf" var="json.type" compare="oms">
            <SA saveValue="true" id="validateBunet" class="SyncHttpGet" assertValue="^.*$">{dbconfig:mgm.param.isBunet.url}&amp;p_msisdn=[chargeMsisdn]&amp;p_bnumber=[bonusMsisdn]&amp;p_appsid=[product_product_id]</SA>
            <SA class="SyncIf" var="validateBunet" compare="FAILED|HTTP_FAILED">
               <SA saveValue="true" id="validateBunet" class="SyncHttpGet" assertValue="^.*$">{dbconfig:mgm.param.isBunet.url}&amp;p_msisdn=[chargeMsisdn]&amp;p_bnumber=[bonusMsisdn]&amp;p_appsid=[product_product_id]</SA>
               <SA class="SyncIf" var="validateBunet" compare="FAILED|HTTP_FAILED">
                  <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="FR07||failed query OMS||failed||{dbconfig:fsd.[category].notif.syserror}_-_[additional_notif_flu]"/>
                  <SA class="SyncIf" var="isFlu" compare="1">
                     <SA class="SyncAssignVariable" var="SMS" value="NOSMS"/>
                  </SA>
                  <SA class="SyncTempRequest" service="FSD" option="remove"/>
                  <SA class="SyncBreak"/>
               </SA>
            </SA>
            <SA id="ExplodeChunk" class="SyncExplode" separator="\|" var="validateBunet" input="[validateBunet]"/>
            <SA class="SyncIf" var="validateBunet.0" compare="NOK" negation="true">
               <SA class="SyncDbSingleQuery" dataSource="jdbc/whitelist" varPrefix="product_">SELECT *, bonus_appsid_[prepaidType] AS bonus_appsid FROM fsd_product WHERE prepaid_type LIKE '%|[prepaidType]|%' AND category='[category]' AND package_keyword = '[json.igiPrefix][package]' [tambahanSQL]</SA>
               <SA class="SyncIf" var="product_product_id" compare="null">
                  <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="OK01||productNotAvailable||[prepaidType]-[product_product_id]-[package]||{dbconfig:fsd.[category].notif.[notifCommand]productNotAvailable}"/>
                  <SA class="SyncIf" var="isFlu" compare="1">
                     <SA class="SyncAssignVariable" var="SMS" value="NOSMS"/>
                  </SA>
                  <SA class="SyncTempRequest" service="FSD" option="remove"/>
                  <SA class="SyncBreak"/>
               </SA>
               <SA saveValue="true" id="validateBunet2" class="SyncHttpGet" assertValue="^.*$">{dbconfig:mgm.param.isBunet.url}&amp;p_msisdn=[chargeMsisdn]&amp;p_bnumber=[bonusMsisdn]&amp;p_appsid=[product_product_id]</SA>
               <SA class="SyncIf" var="validateBunet2" compare="FAILED|HTTP_FAILED">
                  <SA saveValue="true" id="validateBunet2" class="SyncHttpGet" assertValue="^.*$">{dbconfig:mgm.param.isBunet.url}&amp;p_msisdn=[chargeMsisdn]&amp;p_bnumber=[bonusMsisdn]&amp;p_appsid=[product_product_id]</SA>
                  <SA class="SyncIf" var="validateBunet2" compare="FAILED|HTTP_FAILED">
                     <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="FR07||failed query OMS||failed||{dbconfig:fsd.[category].notif.syserror}_-_[additional_notif_flu]"/>
                     <SA class="SyncIf" var="isFlu" compare="1">
                        <SA class="SyncAssignVariable" var="SMS" value="NOSMS"/>
                     </SA>
                     <SA class="SyncTempRequest" service="FSD" option="remove"/>
                     <SA class="SyncBreak"/>
                  </SA>
               </SA>
               <SA class="SyncIf" var="isAgent" compare="TRUE">
                  <!--IGI Gift Counter-->
                  <SA class="JsonParse" var="json" input="[product_eligible_reference]"/>
                  <SA class="SyncIf" var="validateBunet2.1" compare="|0|null|NULL">
                     <SA class="SyncAssignVariable" var="igiCounter" value="1"/>
                  </SA>
                  <SA class="SyncIf" var="validateBunet2.1" compare="|0|null|NULL" negation="true">
                     <SA Input2="1" Input1="[validateBunet2.1]" Operator="+" Msisdn="" id="igiCounter" saveValue="True" Information="" class="Arithmetic"/>
                  </SA>
                  <SA class="SyncIf" var="json.igi_target" compare="|null|NULL" negation="true">
                     <SA class="SyncIf" var="igiCounter" compare="[json.igi_target]">
                        <SA class="SyncAssignVariable" var="IGI_giftMoreGetMore" value="TRUE"/>
                        <SA class="SyncAssignVariable" var="bonus_volume" value="[json.igi_bonus_volume]"/>
                        <SA class="SyncAssignVariable" var="IGI_GiMoGeMo_NotifSuccess" value="{dbconfig:fsd.IGI.giftMoreGetMore.notif.success}"/>
                     </SA>
                  </SA>
               </SA>
            </SA>
         </SA>
      </SA>
      <!--JsonParsing for flag column-->
      <SA class="SyncIf" var="product_flag" compare="null" negation="true">
         <SA class="JsonParse" var="jsonflag" input="[product_flag]"/>
         <SA class="SyncAssignVariable" var="bestmatch" value="[jsonflag.bestmatch]"/>
      </SA>
      <!--Validate Product Date Range-->
      <SA class="DateRangeValidation" id="date_range" saveValue="true" TimeStart="[product_start_date]" TimeEnd="[product_end_date]"/>
      <SA class="SyncIf" var="date_range" compare="1" negation="true">
         <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="OK01||outsideDateRange||[product_start_date] sd [product_end_date]||{dbconfig:fsd.[category].notif.[notifCommand]outsideDateRange}"/>
         <SA class="SyncIf" var="isFlu" compare="1">
            <SA class="SyncAssignVariable" var="SMS" value="NOSMS"/>
         </SA>
         <SA class="SyncTempRequest" service="FSD" option="remove"/>
         <SA class="SyncBreak"/>
      </SA>
      <!--Validate Product Time Frame-->
      <SA class="SyncIf" var="product_timeframe" compare="null|ALL" negation="true">
         <SA class="SyncExplode" var="z" input="[product_timeframe]" separator="-"/>
         <SA class="TimeFrameValidation" newModel="1" TimeStart="[z.0]" TimeEnd="[z.1]" TimeZone="0" id="producttimeframe"/>
         <SA class="SyncIf" var="producttimeframe" compare="0">
            <SA id="SubstringMessage" class="SyncSubstring" var="timeframe_start" input="[z.0]" start="0" stop="5"/>
            <SA id="SubstringMessage" class="SyncSubstring" var="timeframe_end" input="[z.1]" start="0" stop="5"/>
            <SA class="SyncAssignVariable" var="time_frame" value="[timeframe_start]-[timeframe_end]"/>
            <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="OK01||productTimeframeViolated||[product_timeframe]-[producttimeframe]-[category]||{dbconfig:fsd.[category].notif.[notifCommand]productTimeframeViolated}"/>
            <SA class="SyncIf" var="isFlu" compare="1">
               <SA class="SyncAssignVariable" var="SMS" value="NOSMS"/>
            </SA>
            <SA class="SyncTempRequest" service="FSD" option="remove"/>
            <SA class="SyncBreak"/>
         </SA>
      </SA>
      <!--Validate MGM Request-->
      <SA class="SyncIf" var="command" compare="GIFT|HELP|ASK">
         <SA class="SyncDbSingleQuery" dataSource="jdbc/reflex" varPrefix="_">SELECT point FROM mgm_mapping_point WHERE command = '[command]' AND product_id = '[product_product_id]'</SA>
         <SA class="SyncIf" var="_point" compare="null">
            <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="OK01||not allow GIFT or HELP or ASK product||00||{dbconfig:mgm.notif.[notifCommand]notAllowProduct}"/>
            <SA class="SyncIf" var="isFlu" compare="1">
               <SA class="SyncAssignVariable" var="SMS" value="NOSMS"/>
            </SA>
            <SA class="SyncTempRequest" service="FSD" option="remove"/>
            <SA class="SyncBreak"/>
         </SA>
         <SA class="SyncIf" var="command" compare="GIFT">
            <!--SubsType Check a#-->
            <SA var="getDSPanumber" class="SyncGetDSP" msisdn="[msisdn]" DSPTimeout="{dbconfig:reflex.dspReference.timeout}"/>
            <SA class="SyncIf" var="getDSPanumber" compare="1" negation="true">
               <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="FR09||[getDSPanumber]||Failed Get Info From DSP anumber GIFT||{dbconfig:fsd.[category].notif.syserror}_-_[additional_notif_flu]"/>
               <SA class="SyncTempRequest" service="FSD" option="remove"/>
               <SA class="SyncIf" var="isFlu" compare="1">
                  <SA class="SyncAssignVariable" var="SMS" value="NOSMS"/>
               </SA>
               <SA class="SyncBreak"/>
            </SA>
            <SA class="SyncAssignVariable" var="subsTypeanumber" value="[getDSPanumber.subsType]"/>
            <SA class="SyncSwitch" input="subsTypeanumber">
               <Case code="1">
                  <SA class="SyncAssignVariable" var="limitGift" value="{dbconfig:fsd.limitgift.prepaid.anumber}"/>
                  <SA class="SyncIf" var="limitGift" compare="0" negation="true">
                     <SA class="SyncAssignVariable" var="_counter_gift" value="1"/>
                     <SA class="SyncAssignVariable" var="giftPrepaid" value="TRUE"/>
                     <SA class="SyncAssignVariable" var="giftproduct" value="GIFT_[msisdn]"/>
                     <SA class="SyncDbSingleQuery" dataSource="dbsession" varPrefix="_" requestor="[msisdn]">SELECT (counter_gift+1) as counter_gift , end_date_gift FROM fsd_counter2 WHERE msisdn=[msisdn] AND product_id='[giftproduct]'</SA>
                     <SA class="SyncIf" var="_end_date_gift" compare="|null|NULL" negation="true">
                        <SA id="exceedLimitGift" class="SyncAssertExpression" var="_counter_gift" operator=">" value="[limitGift]" saveValue="true"/>
                        <SA class="SyncIf" var="exceedLimitGift" compare="1">
                           <SA class="DateUtility" id="dateToday" saveValue="true" Option="Today" Param2="yyyy-MM-dd"/>
                           <SA id="dayCompareGift" class="DateUtility" Option="is_expired2" Param3="[_end_date_gift]" Param5="[dateToday]" saveValue="true"/>
                           <SA class="SyncSwitch" input="dayCompareGift">
                              <case code="1">
                                 <SA class="SyncAssignVariable" var="_counter_gift" value="1"/>
                              </case>
                              <case code="default">
                                 <SA class="SyncAssignVariable" var="eligibleGift" value="FALSE"/>
                                 <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="OK01||AnumberNotEligibleGift||AnumberNotEligibleGift||{dbconfig:fsd.limitgift.prepaid.anumber.notif}"/>
                                 <SA class="SyncTempRequest" service="FSD" option="remove"/>
                                 <SA class="SyncBreak"/>
                              </case>
                           </SA>
                        </SA>
                     </SA>
                     <SA id="newEndDateGift" class="DateUtility" Option="LastDateOfCurrentMonth" Param2="yyyy-MM-dd" saveValue="true"/>
                     <SA class="SyncAssignVariable" var="eligibleGift" value="TRUE"/>
                  </SA>
               </Case>
               <Case code="0|2">
                  <!--no action as of today-->
               </Case>
               <Case code="default">
                  <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="OK01||subsTypeNotDefinedAnumber([getDSPanumber.skey])||subsType not Defined Yet Anumber||{dbconfig:fsd.[category].notif.syserror}_-_[additional_notif_flu]"/>
                  <SA class="SyncTempRequest" service="FSD" option="remove"/>
                  <SA class="SyncIf" var="isFlu" compare="1">
                     <SA class="SyncAssignVariable" var="SMS" value="NOSMS"/>
                  </SA>
                  <SA class="SyncBreak"/>
               </Case>
            </SA>
         </SA>
      </SA>
      <!--Validate Bundling Group-->
      <SA class="SyncAssignVariable" var="list_view_new" value="NULL"/>
      <SA class="SyncAssignVariable" var="list_view_old" value="NULL"/>
      <SA class="SyncDbSingleQuery" dataSource="jdbc/reflex" varPrefix="_">SELECT group_bundling FROM group_bundling_product WHERE product_id = '[product_product_id]'</SA>
      <SA class="SyncIf" var="_group_bundling" compare="|null|NULL" negation="true">
         <SA class="SyncDbIteratorQuery" varPrefix="list_" dataSource="jdbc/reflex" sql="SELECT product_id, category FROM group_bundling_product WHERE group_bundling = '[_group_bundling]'">
            <SA class="SyncDbSingleQuery" dataSource="dbsession" requestor="[bonusMsisdn]" varPrefix="item_">SELECT product_id FROM [list_category]_subscription_counter WHERE msisdn = '[bonusMsisdn]' AND product_id = '[list_product_id]'</SA>
            <SA class="SyncSwitch" input="item_product_id">
               <case code="|null|NULL">
                  <SA class="SyncIf" var="list_view_new" compare="|null|NULL">
                     <SA class="SyncAssignVariable" var="list_view_new" value="[list_product_id]"/>
                  </SA>
                  <SA class="SyncIf" var="list_view_new" compare="|null|NULL" negation="true">
                     <SA class="SyncAssignVariable" var="list_view_new" value="[list_product_id]|[list_view_new]"/>
                  </SA>
               </case>
               <case code="default">
                  <SA class="SyncIf" var="list_view_old" compare="|null|NULL">
                     <SA class="SyncAssignVariable" var="list_view_old" value="[item_product_id]"/>
                  </SA>
                  <SA class="SyncIf" var="list_view_old" compare="|null|NULL" negation="true">
                     <SA class="SyncAssignVariable" var="list_view_old" value="[item_product_id]|[list_view_old]"/>
                  </SA>
               </case>
            </SA>
         </SA>
         <SA class="SyncAssignVariable" var="list_view_final" value="[list_view_new]"/>
         <SA class="SyncIf" var="list_view_old" compare="|null|NULL" negation="true">
            <SA class="SyncAssignVariable" var="list_view_final" value="[list_view_old]"/>
         </SA>
         <!--Validate Product Id Request With List-->
         <SA class="SyncIf" var="product_product_id" compare="[list_view_final]" negation="true">
            <!--Not eligible-->
            <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="OK01||notEligibleBundlingGroup||notEligibleBundlingGroup||{dbconfig:fsd.[category].notif.[notifCommand]notEligibleBundlingGroup}"/>
            <SA class="SyncIf" var="isFlu" compare="1">
               <SA class="SyncAssignVariable" var="SMS" value="NOSMS"/>
            </SA>
            <SA class="SyncTempRequest" service="FSD" option="remove"/>
            <SA class="SyncBreak"/>
         </SA>
      </SA>
      <!--Validate Price Plan-->
      <SA class="SyncAssignVariable" var="pricePlan" value="NULL"/>
      <SA class="SyncIf" var="product_check_priceplan_product" compare="1">
         <SA class="SyncIf" var="product_pricePlan" compare="ALL" negation="true">
            <SA class="INPlugin" id="pricePlan" saveValue="true" Type="get" bNumber="3636" bMsisdn="[bonusMsisdn]" InpluginTimeout="{dbconfig:InpluginTimeout}" InpluginAppsid="{dbconfig:bonus.getChargingMode.appsid}" InpluginPwd="{dbconfig:bonus.getChargingMode.password}" InpluginOrderid="GetChmod" InpluginCpname="Reflex"/>
            <SA class="SyncIf" var="pricePlan" compare="REJECT|null|FAILED|HTTP-FAILED">
               <SA class="SyncIf" var="pricePlan" compare="REJECT|null">
                  <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="FI06||RejectGetPricePlan||[pricePlan]||{dbconfig:fsd.[category].notif.syserror}_-_[additional_notif_flu]"/>
               </SA>
               <SA class="SyncIf" var="pricePlan" compare="FAILED|HTTP-FAILED">
                  <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="FI06||TOGetPricePlan||[pricePlan]||{dbconfig:fsd.[category].notif.syserror}_-_[additional_notif_flu]"/>
               </SA>
               <SA class="SyncIf" var="isFlu" compare="1">
                  <SA class="SyncAssignVariable" var="SMS" value="NOSMS"/>
               </SA>
               <SA class="SyncTempRequest" service="FSD" option="remove"/>
               <SA class="SyncBreak"/>
            </SA>
            <SA class="SyncIf" var="pricePlan" compare="[product_pricePlan]" negation="true">
               <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="OK01||PricePlanNotMatched||[pricePlan]-[product_pricePlan]||{dbconfig:fsd.[category].notif.[notifCommand]notallowPriceplan}"/>
               <SA class="SyncIf" var="isFlu" compare="1">
                  <SA class="SyncAssignVariable" var="SMS" value="NOSMS"/>
               </SA>
               <SA class="SyncTempRequest" service="FSD" option="remove"/>
               <SA class="SyncBreak"/>
            </SA>
         </SA>
      </SA>
      <!--Validate Day today-->
      <SA class="DateUtility" Option="Today" Param2="EEE" id="dayToday"/>
      <SA class="SyncIf" var="product_eligible_days" compare="ALL" negation="true">
         <SA class="SyncIf" var="dayToday" compare="[product_eligible_days]" negation="true">
            <SA class="SyncStringUtility" type="replaceAll" param1="[product_eligible_days]" param2="\|" param3="#" var="product_eligible_days"/>
            <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="OK01||DaysNotMatched||[dayToday]-[product_eligible_days]||{dbconfig:fsd.[category].notif.notallowDays}"/>
            <SA class="SyncIf" var="isFlu" compare="1">
               <SA class="SyncAssignVariable" var="SMS" value="NOSMS"/>
            </SA>
            <SA class="SyncTempRequest" service="FSD" option="remove"/>
            <SA class="SyncBreak"/>
         </SA>
      </SA>
      <!--Validate Eligible Reference-->
      <SA class="SyncAssignVariable" var="forceProduct" value="FALSE"/>
      <SA class="SyncIf" var="product_eligible_reference" compare="|null|NULL" negation="true">
         <SA class="JsonParse" var="json" input="[product_eligible_reference]"/>
         <SA class="SyncSwitch" input="json.type">
            <case code="jdbc">
               <SA class="SyncDbSingleQuery" dataSource="[json.datasource]" varPrefix="eligible_">[json.sql]</SA>
               <SA class="SyncIf" var="eligible_msisdn" compare="null">
                  <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="OK01||notEligibleForProduct||[product_product_id]-[json.sql]||{dbconfig:fsd.notif.[notifCommand]notEligibleForProduct}"/>
                  <SA class="SyncIf" var="isFlu" compare="1">
                     <SA class="SyncAssignVariable" var="SMS" value="NOSMS"/>
                  </SA>
                  <SA class="SyncTempRequest" service="FSD" option="remove"/>
                  <SA class="SyncBreak"/>
               </SA>
            </case>
            <case code="jdbc_negation">
               <SA class="SyncDbSingleQuery" dataSource="[json.datasource]" varPrefix="eligible_">[json.sql]</SA>
               <SA class="SyncIf" var="eligible_msisdn" compare="null" negation="true">
                  <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="OK01||notEligibleForProductBlackList||[product_product_id]-[json.sql]||{dbconfig:fsd.notif.[notifCommand]notEligibleForProduct}"/>
                  <SA class="SyncIf" var="isFlu" compare="1">
                     <SA class="SyncAssignVariable" var="SMS" value="NOSMS"/>
                  </SA>
                  <SA class="SyncTempRequest" service="FSD" option="remove"/>
                  <SA class="SyncBreak"/>
               </SA>
            </case>
            <case code="ocp">
               <SA saveValue="true" id="sms_sync" class="SyncHttpGet" assertValue="^.*$">http://{dbconfig:flash.smalldeno.ocp.url}/cms/api_student_com?p_msisdn=[bonusMsisdn]</SA>
               <SA class="SyncIf" var="sms_sync" compare="FAILED|HTTP_FAILED|ERROR_INFO_RETURN_VALUE|null">
                  <SA saveValue="true" id="sms_sync" class="SyncHttpGet" assertValue="^.*$">http://{dbconfig:flash.smalldeno.ocp.url}/cms/api_student_com?p_msisdn=[bonusMsisdn]</SA>
                  <SA class="SyncIf" var="sms_sync" compare="FAILED|HTTP_FAILED|ERROR_INFO_RETURN_VALUE|null">
                     <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="FX03||[sms_sync]||{dbconfig:flash.smalldeno.Description.E41}||{dbconfig:flash.smalldeno.ReplyMsg.EGeneral}_-_[additional_notif_flu]"/>
                     <SA class="SyncIf" var="isFlu" compare="1">
                        <SA class="SyncAssignVariable" var="SMS" value="NOSMS"/>
                        <SA class="SyncTempRequest" service="FSD" option="remove"/>
                        <SA class="SyncBreak"/>
                     </SA>
                  </SA>
                  <SA class="SyncIf" var="sms_sync" compare="[bonusMsisdn] 0">
                     <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="OK01||notCampusCommunity||{dbconfig:flash.smalldeno.Description.E18}||{dbconfig:flash.smalldeno.ReplyMsg.[notifCommand]FC.ENotCPMember}_-_[additional_notif_flu]"/>
                     <SA class="SyncIf" var="isFlu" compare="1">
                        <SA class="SyncAssignVariable" var="SMS" value="NOSMS"/>
                     </SA>
                     <SA class="SyncTempRequest" service="FSD" option="remove"/>
                     <SA class="SyncBreak"/>
                  </SA>
               </SA>
            </case>
            <case code="usim">
               <SA id="viewHSS" class="SyncHttpGet" saveValue="true" assertValue="" timeout="12000">{dbconfig:reflex.dspViewHSS.url}&amp;msisdn=[bonusMsisdn]&amp;trx_id=[txid]&amp;show=EPS</SA>
               <SA id="ExplodeChunk" class="SyncExplode" separator="\:" var="viewEPS" input="[viewHSS]"/>
               <SA class="SyncIf" var="viewEPS.0" compare="RO" negation="true">
                  <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="FR09||failed view HSS||[viewHSS]||{dbconfig:fsd.[category].notif.syserror}_-_[additional_notif_flu]"/>
                  <SA class="SyncIf" var="isFlu" compare="1">
                     <SA class="SyncAssignVariable" var="SMS" value="NOSMS"/>
                  </SA>
                  <SA class="SyncTempRequest" service="FSD" option="remove"/>
                  <SA class="SyncBreak"/>
               </SA>
               <SA class="SyncSwitch" input="viewEPS.1">
                  <case code="PROV">
                     <!--<SA class="SyncSwitch" input="getDSP.simType">
								<case code="SIM">
									<SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="OK01||cardType SIM||cardType not allow||{dbconfig:fsd.[category].notif.cardTypeNotAllow}" />
									<SA class="SyncIf" var="isFlu" compare="1">
										<SA class="SyncAssignVariable" var="SMS" value="NOSMS" />
									</SA>
									<SA class="SyncTempRequest" service="FSD" option="remove"/>
									<SA class="SyncBreak"/>
								</case>
								<case code="USIM">-->
                     <SA class="SyncIf" var="getDSP.skey" compare="|null|NULL">
                        <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="FR09||skeyNotFound||skey Not Found||{dbconfig:fsd.[category].notif.syserror}_-_[additional_notif_flu]"/>
                        <SA class="SyncIf" var="isFlu" compare="1">
                           <SA class="SyncAssignVariable" var="SMS" value="NOSMS"/>
                        </SA>
                        <SA class="SyncTempRequest" service="FSD" option="remove"/>
                        <SA class="SyncBreak"/>
                     </SA>
                     <SA class="SyncIf" var="getDSP.cardType" compare="|null|NULL">
                        <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="FSYS||cardTypeNotDefine||skey [getDSP.cardType] Not Mapping Yet||{dbconfig:fsd.[category].notif.syserror}_-_[additional_notif_flu]"/>
                        <SA class="SyncIf" var="isFlu" compare="1">
                           <SA class="SyncAssignVariable" var="SMS" value="NOSMS"/>
                        </SA>
                        <SA class="SyncTempRequest" service="FSD" option="remove"/>
                        <SA class="SyncBreak"/>
                     </SA>
                     <SA class="SyncAssignVariable" var="qosTPLID" value="{dbconfig:fsd.[getDSP.cardType].qosTPLID}"/>
                     <SA class="SyncAssignVariable" var="prov3GPlus" value="TRUE"/>
                     <!--</case>
								<case code="default">
									<SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="FR09||cardTypeNotFound||cardType not Found||{dbconfig:fsd.[category].notif.syserror}_-_[additional_notif_flu]" />
									<SA class="SyncIf" var="isFlu" compare="1">
										<SA class="SyncAssignVariable" var="SMS" value="NOSMS" />
									</SA>
									<SA class="SyncTempRequest" service="FSD" option="remove"/>
									<SA class="SyncBreak"/>
								</case>
							</SA>-->
                  </case>
                  <case code="default">
                     <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="OK01||[viewEPS.1]||not have EPS profile||{dbconfig:fsd.[category].notif.notHaveEPSProfile}"/>
                     <SA class="SyncIf" var="isFlu" compare="1">
                        <SA class="SyncAssignVariable" var="SMS" value="NOSMS"/>
                     </SA>
                     <SA class="SyncTempRequest" service="FSD" option="remove"/>
                     <SA class="SyncBreak"/>
                  </case>
               </SA>
            </case>
            <case code="usim_only">
               <SA class="SyncSwitch" input="getDSP.simType">
                  <case code="SIM">
                     <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="OK01||cardType SIM||cardType not allow||{dbconfig:fsd.[category].notif.cardTypeNotAllow}"/>
                     <SA class="SyncIf" var="isFlu" compare="1">
                        <SA class="SyncAssignVariable" var="SMS" value="NOSMS"/>
                     </SA>
                     <SA class="SyncTempRequest" service="FSD" option="remove"/>
                     <SA class="SyncBreak"/>
                  </case>
                  <case code="USIM">
                     <SA class="SyncIf" var="getDSP.skey" compare="|null|NULL">
                        <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="FR09||skeyNotFound||skey Not Found||{dbconfig:fsd.[category].notif.syserror}_-_[additional_notif_flu]"/>
                        <SA class="SyncIf" var="isFlu" compare="1">
                           <SA class="SyncAssignVariable" var="SMS" value="NOSMS"/>
                        </SA>
                        <SA class="SyncTempRequest" service="FSD" option="remove"/>
                        <SA class="SyncBreak"/>
                     </SA>
                     <SA class="SyncIf" var="getDSP.cardType" compare="|null|NULL">
                        <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="FSYS||cardTypeNotDefine||skey [getDSP.cardType] Not Mapping Yet||{dbconfig:fsd.[category].notif.syserror}_-_[additional_notif_flu]"/>
                        <SA class="SyncIf" var="isFlu" compare="1">
                           <SA class="SyncAssignVariable" var="SMS" value="NOSMS"/>
                        </SA>
                        <SA class="SyncTempRequest" service="FSD" option="remove"/>
                        <SA class="SyncBreak"/>
                     </SA>
                     <SA class="SyncAssignVariable" var="qosTPLID" value="{dbconfig:fsd.[getDSP.cardType].qosTPLID}"/>
                     <SA class="SyncAssignVariable" var="prov3GPlus" value="TRUE"/>
                  </case>
                  <case code="default">
                     <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="FR09||cardTypeNotFound||cardType not Found||{dbconfig:fsd.[category].notif.syserror}_-_[additional_notif_flu]"/>
                     <SA class="SyncIf" var="isFlu" compare="1">
                        <SA class="SyncAssignVariable" var="SMS" value="NOSMS"/>
                     </SA>
                     <SA class="SyncTempRequest" service="FSD" option="remove"/>
                     <SA class="SyncBreak"/>
                  </case>
               </SA>
            </case>
            <case code="httpgetjson">
               <SA class="SyncIf" var="json.success" compare="|null|NULL">
                  <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="OK01||WrongEligibleRefProductConfig||undefined success parameter||NOSMS"/>
                  <SA class="SyncTempRequest" service="FSD" option="remove"/>
                  <SA class="SyncBreak"/>
               </SA>
               <SA class="SyncIf" var="json.url" compare="|null|NULL">
                  <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="OK01||WrongEligibleRefProductConfig||undefined URL||NOSMS"/>
                  <SA class="SyncTempRequest" service="FSD" option="remove"/>
                  <SA class="SyncBreak"/>
               </SA>
               <SA id="httpget" class="SyncHttpGet" saveValue="true" assertValue="" timeout="5000">[json.url]</SA>
               <SA class="JsonParse" var="response" input="[httpget]"/>
               <SA class="SyncAssignVariable" var="elrefgetjson" value="[httpget]"/>
               <SA class="SyncIf" var="response.statuscode" compare="[json.success]" negation="true">
                  <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="OK01||NotEligibleRef||httpgetjson get false response: [httpget]||NOSMS"/>
                  <SA class="SyncTempRequest" service="FSD" option="remove"/>
                  <SA class="SyncBreak"/>
               </SA>
            </case>
            <case code="checkbonus">
               <SA class="SyncIf" var="json.bonusID" compare="|null|NULL" negation="true">
                  <SA id="Bonus" class="SyncHttpGet" saveValue="true" assertValue="">{dbconfig:flashunlv2.url.getInfoBonus}</SA>
                  <SA class="SyncIf" var="Bonus" compare="Error|HTTP_FAILED|FAILED|null">
                     <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="FX02||[Bonus]||failedQueryEAI||{dbconfig:fsd.[category].notif.syserror}"/>
                     <SA class="SyncBreak"/>
                  </SA>
                  <SA id="ExplodeChunk" class="SyncExplode" separator=";" var="arrayBonus0" input="[Bonus]"/>
                  <SA id="valbonus" class="SyncAssertExpression" var="arrayBonus0.size" operator=">" value="0" saveValue="true"/>
                  <SA class="SyncIf" var="valbonus" compare="1">
                     <SA id="BonusAmount" class="Arithmetic" Input1="[arrayBonus0.size]" Input2="1" Operator="-" Msisdn="" saveValue="True"/>
                     <SA class="SyncAssignVariable" var="foundBonusID" value="FALSE"/>
                     <SA class="SyncLoopIterator" var="i" start="0" end="[BonusAmount]">
                        <!--inisiasi flagaccumulatedloop = false-->
                        <SA class="SyncIf" var="foundBonusID" compare="FALSE">
                           <SA id="ExplodeChunk" class="SyncExplode" separator="\|" var="arrayBonus1" input="[arrayBonus0.[i]]"/>
                           <SA id="valbonusId" class="SyncAssertExpression" var="arrayBonus1.size" operator=">" value="0" saveValue="true"/>
                           <SA class="SyncIf" var="valbonusId" compare="1">
                              <SA class="SyncIf" var="arrayBonus1.0" compare="[json.bonusID]">
                                 <SA class="SyncAssignVariable" var="foundBonusID" value="TRUE"/>
                              </SA>
                           </SA>
                        </SA>
                     </SA>
                     <SA class="SyncIf" var="json.isCheckLos" compare="1" negation="true">
                        <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="OK01||notEligibleForProductBasedOnBonusID||foundBonusID=[foundBonusID]-[json.bonusID]||{dbconfig:fsd.notif.[notifCommand]notEligibleForProduct}"/>
                        <SA class="SyncTempRequest" service="FSD" option="remove"/>
                        <SA class="SyncBreak"/>
                     </SA>
                  </SA>
               </SA>
            </case>
         </SA>
      </SA>
      <!--Validate Max Counter Restriction Within Product Length-->
      <SA class="SyncIf" var="product_max_counter_inperiod" compare="|null|NULL" negation="true">
         <SA class="SyncAssignVariable" var="resetRestrictCounter" value="0"/>
         <SA class="DateUtility" id="dateToday" saveValue="true" Option="Today" Param2="yyyy-MM-dd"/>
         <SA class="SyncAssignVariable" var="fsd_counter_counter_redeem" value="0"/>
         <!--Get Data Counter-->
         <SA class="SyncDbSingleQuery" dataSource="dbsession" varPrefix="fsd_counter_" requestor="[bonusMsisdn]">SELECT (counter_restriction+1) as counter_restriction, counter_redeem, end_date_restriction, end_date_redeem FROM fsd_counter2 WHERE msisdn='[bonusMsisdn]' AND product_id='[product_product_id]'</SA>
         <SA class="SyncIf" var="fsd_counter_counter_restriction" compare="null|1">
            <SA class="SyncDbSingleQuery" dataSource="dbsession" varPrefix="fsd_counter_" requestor="[bonusMsisdn]">SELECT (counter_restriction+1) as counter_restriction, counter_redeem, end_date_restriction, end_date_redeem FROM fsd_counter WHERE msisdn='[bonusMsisdn]' AND product_id='[product_product_id]'</SA>
            <SA class="SyncIf" var="fsd_counter_counter_restriction" compare="null|1">
               <SA class="SyncDbSingleQuery" dataSource="dbsession" varPrefix="res_" requestor="[bonusMsisdn]">SELECT msisdn, end_date, (counter+1) as counter FROM fsd_restriction_counter WHERE msisdn='[bonusMsisdn]' AND product_id='[product_product_id]'</SA>
               <SA class="SyncIf" var="res_end_date" compare="null">
                  <SA Input2="1" Input1="[product_product_length]" Operator="-" Msisdn="" saveValue="True" id="res_length" class="Arithmetic"/>
                  <SA class="DateUtility" id="res_end_date" saveValue="true" Option="add_date2" Param1="yyyy-MM-dd" Param2="yyyy-MM-dd" Param5="[dateToday]" Param6="[res_length]"/>
                  <SA class="SyncAssignVariable" var="res_counter" value="1"/>
               </SA>
               <SA class="SyncAssignVariable" var="fsd_counter_counter_restriction" value="[res_counter]"/>
               <SA class="SyncAssignVariable" var="fsd_counter_end_date_restriction" value="[res_end_date]"/>
            </SA>
         </SA>
         <SA id="dayCompareRedeem" class="DateUtility" Option="is_expired2" Param3="[fsd_counter_end_date_redeem]" Param5="[dateToday]" saveValue="true"/>
         <SA class="SyncSwitch" input="dayCompareRedeem">
            <case code="1">
               <SA class="SyncAssignVariable" var="fsd_counter_counter_redeem" value="0"/>
            </case>
            <case code="default"></case>
         </SA>
         <SA id="dayCompare" class="DateUtility" Option="is_expired2" Param3="[fsd_counter_end_date_restriction]" Param5="[dateToday]" saveValue="true"/>
         <SA class="SyncSwitch" input="dayCompare">
            <case code="1">
               <SA class="SyncAssignVariable" var="resetRestrictCounter" value="1"/>
            </case>
            <case code="default">
               <SA id="counterCompare" class="SyncAssertExpression" var="product_max_counter_inperiod" operator="&lt;" value="[fsd_counter_counter_restriction]" saveValue="true"/>
               <SA class="SyncIf" var="counterCompare" compare="1">
                  <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="OK01||alreadyMaxCounter||00||{dbconfig:fsd.notif.alreadyMaxCounter}"/>
                  <SA class="SyncIf" var="isFlu" compare="1">
                     <SA class="SyncAssignVariable" var="SMS" value="NOSMS"/>
                  </SA>
                  <SA class="SyncTempRequest" service="FSD" option="remove"/>
                  <SA class="SyncBreak"/>
               </SA>
            </case>
         </SA>
      </SA>
      <!--Get Next Counter-->
      <SA class="SyncAssignVariable" var="counter_counter" value="1"/>
      <SA class="SyncDbSingleQuery" dataSource="dbsession" varPrefix="counter_" requestor="[bonusMsisdn]">SELECT msisdn, IF(status='1', (counter+1), '-1') AS counter FROM fsd_subscription_counter WHERE msisdn='[bonusMsisdn]' AND product_id='[product_product_id]'</SA>
      <!--Check IMEI from parameter-->
      <SA class="SyncIf" var="param.imei" compare="|null|NULL" negation="true">
         <SA class="SyncAssignVariable" var="getDSP.imei" value="[param.imei]"/>
      </SA>
      <!--Get IMEI-->
      <SA class="SyncAssignVariable" var="imei" value="NULL"/>
      <SA class="SyncAssignVariable" var="tac" value=""/>
      <SA class="SyncAssignVariable" var="spr_ATTR_VALUE" value="12345678901234"/>
      <SA class="SyncAssignVariable" var="add.imei" value=""/>
      <SA class="SyncIf" var="forceProduct" compare="TRUE" negation="true">
         <SA class="SyncIf" var="product_check_imei_discount" compare="1">
            <SA class="SyncAssignVariable" var="add.imei" value="[getDSP.imei]"/>
            <SA class="SyncIf" var="getDSP.imei" compare="|null|NULL">
               <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="FR09||imeiNotFound||[getDSP.imei]||{dbconfig:fsd.[category].notif.[notifCommand]notAllowImei}_-_[additional_notif_flu]"/>
               <SA class="SyncIf" var="isFlu" compare="1">
                  <SA class="SyncAssignVariable" var="SMS" value="NOSMS"/>
               </SA>
               <SA class="SyncTempRequest" service="FSD" option="remove"/>
               <SA class="SyncBreak"/>
            </SA>
            <SA class="SyncAssignVariable" var="imei" value="[add.imei]"/>
            <SA id="SubstringMessage" class="SyncSubstring" var="tac" input="[imei]" start="0" stop="8"/>
         </SA>
      </SA>
      <!--check whitelist voucher cod3-->
      <SA class="SyncIf" var="product_eligible_reference" compare="|null|NULL" negation="true">
         <SA class="JsonParse" var="json" input="[product_eligible_reference]"/>
         <SA class="SyncIf" var="json.type" compare="vcode">
            <!--Check Imei from DSP-->
            <SA class="SyncIf" var="imei" compare="|null|NULL">
               <SA class="SyncAssignVariable" var="add.imei" value="[getDSP.imei]"/>
               <SA class="SyncIf" var="getDSP.imei" compare="|null|NULL">
                  <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="FR09||imeiNotFound||[getDSP.imei]||{dbconfig:fsd.[category].notif.[notifCommand]notAllowImei}_-_[additional_notif_flu]"/>
                  <SA class="SyncIf" var="isFlu" compare="1">
                     <SA class="SyncAssignVariable" var="SMS" value="NOSMS"/>
                  </SA>
                  <SA class="SyncTempRequest" service="FSD" option="remove"/>
                  <SA class="SyncBreak"/>
               </SA>
               <SA class="SyncAssignVariable" var="imei" value="[add.imei]"/>
               <SA id="SubstringMessage" class="SyncSubstring" var="tac" input="[imei]" start="0" stop="8"/>
            </SA>
            <SA class="SyncAssignVariable" var="voucherCode" value="[param.vcode]"/>
            <SA class="SyncAssignVariable" var="voucher_code" value=""/>
            <SA class="SyncIf" var="voucherCode" compare="|null|NULL">
               <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="OK01||voucherParamNotFound||voucherParamNotFound||{dbconfig:fsd.[category].notif.[notifCommand]imeiVoucherNotAllow}_-_[additional_notif_flu]"/>
               <SA class="SyncIf" var="isFlu" compare="1">
                  <SA class="SyncAssignVariable" var="SMS" value="NOSMS"/>
               </SA>
               <SA class="SyncTempRequest" service="FSD" option="remove"/>
               <SA class="SyncBreak"/>
            </SA>
            <SA class="SyncDbSingleQuery" dataSource="jdbc/whitelist" varPrefix="getCode_">SELECT * FROM wl_group_voucher_imei WHERE product_id = '[product_product_id]' AND imei = '[imei]' AND voucher_code = '[voucherCode]'</SA>
            <SA class="SyncIf" var="getCode_voucher_code" compare="null">
               <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="OK01||imeiVoucherNotAllow||[voucherCode]||{dbconfig:fsd.[category].notif.[notifCommand]imeiVoucherNotAllow}_-_[additional_notif_flu]"/>
               <SA class="SyncIf" var="isFlu" compare="1">
                  <SA class="SyncAssignVariable" var="SMS" value="NOSMS"/>
               </SA>
               <SA class="SyncTempRequest" service="FSD" option="remove"/>
               <SA class="SyncBreak"/>
            </SA>
            <SA class="SyncIf" var="getCode_status" compare="1">
               <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="OK01||voucherAlreadyRedeem||[voucherCode]||{dbconfig:fsd.[category].notif.[notifCommand]voucherAlreadyRedeem}_-_[additional_notif_flu]"/>
               <SA class="SyncIf" var="isFlu" compare="1">
                  <SA class="SyncAssignVariable" var="SMS" value="NOSMS"/>
               </SA>
               <SA class="SyncTempRequest" service="FSD" option="remove"/>
               <SA class="SyncBreak"/>
            </SA>
            <SA class="SyncAssignVariable" var="voucher_code" value="[getCode_voucher_code]"/>
         </SA>
      </SA>
      <!--Get Location-->
      <SA class="SyncAssignVariable" var="location.home" value="NOT_FOUND"/>
      <SA class="SyncIf" var="getDSP.kabupaten" compare="|null|NULL" negation="true">
         <SA class="SyncAssignVariable" var="location.home" value="[getDSP.kabupaten]"/>
      </SA>
      <!--Retry DSPbestmatch-->
      <SA class="SyncAssignVariable" var="getLoc" value="Full"/>
      <SA class="SyncIf" var="location.home" compare="NOT_FOUND">
         <SA class="SyncIf" var="bestmatch" compare="1">
            <SA class="SyncAssignVariable" var="dspb_url" value="{dbconfig:dsp.url.info.bestmatch}"/>
            <SA id="dspb_resp" class="SyncHttpGet" timeout="5000" saveValue="true" assertValue="">[dspb_url]&amp;msisdn=[bonusMsisdn]</SA>
            <SA class="SyncIf" var="dspb_resp" compare="|null|FAILED|HTTP_FAILED" negation="true">
               <SA class="JsonParse" var="getDSPB" input="[dspb_resp]"/>
               <SA class="SyncIf" var="getDSPB.kabupaten" compare="|null|NULL" negation="true">
                  <SA class="SyncAssignVariable" var="location.home" value="[getDSPB.kabupaten]"/>
                  <SA class="SyncAssignVariable" var="getLoc" value="Bestmatch"/>
               </SA>
            </SA>
         </SA>
      </SA>
      <SA class="SyncAssignVariable" var="location.disc" value=""/>
      <SA class="SyncIf" var="forceProduct" compare="TRUE" negation="true">
         <SA class="SyncIf" var="product_check_location_discount" compare="1">
            <SA class="SyncAssignVariable" var="location.disc" value="[location.home]"/>
         </SA>
      </SA>
      <!--Get Price Plan-->
      <SA class="SyncIf" var="forceProduct" compare="TRUE" negation="true">
         <SA class="SyncIf" var="product_check_priceplan_discount" compare="1">
            <SA class="SyncIf" var="pricePlan" compare="|null|NULL">
               <SA class="INPlugin" id="pricePlan" saveValue="true" Type="get" bNumber="3636" bMsisdn="[bonusMsisdn]" InpluginTimeout="{dbconfig:InpluginTimeout}" InpluginAppsid="{dbconfig:bonus.getChargingMode.appsid}" InpluginPwd="{dbconfig:bonus.getChargingMode.password}" InpluginOrderid="GetChmod" InpluginCpname="Reflex"/>
               <SA class="SyncIf" var="pricePlan" compare="REJECT|null|FAILED|HTTP-FAILED">
                  <SA class="SyncIf" var="pricePlan" compare="REJECT|null">
                     <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="FI06||RejectGetPricePlan||[pricePlan]||{dbconfig:fsd.[category].notif.syserror}_-_[additional_notif_flu]"/>
                  </SA>
                  <SA class="SyncIf" var="pricePlan" compare="FAILED|HTTP-FAILED">
                     <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="FI06||TOGetPricePlan||[pricePlan]||{dbconfig:fsd.[category].notif.syserror}_-_[additional_notif_flu]"/>
                  </SA>
                  <SA class="SyncIf" var="isFlu" compare="1">
                     <SA class="SyncAssignVariable" var="SMS" value="NOSMS"/>
                  </SA>
                  <SA class="SyncTempRequest" service="FSD" option="remove"/>
                  <SA class="SyncBreak"/>
               </SA>
            </SA>
         </SA>
      </SA>
      <!--Force Product for Sub Category PRELOAD-->
      <SA class="SyncIf" var="product_sub_category" compare="PRELOAD">
         <SA class="SyncAssignVariable" var="forceProduct" value="TRUE"/>
      </SA>
      <!--check program x get y-->
      <SA class="SyncAssignVariable" var="isNEWWL" value="FALSE"/>
      <SA class="SyncIf" var="product_sub_category" compare="NEWWL">
         <SA class="SyncAssignVariable" var="isNEWWL" value="TRUE"/>
         <SA class="JsonParse" var="jsonrule" input="[product_rule]"/>
         <!--minta ke erin whitelistnya AMBIL IML-->
         <SA class="SyncAssignVariable" var="checkNewWlErin" value="{dbconfig:fsd.checkNewWlErin}"/>
         <SA id="CheckWhitelistErin" class="SyncHttpGet" timeout="7000" saveValue="true" assertValue="">[checkNewWlErin]</SA>
         <SA class="SyncStringUtility" type="replaceAll" param1="[CheckWhitelistErin]" param2="\|" param3="#" var="CheckWhitelistErinTDR"/>
         <!--<SA class="SyncAssignVariable" var="CheckWhitelistErin" value="notfound|11111|22222" />-->
         <!--KALAU GAGAL AMBIL WHITELIST-->
         <SA class="SyncIf" var="CheckWhitelistErin" compare="FAILED|HTTP_FAILED|NULL|">
            <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="OK01||FailedErin||CheckWhitelistErin=[CheckWhitelistErin]||{dbconfig:DynDa.[mappingParam].notif.syserror}"/>
            <SA class="SyncTempRequest" service="FSD" option="remove"/>
            <SA class="SyncBreak"/>
         </SA>
         <SA class="SyncExplode" id="ExplodeChunk" separator="\|" var="chunk_whitelist" input="[CheckWhitelistErin]"/>
         <SA class="SyncSwitch" input="chunk_whitelist.0">
            <case code="notfound">
               <SA class="SyncAssignVariable" var="imei_wl" value="0"/>
            </case>
            <case code="default">
               <SA class="SyncAssignVariable" var="imei_wl" value="0,[chunk_whitelist.0]"/>
            </case>
         </SA>
         <SA class="SyncSwitch" input="chunk_whitelist.1">
            <case code="notfound">
               <SA class="SyncAssignVariable" var="msisdn_wl" value="0"/>
            </case>
            <case code="default">
               <SA class="SyncAssignVariable" var="msisdn_wl" value="0,[chunk_whitelist.1]"/>
            </case>
         </SA>
         <SA class="SyncSwitch" input="chunk_whitelist.2">
            <case code="notfound">
               <SA class="SyncAssignVariable" var="loc_wl" value="0"/>
            </case>
            <case code="default">
               <SA class="SyncAssignVariable" var="loc_wl" value="0,[chunk_whitelist.2]"/>
            </case>
         </SA>
         <SA class="SyncIf" var="jsonrule.schema" compare="XGETY">
            <!--Get Next Counter XgetY product-->
            <SA class="SyncAssignVariable" var="schema" value="XGETY"/>
            <SA class="SyncAssignVariable" var="counter_counter" value="1"/>
            <SA class="SyncDbSingleQuery" dataSource="dbsession" varPrefix="counter_" requestor="[bonusMsisdn]">SELECT msisdn, IF(counter_rule>'0', (counter_rule+1), '-1') AS counter,last_activation_date FROM fsd_counter2 WHERE msisdn='[bonusMsisdn]' AND product_id='[product_product_id]'</SA>
            <SA class="SyncAssignVariable" var="XGETYisReset" value="FALSE"/>
            <SA class="SyncIf" var="counter_last_activation_date" compare="|null|NULL" negation="true">
               <SA class="DateUtility" id="dateToday" saveValue="true" Option="Today" Param2="yyyy-MM-dd"/>
               <SA class="SyncExplode" var="chunk_today" input="[dateToday]" separator="\-"/>
               <SA class="SyncAssignVariable" var="month_today" value="[chunk_today.1]"/>
               <SA class="SyncExplode" var="chunk_lastactivation" input="[counter_last_activation_date]" separator="\-"/>
               <SA class="SyncAssignVariable" var="month_lastactivation" value="[chunk_lastactivation.1]"/>
               <SA class="SyncIf" var="month_today" compare="[month_lastactivation]" negation="true">
                  <SA class="SyncAssignVariable" var="XGETYisReset" value="TRUE"/>
               </SA>
               <!--<SA class="SyncIf" var="month_today" compare="[month_lastactivation]">
						<SA id="isExceedThreshold" class="SyncAssertExpression" var="counter_counter" operator="&gt;" value="[jsonrule.reset_counter]" saveValue="true"/>
						<SA class="SyncIf" var="isExceedThreshold" compare="1">
							<SA class="SyncAssignVariable" var="XGETYisExpired" value="TRUE" />
						</SA>
					</SA>-->
            </SA>
            <SA class="SyncIf" var="XGETYisReset" compare="TRUE">
               <SA class="SyncAssignVariable" var="counter_counter" value="1"/>
            </SA>
         </SA>
      </SA>
      <SA class="SyncAssignVariable" var="queryNewImei" value="0"/>
      <SA class="SyncAssignVariable" var="provOldImei" value="0"/>
      <!--Get Discount Id-->
      <SA id="SubstringMessage" class="SyncSubstring" var="ndc" input="[bonusMsisdn]" start="0" stop="5"/>
      <SA class="SyncAssignVariable" var="chargeAppsid" value="null"/>
      <SA class="SyncIf" var="forceProduct" compare="TRUE" negation="true">
         <SA class="SyncIf" var="isNEWWL" compare="TRUE" negation="true">
            <SA class="SyncIf" var="counter_counter" compare="-1" negation="true">
               <SA class="SyncAssignVariable" var="checkDiscIML" value="[product_check_location_discount]-[product_check_imei_discount]"/>
               <SA class="SyncIf" var="checkDiscIML" compare="1-1">
                  <SA class="SyncDbSingleQuery" dataSource="jdbc/whitelist" varPrefix="get_">(
							SELECT fdm.program_name, fdi.discount_id, fd.start_date, 'discIML' AS valTable, 1 AS priority
							FROM fsd_discount fd, fsd_discount_imei fdi, fsd_discount_whitelist fdm, fsd_discount_location fdl
							WHERE fd.discount_id = fdi.discount_id 
								AND fd.discount_id = fdm.discount_id AND fd.discount_id = fdl.discount_id AND fd.product_id = '[product_product_id]' AND fdi.imei = '[imei]'
								AND fdm.msisdn = '[bonusMsisdn]' AND fdl.home = '[location.disc]' AND fd.flagCode = 'IML' AND (CURDATE() BETWEEN fd.start_date AND fd.end_date) 
								AND (fd.eligible_ndc='ALL' OR fd.eligible_ndc LIKE CONCAT('%|','[ndc]', '|%')) 
								AND (fd.target='ALL' OR fd.target LIKE CONCAT('%|','[counter_counter]', '|%'))
								AND (fd.pricePlan='ALL' OR fd.pricePlan LIKE CONCAT('%|','[pricePlan]', '|%')) 
								AND (fd.eligible_days='ALL' OR fd.eligible_days LIKE CONCAT('%|','[dayToday]', '|%'))
						) UNION (
							SELECT fdm.program_name, fdi.discount_id, fd.start_date, 'discIML2' AS valTable, 2 AS priority
							FROM fsd_discount fd, fsd_discount_imei fdi, fsd_discount_whitelist fdm, fsd_discount_location fdl
							WHERE fd.discount_id = fdi.discount_id 
								AND fd.discount_id = fdm.discount_id AND fd.discount_id = fdl.discount_id AND fd.product_id = '[product_product_id]' AND fdi.imei = '[tac]'
								AND fdm.msisdn = '[bonusMsisdn]' AND fdl.home = '[location.disc]' AND fd.flagCode = 'IML' AND (CURDATE() BETWEEN fd.start_date AND fd.end_date) 
								AND (fd.eligible_ndc='ALL' OR fd.eligible_ndc LIKE CONCAT('%|','[ndc]', '|%')) 
								AND (fd.target='ALL' OR fd.target LIKE CONCAT('%|','[counter_counter]', '|%'))
								AND (fd.pricePlan='ALL' OR fd.pricePlan LIKE CONCAT('%|','[pricePlan]', '|%')) 
								AND (fd.eligible_days='ALL' OR fd.eligible_days LIKE CONCAT('%|','[dayToday]', '|%'))
						) ORDER BY priority ASC, start_date DESC, discount_id ASC LIMIT 1;</SA>
               </SA>
               <SA class="SyncIf" var="get_discount_id" compare="null">
                  <SA class="SyncDbSingleQuery" dataSource="jdbc/whitelist" varPrefix="get_">(
							SELECT fdm.program_name, fdi.discount_id, fd.start_date, 'discIM' AS valTable, 1 AS priority
							FROM fsd_discount fd, fsd_discount_imei fdi, fsd_discount_whitelist fdm
							WHERE fd.discount_id = fdi.discount_id 
								AND fd.discount_id = fdm.discount_id AND fd.product_id = '[product_product_id]' AND fdi.imei = '[imei]'
								AND fdm.msisdn = '[bonusMsisdn]' AND fd.flagCode = 'IMX' AND (CURDATE() BETWEEN fd.start_date AND fd.end_date) 
								AND (fd.eligible_ndc='ALL' OR fd.eligible_ndc LIKE CONCAT('%|','[ndc]', '|%')) 
								AND (fd.target='ALL' OR fd.target LIKE CONCAT('%|','[counter_counter]', '|%'))
								AND (fd.pricePlan='ALL' OR fd.pricePlan LIKE CONCAT('%|','[pricePlan]', '|%')) 
								AND (fd.eligible_days='ALL' OR fd.eligible_days LIKE CONCAT('%|','[dayToday]', '|%'))
						) UNION (
							SELECT fdm.program_name, fdi.discount_id, fd.start_date, 'discIM2' AS valTable, 2 AS priority
							FROM fsd_discount fd, fsd_discount_imei fdi, fsd_discount_whitelist fdm
							WHERE fd.discount_id = fdi.discount_id 
								AND fd.discount_id = fdm.discount_id AND fd.product_id = '[product_product_id]' AND fdi.imei = '[tac]'
								AND fdm.msisdn = '[bonusMsisdn]' AND fd.flagCode = 'IMX' AND (CURDATE() BETWEEN fd.start_date AND fd.end_date) 
								AND (fd.eligible_ndc='ALL' OR fd.eligible_ndc LIKE CONCAT('%|','[ndc]', '|%')) 
								AND (fd.target='ALL' OR fd.target LIKE CONCAT('%|','[counter_counter]', '|%'))
								AND (fd.pricePlan='ALL' OR fd.pricePlan LIKE CONCAT('%|','[pricePlan]', '|%')) 
								AND (fd.eligible_days='ALL' OR fd.eligible_days LIKE CONCAT('%|','[dayToday]', '|%'))
						) UNION (
							SELECT '' AS program_name, fdi.discount_id, fd.start_date, 'discIL' AS valTable, 3 AS priority
							FROM fsd_discount fd, fsd_discount_imei fdi, fsd_discount_location fdl
							WHERE fd.discount_id = fdi.discount_id 
								AND fd.discount_id = fdl.discount_id AND fd.product_id = '[product_product_id]' AND fdi.imei = '[imei]'
								AND fdl.home = '[location.disc]' AND fd.flagCode = 'IXL' AND (CURDATE() BETWEEN fd.start_date AND fd.end_date) 
								AND (fd.eligible_ndc='ALL' OR fd.eligible_ndc LIKE CONCAT('%|','[ndc]', '|%')) 
								AND (fd.target='ALL' OR fd.target LIKE CONCAT('%|','[counter_counter]', '|%'))
								AND (fd.pricePlan='ALL' OR fd.pricePlan LIKE CONCAT('%|','[pricePlan]', '|%')) 
								AND (fd.eligible_days='ALL' OR fd.eligible_days LIKE CONCAT('%|','[dayToday]', '|%'))
						) UNION (
							SELECT '' AS program_name, fdi.discount_id, fd.start_date, 'discIL2' AS valTable, 4 AS priority
							FROM fsd_discount fd, fsd_discount_imei fdi, fsd_discount_location fdl
							WHERE fd.discount_id = fdi.discount_id 
								AND fd.discount_id = fdl.discount_id AND fd.product_id = '[product_product_id]' AND fdi.imei = '[tac]'
								AND fdl.home = '[location.disc]' AND fd.flagCode = 'IXL' AND (CURDATE() BETWEEN fd.start_date AND fd.end_date) 
								AND (fd.eligible_ndc='ALL' OR fd.eligible_ndc LIKE CONCAT('%|','[ndc]', '|%')) 
								AND (fd.target='ALL' OR fd.target LIKE CONCAT('%|','[counter_counter]', '|%'))
								AND (fd.pricePlan='ALL' OR fd.pricePlan LIKE CONCAT('%|','[pricePlan]', '|%')) 
								AND (fd.eligible_days='ALL' OR fd.eligible_days LIKE CONCAT('%|','[dayToday]', '|%'))
						) UNION (
							SELECT '' AS program_name, fdi.discount_id, fd.start_date, 'discI' AS valTable, 5 AS priority
							FROM fsd_discount fd, fsd_discount_imei fdi
							WHERE fd.discount_id = fdi.discount_id 
								AND fd.product_id = '[product_product_id]' AND fdi.imei = '[imei]' AND fd.flagCode = 'IXX' 
								AND (CURDATE() BETWEEN fd.start_date AND fd.end_date) 
								AND (fd.eligible_ndc='ALL' OR fd.eligible_ndc LIKE CONCAT('%|','[ndc]', '|%')) 
								AND (fd.target='ALL' OR fd.target LIKE CONCAT('%|','[counter_counter]', '|%'))
								AND (fd.pricePlan='ALL' OR fd.pricePlan LIKE CONCAT('%|','[pricePlan]', '|%')) 
								AND (fd.eligible_days='ALL' OR fd.eligible_days LIKE CONCAT('%|','[dayToday]', '|%'))
						) UNION (
							SELECT '' AS program_name, fdi.discount_id, fd.start_date, 'discI2' AS valTable, 6 AS priority
							FROM fsd_discount fd, fsd_discount_imei fdi
							WHERE fd.discount_id = fdi.discount_id 
								AND fd.product_id = '[product_product_id]' AND fdi.imei = '[tac]' AND fd.flagCode = 'IXX' 
								AND (CURDATE() BETWEEN fd.start_date AND fd.end_date) 
								AND (fd.eligible_ndc='ALL' OR fd.eligible_ndc LIKE CONCAT('%|','[ndc]', '|%')) 
								AND (fd.target='ALL' OR fd.target LIKE CONCAT('%|','[counter_counter]', '|%'))
								AND (fd.pricePlan='ALL' OR fd.pricePlan LIKE CONCAT('%|','[pricePlan]', '|%')) 
								AND (fd.eligible_days='ALL' OR fd.eligible_days LIKE CONCAT('%|','[dayToday]', '|%'))
						) UNION (
							SELECT fdm.program_name, fdl.discount_id, fd.start_date, 'discLM' AS valTable, 7 AS priority
							FROM fsd_discount fd, fsd_discount_location fdl, fsd_discount_whitelist fdm
							WHERE fd.discount_id = fdl.discount_id 
								AND fd.discount_id = fdm.discount_id AND fd.product_id = '[product_product_id]' AND fdl.home = '[location.disc]' 
								AND fdm.msisdn = '[bonusMsisdn]' AND fd.flagCode = 'XML' AND (CURDATE() BETWEEN fd.start_date AND fd.end_date) 
								AND (fd.eligible_ndc='ALL' OR fd.eligible_ndc LIKE CONCAT('%|','[ndc]', '|%')) 
								AND (fd.target='ALL' OR fd.target LIKE CONCAT('%|','[counter_counter]', '|%'))
								AND (fd.pricePlan='ALL' OR fd.pricePlan LIKE CONCAT('%|','[pricePlan]', '|%')) 
								AND (fd.eligible_days='ALL' OR fd.eligible_days LIKE CONCAT('%|','[dayToday]', '|%'))
						) UNION (
							SELECT fdm.program_name, fdm.discount_id, fd.start_date, 'discM' AS valTable, 8 AS priority
							FROM fsd_discount fd, fsd_discount_whitelist fdm
							WHERE fd.discount_id = fdm.discount_id 
								AND fd.product_id = '[product_product_id]' AND fdm.msisdn = '[bonusMsisdn]' AND fd.flagCode = 'XMX' 
								AND (CURDATE() BETWEEN fd.start_date AND fd.end_date) 
								AND (fd.eligible_ndc='ALL' OR fd.eligible_ndc LIKE CONCAT('%|','[ndc]', '|%')) 
								AND (fd.target='ALL' OR fd.target LIKE CONCAT('%|','[counter_counter]', '|%'))
								AND (fd.pricePlan='ALL' OR fd.pricePlan LIKE CONCAT('%|','[pricePlan]', '|%')) 
								AND (fd.eligible_days='ALL' OR fd.eligible_days LIKE CONCAT('%|','[dayToday]', '|%'))
						) UNION (
							SELECT '' AS program_name, fdl.discount_id, fd.start_date, 'discL' AS valTable, 9 AS priority
							FROM fsd_discount fd, fsd_discount_location fdl
							WHERE fd.discount_id = fdl.discount_id 
								AND fd.product_id = '[product_product_id]' AND fdl.home = '[location.disc]' AND fd.flagCode = 'XXL' 
								AND (CURDATE() BETWEEN fd.start_date AND fd.end_date) 
								AND (fd.eligible_ndc='ALL' OR fd.eligible_ndc LIKE CONCAT('%|','[ndc]', '|%')) 
								AND (fd.target='ALL' OR fd.target LIKE CONCAT('%|','[counter_counter]', '|%'))
								AND (fd.pricePlan='ALL' OR fd.pricePlan LIKE CONCAT('%|','[pricePlan]', '|%')) 
								AND (fd.eligible_days='ALL' OR fd.eligible_days LIKE CONCAT('%|','[dayToday]', '|%'))
						) UNION (
							SELECT '' AS program_name, fd.discount_id, fd.start_date, 'discDefault' AS valTable, 10 AS priority
							FROM fsd_discount fd
							WHERE fd.product_id = '[product_product_id]' 
								AND fd.flagCode = 'XXX' AND (CURDATE() BETWEEN fd.start_date AND fd.end_date) 
								AND (fd.eligible_ndc='ALL' OR fd.eligible_ndc LIKE CONCAT('%|','[ndc]', '|%')) 
								AND (fd.target='ALL' OR fd.target LIKE CONCAT('%|','[counter_counter]', '|%'))
								AND (fd.pricePlan='ALL' OR fd.pricePlan LIKE CONCAT('%|','[pricePlan]', '|%')) 
								AND (fd.eligible_days='ALL' OR fd.eligible_days LIKE CONCAT('%|','[dayToday]', '|%'))
						) ORDER BY priority ASC, start_date DESC, discount_id ASC LIMIT 1;</SA>
               </SA>
               <SA class="SyncIf" var="get_discount_id" compare="null" negation="true">
                  <SA class="SyncDbSingleQuery" dataSource="jdbc/whitelist" varPrefix="discount_">SELECT *, bonus_appsid_[prepaidType] AS bonus_appsid FROM fsd_discount WHERE discount_id='[get_discount_id]' AND product_id='[product_product_id]'</SA>
                  <SA class="SyncIf" var="discount_discount_id" compare="null" negation="true">
                     <!--check LOS: Discount-->
                     <SA class="SyncIf" var="discount_check_los" compare="null" negation="true">
                        <SA class="INPlugin" id="lengthOfStay" saveValue="true" Type="get" bNumber="[adn]" bMsisdn="[bonusMsisdn]" InpluginTimeout="{dbconfig:InpluginTimeout}" InpluginAppsid="{dbconfig:bonus.getActiveDate.appsid}" InpluginPwd="{dbconfig:bonus.getActiveDate.password}" InpluginOrderid="GetActiveDate" InpluginCpname="Reflex"/>
                        <SA class="SyncIf" var="lengthOfStay" compare="0|REJECT|null|FAILED|HTTP_FAILED">
                           <!--retry hit-->
                           <SA class="INPlugin" id="lengthOfStay" saveValue="true" Type="get" bNumber="[adn]" bMsisdn="[bonusMsisdn]" InpluginTimeout="{dbconfig:InpluginTimeout}" InpluginAppsid="{dbconfig:bonus.getActiveDate.appsid}" InpluginPwd="{dbconfig:bonus.getActiveDate.password}" InpluginOrderid="GetActiveDate" InpluginCpname="Reflex"/>
                           <SA class="SyncIf" var="lengthOfStay" compare="0|REJECT|null|FAILED|HTTP_FAILED">
                              <SA class="SyncAssignVariable" var="errCode||detailz||SMS" value="FI06||checkLOSFailed||{dbconfig:fsd.[category].notif.syserror}"/>
                              <SA class="SyncAssignVariable" var="discount_id" value="[discount_discount_id]"/>
                              <SA class="SyncTempRequest" service="FSD" option="remove"/>
                              <SA class="SyncBreak"/>
                           </SA>
                        </SA>
                        <SA class="SyncDbSingleQuery" dataSource="jdbc/reflex" varPrefix="dblos_">SELECT TO_DAYS(CURDATE())-TO_DAYS(DATE_FORMAT('[lengthOfStay]','%Y-%m-%d')) AS days</SA>
                        <!--single value-->
                        <SA id="chekcLOS" class="SyncAssertExpression" var="dblos_days" operator="&lt;" value="[discount_check_los]" saveValue="true"/>
                        <SA class="SyncIf" var="chekcLOS" compare="1">
                           <SA class="SyncAssignVariable" var="errCode||detailz" value="OK01||NotAllowedLOS-Required LOS: [discount_check_los] days"/>
                           <SA class="SyncAssignVariable" var="SMS" value="{dbconfig:fsd.TAU.notif.notAllowedLOS}"/>
                           <SA class="SyncAssignVariable" var="discount_id" value="[discount_discount_id]"/>
                           <SA class="SyncTempRequest" service="FSD" option="remove"/>
                           <SA class="SyncBreak"/>
                        </SA>
                        <!--between range0 and range1-->
                        <!--<SA id="outputDays1" class="SyncAssertExpression" var="db_days" operator="&lt;" value="[ld.0]" saveValue="true"/>-->
                        <!--<SA class="SyncIf" var="outputDays1" compare="1">-->
                        <!--<SA class="SyncAssignVariable" var="errCode||detailz" value="OK01||NotAllowedLOS-activeDay[outputDays1]" />-->
                        <!--<SA class="SyncAssignVariable" var="SMS" value="{dbconfig:DynDa.[mappingParam].notif.notAllowedLOS}" />-->
                        <!--<SA class="SyncTempRequest" service="DynDa_[mappingParam]" option="remove"/>-->
                        <!--<SA class="SyncBreak"/>-->
                        <!--</SA>-->
                        <!--<SA id="outputDays2" class="SyncAssertExpression" var="db_days" operator="&gt;" value="[ld.1]" saveValue="true"/>-->
                        <!--<SA class="SyncIf" var="outputDays2" compare="1">-->
                        <!--<SA class="SyncAssignVariable" var="errCode||detailz" value="OK01||NotAllowedLOS-activeDay[outputDays2]" />-->
                        <!--<SA class="SyncAssignVariable" var="SMS" value="{dbconfig:DynDa.[mappingParam].notif.notAllowedLOS}" />-->
                        <!--<SA class="SyncTempRequest" service="DynDa_[mappingParam]" option="remove"/>-->
                        <!--<SA class="SyncBreak"/>-->
                        <!--</SA>-->
                     </SA>
                     <!--Check New Imei Discount-->
                     <SA class="SyncIf" var="discount_check_new_imei" compare="|null|NULL" negation="true">
                        <SA class="SyncExplode" var="c" input="[discount_check_new_imei]" separator="\|"/>
                        <SA class="SyncAssignVariable" var="queryNewImei" value="[c.0]"/>
                        <SA class="SyncAssignVariable" var="provOldImei" value="[c.1]"/>
                        <SA class="SyncIf" var="provOldImei" compare="1">
                           <SA class="SyncIf" var="imei" compare="|null|NULL">
                              <SA class="SyncAssignVariable" var="add.imei" value="[getDSP.imei]"/>
                              <SA class="SyncIf" var="getDSP.imei" compare="|null|NULL">
                                 <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="FR09||imeiNotFound||[getDSP.imei]||{dbconfig:fsd.[category].notif.[notifCommand]notAllowImei}_-_[additional_notif_flu]"/>
                                 <SA class="SyncIf" var="isFlu" compare="1">
                                    <SA class="SyncAssignVariable" var="SMS" value="NOSMS"/>
                                 </SA>
                                 <SA class="SyncTempRequest" service="FSD" option="remove"/>
                                 <SA class="SyncBreak"/>
                              </SA>
                              <SA class="SyncAssignVariable" var="imei" value="[add.imei]"/>
                           </SA>
                        </SA>
                        <SA class="SyncIf" var="queryNewImei" compare="1">
                           <!--Check is New Imei-->
                           <SA class="SyncSwitch" input="getDSP.newImeiFlag">
                              <case code="1">
                                 <!--Check Device is 3G-->
                                 <SA class="SyncAssignVariable" var="is3G" value="HSUPA:[getDSP.hsupa]-UMTS:[getDSP.umts]-HSDPA:[getDSP.hsdpa]-EDGE:[getDSP.edge]-LTE:[getDSP.lte]"/>
                                 <SA class="SyncIf" var="is3G" compare="{dbconfig:fsd.network.3G.categories}" negation="true">
                                    <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="OK01||not3GDevice||[is3G]||{dbconfig:fsd.[category].notif.[notifCommand]not3GDevice}_-_[additional_notif_flu]"/>
                                    <SA class="SyncIf" var="isFlu" compare="1">
                                       <SA class="SyncAssignVariable" var="SMS" value="NOSMS"/>
                                    </SA>
                                    <SA class="SyncTempRequest" service="FSD" option="remove"/>
                                    <SA class="SyncBreak"/>
                                 </SA>
                              </case>
                              <case code="0">
                                 <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="OK01||notNewImei||[getDSP.newImeiFlag]||{dbconfig:fsd.[category].notif.[notifCommand]notNewImei}_-_[additional_notif_flu]"/>
                                 <SA class="SyncIf" var="isFlu" compare="1">
                                    <SA class="SyncAssignVariable" var="SMS" value="NOSMS"/>
                                 </SA>
                                 <SA class="SyncTempRequest" service="FSD" option="remove"/>
                                 <SA class="SyncBreak"/>
                              </case>
                              <case code="default">
                                 <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="FR09||newImeiNotFound||[getDSP.newImeiFlag]||{dbconfig:fsd.[category].notif.[notifCommand]notNewImei}_-_[additional_notif_flu]"/>
                                 <SA class="SyncIf" var="isFlu" compare="1">
                                    <SA class="SyncAssignVariable" var="SMS" value="NOSMS"/>
                                 </SA>
                                 <SA class="SyncTempRequest" service="FSD" option="remove"/>
                                 <SA class="SyncBreak"/>
                              </case>
                           </SA>
                        </SA>
                     </SA>
                     <!--Validate Time Frame-->
                     <SA class="SyncAssignVariable" var="timeframeValid" value="1"/>
                     <SA class="SyncIf" var="discount_timeframe" compare="null|ALL" negation="true">
                        <SA class="SyncExplode" var="t" input="[discount_timeframe]" separator="-"/>
                        <SA class="TimeFrameValidation" newModel="1" TimeStart="[t.0]" TimeEnd="[t.1]" TimeZone="0" id="timeframe"/>
                        <SA class="SyncIf" var="timeframe" compare="0">
                           <SA class="SyncAssignVariable" var="timeframeValid" value="0"/>
                        </SA>
                     </SA>
                     <SA class="SyncIf" var="timeframeValid" compare="1">
                        <SA class="SyncAssignVariable" var="allowGetDiscId" value="TRUE"/>
                        <!--Verify IMEI-->
                        <SA class="SyncIf" var="product_check_imei_discount" compare="1">
                           <SA class="SyncIf" var="get_valTable" compare="discIML|discIML2|discIM|discIM2|discI|discI2|discIL|discIL2">
                              <SA class="SyncAssignVariable" var="maksImeiClaimDiscId" value="{dbconfig:fsd.[get_discount_id].maksImeiClaimDiscId}"/>
                              <SA class="SyncIf" var="maksImeiClaimDiscId" compare="|null">
                                 <SA class="SyncAssignVariable" var="maksImeiClaimDiscId" value="-1"/>
                              </SA>
                              <SA class="SyncIf" var="maksImeiClaimDiscId" compare="-1" negation="true">
                                 <SA class="SyncDbSingleQuery" dataSource="jdbc/whitelist" varPrefix="imeiClaim_">SELECT counter FROM fsd_discount_imei_counter WHERE discount_id = '[get_discount_id]' AND imei = '[imei]'</SA>
                                 <SA class="SyncIf" var="imeiClaim_counter" compare="null" negation="true">
                                    <SA id="remainingImeiClaimDiscId" class="SyncAssertExpression" var="imeiClaim_counter" operator="&lt;" value="[maksImeiClaimDiscId]" saveValue="true"/>
                                    <SA class="SyncIf" var="remainingImeiClaimDiscId" compare="1" negation="true">
                                       <SA class="SyncAssignVariable" var="allowGetDiscId" value="FALSE"/>
                                    </SA>
                                 </SA>
                              </SA>
                           </SA>
                        </SA>
                        <!--counting imei without whitelist-->
                        <SA class="SyncIf" var="product_check_imei_discount" compare="1" negation="true">
                           <SA class="SyncIf" var="discount_flag" compare="|null|NULL" negation="true">
                              <SA class="JsonParse" var="jsonflag" input="[discount_flag]"/>
                              <SA class="SyncIf" var="jsonflag.checkImei" compare="|null|NULL" negation="true">
                                 <SA class="SyncAssignVariable" var="imei" value="[getDSP.imei]"/>
                                 <SA class="SyncAssignVariable" var="counterImeiWithoutWhitelist" value="[jsonflag.checkImei]"/>
                                 <SA class="SyncAssignVariable" var="get_valTable" value="discI"/>
                                 <SA class="SyncAssignVariable" var="maksImeiClaimDiscId" value="{dbconfig:fsd.[get_discount_id].maksImeiClaimDiscId}"/>
                                 <SA class="SyncIf" var="maksImeiClaimDiscId" compare="|null">
                                    <SA class="SyncAssignVariable" var="maksImeiClaimDiscId" value="0"/>
                                 </SA>
                                 <SA class="SyncIf" var="maksImeiClaimDiscId" compare="0" negation="true">
                                    <SA class="SyncDbSingleQuery" dataSource="jdbc/whitelist" varPrefix="imeiClaim_">SELECT counter FROM fsd_discount_imei_counter WHERE discount_id = '[get_discount_id]' AND imei = '[imei]'</SA>
                                    <SA class="SyncIf" var="imeiClaim_counter" compare="null" negation="true">
                                       <SA id="remainingImeiClaimDiscId" class="SyncAssertExpression" var="imeiClaim_counter" operator="&lt;" value="[maksImeiClaimDiscId]" saveValue="true"/>
                                       <SA class="SyncIf" var="remainingImeiClaimDiscId" compare="1" negation="true">
                                          <SA class="SyncAssignVariable" var="allowGetDiscId" value="FALSE"/>
                                       </SA>
                                    </SA>
                                 </SA>
                              </SA>
                           </SA>
                        </SA>
                        <SA class="SyncIf" var="allowGetDiscId" compare="TRUE">
                           <!--Verify Maks Quota Discount-->
                           <SA class="SyncIf" var="discount_maxCount" compare="0" negation="true">
                              <SA class="SyncDbSingleQuery" dataSource="jdbc/reflex" varPrefix="fpdc_">SELECT counter, reset_date FROM fsd_product_discount_counter WHERE product_id = '[product_product_id]' AND discount_id = '[get_discount_id]'</SA>
                              <SA class="SyncIf" var="fpdc_counter" compare="null" negation="true">
                                 <SA class="SyncAssignVariable" var="curCounterDisc||maxCounterDisc" value="[fpdc_counter]||[discount_maxCount]"/>
                                 <SA id="remainingQuotaDiscId" class="SyncAssertExpression" var="fpdc_counter" operator="&lt;" value="[discount_maxCount]" saveValue="true"/>
                                 <SA class="SyncIf" var="remainingQuotaDiscId" compare="1" negation="true">
                                    <SA class="SyncAssignVariable" var="allowGetDiscId" value="FALSE"/>
                                 </SA>
                              </SA>
                           </SA>
                           <SA class="SyncIf" var="allowGetDiscId" compare="TRUE">
                              <!--Assignment Parameter Provisioning LEVEL Discount-->
                              <SA class="SyncSwitch" input="isMkios">
                                 <case code="TRUE">
                                    <SA class="SyncExplode" var="m" input="[discount_charge_appsid]" separator="\|"/>
                                    <SA class="SyncAssignVariable" var="chargeAppsid" value="[m.0]"/>
                                    <SA class="JsonParse" var="json" input="[m.1]"/>
                                    <SA class="SyncIf" var="json.productId" compare="|null|NULL" negation="true">
                                       <SA class="SyncAssignVariable" var="mkios_productId" value="[json.productId]"/>
                                       <SA class="SyncAssignVariable" var="mkios_denom" value="[json.denom]"/>
                                       <SA class="SyncAssignVariable" var="mkios_interval" value="[json.interval]"/>
                                    </SA>
                                 </case>
                                 <case code="default">
                                    <SA class="SyncAssignVariable" var="chargeAppsid" value="[discount_charge_appsid]"/>
                                 </case>
                              </SA>
                              <SA class="SyncAssignVariable" var="chargePassword" value="[discount_charge_password]"/>
                              <SA class="SyncAssignVariable" var="nominal" value="[discount_nominal]"/>
                              <SA class="SyncSwitch" input="category">
                                 <case code="RECHARGE">
                                    <SA class="SyncExplode" var="r" input="[discount_bonus_appsid]" separator="\|"/>
                                    <SA class="SyncAssignVariable" var="bonusAppsid" value="[r.0]"/>
                                    <SA class="JsonParse" var="json" input="[r.1]"/>
                                    <SA class="SyncIf" var="json.productId" compare="|null|NULL" negation="true">
                                       <SA class="SyncAssignVariable" var="recharge_reseller" value="[json.reseller]"/>
                                       <SA class="SyncAssignVariable" var="recharge_denom" value="[json.denom]"/>
                                       <SA class="SyncAssignVariable" var="recharge_productId" value="[json.productId]"/>
                                    </SA>
                                 </case>
                                 <case code="default">
                                    <SA class="SyncAssignVariable" var="bonusAppsid" value="[discount_bonus_appsid]"/>
                                    <!--NEW VAR SAPC-->
                                    <SA class="SyncAssignVariable" var="ProvSapcPackage" value="[discount_sapc_package]"/>
                                    <SA class="SyncAssignVariable" var="ProvAddSapcPackage" value="[discount_additional_sapc_package]"/>
                                    <SA class="SyncIf" var="ProvSapcPackage" compare="|null|NULL">
                                       <SA class="SyncAssignVariable" var="ProvSapcPackage" value="[product_sapc_package]"/>
                                    </SA>
                                    <SA class="SyncIf" var="ProvAddSapcPackage" compare="|null|NULL">
                                       <SA class="SyncAssignVariable" var="ProvAddSapcPackage" value="[product_additional_sapc_package]"/>
                                    </SA>
                                 </case>
                              </SA>
                              <SA class="SyncAssignVariable" var="bonusPassword" value="[discount_bonus_password]"/>
                              <SA class="SyncAssignVariable" var="product_volume" value="[discount_volume]"/>
                              <SA class="SyncAssignVariable" var="product_product_length" value="[discount_product_length]"/>
                              <SA class="SyncAssignVariable" var="interval" value="[discount_product_length]"/>
                              <SA class="SyncAssignVariable" var="discount_id" value="[discount_discount_id]"/>
                              <SA id="ExplodeChunk" class="SyncExplode" separator="\|" var="aBizDesc" input="[discount_biz_desc]"/>
                              <SA class="SyncAssignVariable" var="product_biz_desc" value="[aBizDesc.0]"/>
                              <!--Add Task-->
                              <SA class="SyncAssignVariable" var="product_added_task" value="[discount_added_task]"/>
                              <!--Get Parameter for Multi Offer-->
                              <SA class="SyncIf" var="discount_multi_offer" compare="null" negation="true">
                                 <SA class="JsonParse" var="json" input="[discount_multi_offer]"/>
                                 <SA class="SyncIf" var="json.bonus_appsid2" compare="|null|NULL" negation="true">
                                    <SA class="SyncAssignVariable" var="bonusAppsid2" value="[json.bonus_appsid2]"/>
                                    <SA class="SyncAssignVariable" var="bonusPassword2" value="[json.bonus_password2]"/>
                                 </SA>
                                 <SA class="SyncIf" var="json.bonus_appsid3" compare="|null|NULL" negation="true">
                                    <SA class="SyncAssignVariable" var="bonusAppsid3" value="[json.bonus_appsid3]"/>
                                    <SA class="SyncAssignVariable" var="bonusPassword3" value="[json.bonus_password3]"/>
                                 </SA>
                                 <SA class="SyncIf" var="json.bonus_appsid4" compare="|null|NULL" negation="true">
                                    <SA class="SyncAssignVariable" var="bonusAppsid4" value="[json.bonus_appsid4]"/>
                                    <SA class="SyncAssignVariable" var="bonusPassword4" value="[json.bonus_password4]"/>
                                    <SA class="SyncAssignVariable" var="bonus_volume" value="[json.bonus4_volume]"/>
                                 </SA>
                                 <SA class="SyncIf" var="json.bonus_appsid5" compare="|null|NULL" negation="true">
                                    <SA class="SyncAssignVariable" var="bonusAppsid5" value="[json.bonus_appsid5]"/>
                                    <SA class="SyncAssignVariable" var="bonusPassword5" value="[json.bonus_password5]"/>
                                 </SA>
                                 <SA class="SyncIf" var="json.bonus_appsid6" compare="|null|NULL" negation="true">
                                    <SA class="SyncAssignVariable" var="bonusAppsid6" value="[json.bonus_appsid6]"/>
                                    <SA class="SyncAssignVariable" var="bonusPassword6" value="[json.bonus_password6]"/>
                                 </SA>
                                 <!--Set Conf ON/OFF-->
                                 <SA class="SyncAssignVariable" var="isMultiOffer" value="{dbconfig:fsd.param.isMultiOffer}"/>
                                 <SA class="SyncIf" var="isMultiOffer" compare="ON">
                                    <SA class="SyncIf" var="json.bonus_appsid7" compare="|null|NULL" negation="true">
                                       <SA class="SyncAssignVariable" var="bonusAppsid7" value="[json.bonus_appsid7]"/>
                                       <SA class="SyncAssignVariable" var="bonusPassword7" value="[json.bonus_password7]"/>
                                    </SA>
                                    <SA class="SyncIf" var="json.bonus_appsid8" compare="|null|NULL" negation="true">
                                       <SA class="SyncAssignVariable" var="bonusAppsid8" value="[json.bonus_appsid8]"/>
                                       <SA class="SyncAssignVariable" var="bonusPassword8" value="[json.bonus_password8]"/>
                                    </SA>
                                    <SA class="SyncIf" var="json.bonus_appsid9" compare="|null|NULL" negation="true">
                                       <SA class="SyncAssignVariable" var="bonusAppsid9" value="[json.bonus_appsid9]"/>
                                       <SA class="SyncAssignVariable" var="bonusPassword9" value="[json.bonus_password9]"/>
                                    </SA>
                                 </SA>
                                 <SA class="SyncIf" var="json.bonus_extendAppsid" compare="|null|NULL" negation="true">
                                    <SA class="SyncAssignVariable" var="bonusExtendAppsid" value="[json.bonus_extendAppsid]"/>
                                    <SA class="SyncAssignVariable" var="bonusExtendPassword" value="[json.bonus_extendPassword]"/>
                                    <SA class="INPlugin" id="balance" saveValue="true" Type="balance" bMsisdn="[bonusMsisdn]" InpluginTimeout="{dbconfig:InpluginTimeout}"/>
                                    <SA class="SyncIf" var="balance" compare="2" negation="true">
                                       <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="FI03||[balance]||error while checking balance||{dbconfig:fsd.[category].notif.syserror}_-_[additional_notif_flu]"/>
                                       <SA class="SyncIf" var="isFlu" compare="1">
                                          <SA class="SyncAssignVariable" var="SMS" value="NOSMS"/>
                                       </SA>
                                       <SA class="SyncTempRequest" service="FSD" option="remove"/>
                                       <SA class="SyncBreak"/>
                                    </SA>
                                    <SA class="SyncAssignVariable" var="alreadyCheckBalance" value="TRUE"/>
                                    <SA class="SyncIf" var="balance.active" compare="0">
                                       <SA class="SyncIf" var="command" compare="GIFT|MKIOS" negation="true">
                                          <!--grace-->
                                          <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="OK01||notActive||grace number||{dbconfig:fsd.notif.[notifCommand]notActive}"/>
                                          <SA class="SyncIf" var="isFlu" compare="1">
                                             <SA class="SyncAssignVariable" var="SMS" value="NOSMS"/>
                                          </SA>
                                          <SA class="SyncTempRequest" service="FSD" option="remove"/>
                                          <SA class="SyncBreak"/>
                                       </SA>
                                    </SA>
                                    <!--Get active date yyyy-MM-dd-->
                                    <SA class="SyncAssignVariable" var="activeDate" value="[balance.activeDate]"/>
                                    <SA class="SyncSwitch" input="isMkios">
                                       <case code="TRUE">
                                          <SA class="SyncAssignVariable" var="extendLifeCycle" value="TRUE"/>
                                          <SA class="SyncIf" var="balance.active" compare="0">
                                             <SA class="DateUtility" id="today" saveValue="true" Option="Today" Param1="yyyy-MM-dd" Param2="yyyy-MM-dd"/>
                                             <!--<SA class="DateUtility" id="newActiveDate" saveValue="true" Option="add_date2" Param1="yyyy-MM-dd" Param2="yyyy-MM-dd" Param5="[today]" Param6="[mkios_interval]"/>-->
                                             <SA Input2="1" Input1="[mkios_interval]" Operator="+" Msisdn="" id="newAddLifeCycle" saveValue="True" Information="" class="Arithmetic"/>
                                             <SA class="DateUtility" id="newActiveDate" saveValue="true" Option="add_date2" Param1="yyyy-MM-dd" Param2="yyyy-MM-dd" Param5="[today]" Param6="[newAddLifeCycle]"/>
                                          </SA>
                                          <SA class="SyncIf" var="balance.active" compare="0" negation="true">
                                             <!--Get date next years-->
                                             <SA class="DateUtility" id="dateNextYear" saveValue="true" Option="date_next_year" Param2="yyyy-MM-dd"/>
                                             <!--<SA class="DateUtility" id="newActiveDate" saveValue="true" Option="add_date2" Param1="yyyy-MM-dd" Param2="yyyy-MM-dd" Param5="[activeDate]" Param6="[mkios_interval]"/>-->
                                             <SA Input2="1" Input1="[mkios_interval]" Operator="+" Msisdn="" id="newAddLifeCycle" saveValue="True" Information="" class="Arithmetic"/>
                                             <SA class="DateUtility" id="newActiveDate" saveValue="true" Option="add_date2" Param1="yyyy-MM-dd" Param2="yyyy-MM-dd" Param5="[today]" Param6="[newAddLifeCycle]"/>
                                             <SA id="ActiveStatus" class="DateUtility" Option="is_expired2" Param5="[newActiveDate]" Param3="[activeDate]" saveValue="true"/>
                                             <SA class="SyncIf" var="ActiveStatus" compare="1" negation="true">
                                                <SA class="SyncAssignVariable" var="extendLifeCycle" value="FALSE"/>
                                                <SA class="SyncAssignVariable" var="bonusExtend" value="notExtend"/>
                                             </SA>
                                             <SA class="SyncIf" var="ActiveStatus" compare="1">
                                                <SA id="ActiveStatus2" class="DateUtility" Option="is_expired2" Param5="[newActiveDate]" Param3="[dateNextYear]" saveValue="true"/>
                                                <SA class="SyncIf" var="ActiveStatus2" compare="1" negation="true">
                                                   <SA class="SyncAssignVariable" var="extendLifeCycle" value="FALSE"/>
                                                   <SA class="SyncAssignVariable" var="bonusExtend" value="notExtend"/>
                                                </SA>
                                             </SA>
                                          </SA>
                                       </case>
                                       <case code="default">
                                          <SA class="DateUtility" id="today" saveValue="true" Option="Today" Param1="yyyy-MM-dd" Param2="yyyy-MM-dd"/>
                                          <!--<SA class="DateUtility" id="newActiveDate" saveValue="true" Option="add_date2" Param1="yyyy-MM-dd" Param2="yyyy-MM-dd" Param5="[today]" Param6="[interval]"/>-->
                                          <SA Input2="1" Input1="[interval]" Operator="+" Msisdn="" id="newAddLifeCycle" saveValue="True" Information="" class="Arithmetic"/>
                                          <SA class="DateUtility" id="newActiveDate" saveValue="true" Option="add_date2" Param1="yyyy-MM-dd" Param2="yyyy-MM-dd" Param5="[today]" Param6="[newAddLifeCycle]"/>
                                          <SA id="ActiveStatus" class="DateUtility" Option="is_expired2" Param5="[newActiveDate]" Param3="[activeDate]" saveValue="true"/>
                                          <SA class="SyncAssignVariable" var="extendLifeCycle" value="TRUE"/>
                                          <SA class="SyncIf" var="ActiveStatus" compare="1" negation="true">
                                             <SA class="SyncAssignVariable" var="extendLifeCycle" value="FALSE"/>
                                             <SA class="SyncAssignVariable" var="bonusExtend" value="notExtend"/>
                                          </SA>
                                       </case>
                                    </SA>
                                 </SA>
                                 <SA class="SyncIf" var="json.act_status_nbp" compare="|null|NULL" negation="true">
                                    <SA class="SyncAssignVariable" var="actStatusNbp" value="NULL"/>
                                    <!--Reset Value actStatusNbp-->
                                    <SA class="DateUtility" id="todayNBP" saveValue="true" Option="Today" Param1="yyyy-MM-dd" Param2="yyyy-MM-dd"/>
                                    <SA class="SyncAssignVariable" var="actStatusNbp" value="[json.act_status_nbp]"/>
                                    <SA class="SyncAssignVariable" var="actAdnNbp" value="[json.act_adn_nbp]"/>
                                 </SA>
                                 <SA class="SyncIf" var="json.act_status_nbp2" compare="|null|NULL" negation="true">
                                    <SA class="SyncAssignVariable" var="actStatusNbp2" value="NULL"/>
                                    <!--Reset Value actStatusNbp2-->
                                    <SA class="DateUtility" id="todayNBP" saveValue="true" Option="Today" Param1="yyyy-MM-dd" Param2="yyyy-MM-dd"/>
                                    <SA class="SyncAssignVariable" var="actStatusNbp2" value="[json.act_status_nbp2]"/>
                                    <SA class="SyncAssignVariable" var="actAdnNbp2" value="[json.act_adn_nbp2]"/>
                                 </SA>
                                 <SA class="SyncIf" var="json.act_status_nbp3" compare="|null|NULL" negation="true">
                                    <SA class="SyncAssignVariable" var="actStatusNbp3" value="NULL"/>
                                    <!--Reset Value actStatusNbp3-->
                                    <SA class="DateUtility" id="todayNBP" saveValue="true" Option="Today" Param1="yyyy-MM-dd" Param2="yyyy-MM-dd"/>
                                    <SA class="SyncAssignVariable" var="actStatusNbp3" value="[json.act_status_nbp3]"/>
                                    <SA class="SyncAssignVariable" var="actAdnNbp3" value="[json.act_adn_nbp3]"/>
                                 </SA>
                                 <SA class="SyncIf" var="json.act_status_nbp4" compare="|null|NULL" negation="true">
                                    <SA class="SyncAssignVariable" var="actStatusNbp4" value="NULL"/>
                                    <!--Reset Value actStatusNbp4-->
                                    <SA class="DateUtility" id="todayNBP" saveValue="true" Option="Today" Param1="yyyy-MM-dd" Param2="yyyy-MM-dd"/>
                                    <SA class="SyncAssignVariable" var="actStatusNbp4" value="[json.act_status_nbp4]"/>
                                    <SA class="SyncAssignVariable" var="actAdnNbp4" value="[json.act_adn_nbp4]"/>
                                 </SA>
                                 <SA class="SyncIf" var="json.act_status_nbp5" compare="|null|NULL" negation="true">
                                    <SA class="SyncAssignVariable" var="actStatusNbp5" value="NULL"/>
                                    <!--Reset Value actStatusNbp5-->
                                    <SA class="DateUtility" id="todayNBP" saveValue="true" Option="Today" Param1="yyyy-MM-dd" Param2="yyyy-MM-dd"/>
                                    <SA class="SyncAssignVariable" var="actStatusNbp5" value="[json.act_status_nbp5]"/>
                                    <SA class="SyncAssignVariable" var="actAdnNbp5" value="[json.act_adn_nbp5]"/>
                                 </SA>
                              </SA>
                              <SA class="SyncAssignVariable" var="product_wording_success" value="[discount_wording_success]"/>
                           </SA>
                        </SA>
                     </SA>
                  </SA>
               </SA>
            </SA>
         </SA>
         <SA class="SyncIf" var="isNEWWL" compare="TRUE">
            <SA class="SyncIf" var="counter_counter" compare="-1" negation="true">
               <SA class="SyncDbSingleQuery" dataSource="jdbc/whitelist" varPrefix="discount_">SELECT *, bonus_appsid_[prepaidType] AS bonus_appsid 
						FROM fsd_discount 
						WHERE product_id='[product_product_id]' 
						AND (CURDATE() BETWEEN start_date AND end_date) 
						AND (target='ALL' OR target LIKE CONCAT('%|','[counter_counter]', '|%'))
						AND (pricePlan='ALL' OR pricePlan LIKE CONCAT('%|','[pricePlan]', '|%'))
						AND (eligible_days='ALL' OR eligible_days LIKE CONCAT('%|','[dayToday]', '|%'))						
						AND newwl_id_imei IN ([imei_wl])
						AND newwl_id_msisdn IN ([msisdn_wl]) 
						AND newwl_id_location IN ([loc_wl])
						ORDER BY priority DESC, discount_id ASC</SA>
               <SA class="SyncIf" var="discount_rule" compare="|null|NULL" negation="true">
                  <SA class="JsonParse" var="jsonrulediscount" input="[discount_rule]"/>
                  <SA class="SyncIf" var="schema" compare="XGETY">
                     <SA class="SyncIf" var="XGETYisReset" compare="FALSE">
                        <SA class="SyncIf" var="jsonrulediscount.reset_counter" compare="|null|NULL" negation="true">
                           <SA Input1="[jsonrulediscount.reset_counter]" Input2="1" Operator="-" Msisdn="" id="thresholdxgety" saveValue="True" Information="" class="Arithmetic"/>
                           <SA id="isExceedThreshold" class="SyncAssertExpression" var="counter_counter" operator=">" value="[thresholdxgety]" saveValue="true"/>
                           <SA class="SyncIf" var="isExceedThreshold" compare="1">
                              <SA class="SyncAssignVariable" var="XGETYisReset" value="TRUE"/>
                              <SA class="SyncAssignVariable" var="counter_counter" value="1"/>
                              <SA class="SyncDbSingleQuery" dataSource="jdbc/whitelist" varPrefix="discount_">SELECT *, bonus_appsid_[prepaidType] AS bonus_appsid 
												FROM fsd_discount 
												WHERE product_id='[product_product_id]' 
												AND (CURDATE() BETWEEN start_date AND end_date) 
												AND (target='ALL' OR target LIKE CONCAT('%|','[counter_counter]', '|%'))
												AND (pricePlan='ALL' OR pricePlan LIKE CONCAT('%|','[pricePlan]', '|%'))
												AND (eligible_days='ALL' OR eligible_days LIKE CONCAT('%|','[dayToday]', '|%'))						
												AND newwl_id_imei IN ([imei_wl])
												AND newwl_id_msisdn IN ([msisdn_wl]) 
												AND newwl_id_location IN ([loc_wl])
												ORDER BY priority DESC, discount_id ASC</SA>
                           </SA>
                        </SA>
                     </SA>
                  </SA>
                  <SA class="SyncIf" var="counter_counter" compare="[jsonrulediscount.reminder1]">
                     <SA class="SyncAssignVariable" var="discount_wording_success" value="[discount_wording_success], [jsonrulediscount.reminder_wording1]"/>
                  </SA>
                  <SA class="SyncIf" var="counter_counter" compare="[jsonrulediscount.reminder2]">
                     <SA class="SyncAssignVariable" var="discount_wording_success" value="[discount_wording_success], [jsonrulediscount.reminder_wording2]"/>
                  </SA>
                  <SA class="SyncIf" var="counter_counter" compare="[jsonrulediscount.reminder3]">
                     <SA class="SyncAssignVariable" var="discount_wording_success" value="[discount_wording_success], [jsonrulediscount.reminder_wording3]"/>
                  </SA>
                  <SA class="SyncAssignVariable" var="get_discount_id" value="[discount_discount_id]"/>
                  <SA class="SyncAssignVariable" var="counterXgetY" value="[counter_counter]"/>
                  <!--Check New Imei Discount-->
                  <SA class="SyncIf" var="discount_check_new_imei" compare="|null|NULL" negation="true">
                     <SA class="SyncExplode" var="c" input="[discount_check_new_imei]" separator="\|"/>
                     <SA class="SyncAssignVariable" var="queryNewImei" value="[c.0]"/>
                     <SA class="SyncAssignVariable" var="provOldImei" value="[c.1]"/>
                     <SA class="SyncIf" var="provOldImei" compare="1">
                        <SA class="SyncIf" var="imei" compare="|null|NULL">
                           <SA class="SyncAssignVariable" var="add.imei" value="[getDSP.imei]"/>
                           <SA class="SyncIf" var="getDSP.imei" compare="|null|NULL">
                              <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="FR09||imeiNotFound||[getDSP.imei]||{dbconfig:fsd.[category].notif.[notifCommand]notAllowImei}_-_[additional_notif_flu]"/>
                              <SA class="SyncIf" var="isFlu" compare="1">
                                 <SA class="SyncAssignVariable" var="SMS" value="NOSMS"/>
                              </SA>
                              <SA class="SyncTempRequest" service="FSD" option="remove"/>
                              <SA class="SyncBreak"/>
                           </SA>
                           <SA class="SyncAssignVariable" var="imei" value="[add.imei]"/>
                        </SA>
                     </SA>
                     <SA class="SyncIf" var="queryNewImei" compare="1">
                        <!--Check is New Imei-->
                        <SA class="SyncSwitch" input="getDSP.newImeiFlag">
                           <case code="1">
                              <!--Check Device is 3G-->
                              <SA class="SyncAssignVariable" var="is3G" value="HSUPA:[getDSP.hsupa]-UMTS:[getDSP.umts]-HSDPA:[getDSP.hsdpa]-EDGE:[getDSP.edge]-LTE:[getDSP.lte]"/>
                              <SA class="SyncIf" var="is3G" compare="{dbconfig:fsd.network.3G.categories}" negation="true">
                                 <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="OK01||not3GDevice||[is3G]||{dbconfig:fsd.[category].notif.[notifCommand]not3GDevice}_-_[additional_notif_flu]"/>
                                 <SA class="SyncIf" var="isFlu" compare="1">
                                    <SA class="SyncAssignVariable" var="SMS" value="NOSMS"/>
                                 </SA>
                                 <SA class="SyncTempRequest" service="FSD" option="remove"/>
                                 <SA class="SyncBreak"/>
                              </SA>
                           </case>
                           <case code="0">
                              <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="OK01||notNewImei||[getDSP.newImeiFlag]||{dbconfig:fsd.[category].notif.[notifCommand]notNewImei}_-_[additional_notif_flu]"/>
                              <SA class="SyncIf" var="isFlu" compare="1">
                                 <SA class="SyncAssignVariable" var="SMS" value="NOSMS"/>
                              </SA>
                              <SA class="SyncTempRequest" service="FSD" option="remove"/>
                              <SA class="SyncBreak"/>
                           </case>
                           <case code="default">
                              <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="FR09||newImeiNotFound||[getDSP.newImeiFlag]||{dbconfig:fsd.[category].notif.[notifCommand]notNewImei}_-_[additional_notif_flu]"/>
                              <SA class="SyncIf" var="isFlu" compare="1">
                                 <SA class="SyncAssignVariable" var="SMS" value="NOSMS"/>
                              </SA>
                              <SA class="SyncTempRequest" service="FSD" option="remove"/>
                              <SA class="SyncBreak"/>
                           </case>
                        </SA>
                     </SA>
                  </SA>
                  <!--Validate Time Frame-->
                  <SA class="SyncAssignVariable" var="timeframeValid" value="1"/>
                  <SA class="SyncIf" var="discount_timeframe" compare="null|ALL" negation="true">
                     <SA class="SyncExplode" var="t" input="[discount_timeframe]" separator="-"/>
                     <SA class="TimeFrameValidation" newModel="1" TimeStart="[t.0]" TimeEnd="[t.1]" TimeZone="0" id="timeframe"/>
                     <SA class="SyncIf" var="timeframe" compare="0">
                        <SA class="SyncAssignVariable" var="timeframeValid" value="0"/>
                     </SA>
                  </SA>
                  <SA class="SyncIf" var="timeframeValid" compare="1">
                     <SA class="SyncAssignVariable" var="allowGetDiscId" value="TRUE"/>
                     <!--Verify IMEI-->
                     <SA class="SyncIf" var="product_check_imei_discount" compare="1">
                        <SA class="SyncIf" var="get_valTable" compare="discIML|discIML2|discIM|discIM2|discI|discI2|discIL|discIL2">
                           <SA class="SyncAssignVariable" var="maksImeiClaimDiscId" value="{dbconfig:fsd.[get_discount_id].maksImeiClaimDiscId}"/>
                           <SA class="SyncIf" var="maksImeiClaimDiscId" compare="|null">
                              <SA class="SyncAssignVariable" var="maksImeiClaimDiscId" value="-1"/>
                           </SA>
                           <SA class="SyncIf" var="maksImeiClaimDiscId" compare="-1" negation="true">
                              <SA class="SyncDbSingleQuery" dataSource="jdbc/whitelist" varPrefix="imeiClaim_">SELECT counter FROM fsd_discount_imei_counter WHERE discount_id = '[get_discount_id]' AND imei = '[imei]'</SA>
                              <SA class="SyncIf" var="imeiClaim_counter" compare="null" negation="true">
                                 <SA id="remainingImeiClaimDiscId" class="SyncAssertExpression" var="imeiClaim_counter" operator="&lt;" value="[maksImeiClaimDiscId]" saveValue="true"/>
                                 <SA class="SyncIf" var="remainingImeiClaimDiscId" compare="1" negation="true">
                                    <SA class="SyncAssignVariable" var="allowGetDiscId" value="FALSE"/>
                                 </SA>
                              </SA>
                           </SA>
                        </SA>
                     </SA>
                     <SA class="SyncIf" var="allowGetDiscId" compare="TRUE">
                        <!--Verify Maks Quota Discount-->
                        <SA class="SyncIf" var="discount_maxCount" compare="0" negation="true">
                           <SA class="SyncDbSingleQuery" dataSource="jdbc/reflex" varPrefix="fpdc_">SELECT counter, reset_date FROM fsd_product_discount_counter WHERE product_id = '[product_product_id]' AND discount_id = '[get_discount_id]'</SA>
                           <SA class="SyncIf" var="fpdc_counter" compare="null" negation="true">
                              <SA class="SyncAssignVariable" var="curCounterDisc||maxCounterDisc" value="[fpdc_counter]||[discount_maxCount]"/>
                              <SA id="remainingQuotaDiscId" class="SyncAssertExpression" var="fpdc_counter" operator="&lt;" value="[discount_maxCount]" saveValue="true"/>
                              <SA class="SyncIf" var="remainingQuotaDiscId" compare="1" negation="true">
                                 <SA class="SyncAssignVariable" var="allowGetDiscId" value="FALSE"/>
                              </SA>
                           </SA>
                        </SA>
                        <SA class="SyncIf" var="allowGetDiscId" compare="TRUE">
                           <!--Assignment Parameter Provisioning LEVEL Discount-->
                           <SA class="SyncSwitch" input="isMkios">
                              <case code="TRUE">
                                 <SA class="SyncExplode" var="m" input="[discount_charge_appsid]" separator="\|"/>
                                 <SA class="SyncAssignVariable" var="chargeAppsid" value="[m.0]"/>
                                 <SA class="JsonParse" var="json" input="[m.1]"/>
                                 <SA class="SyncIf" var="json.productId" compare="|null|NULL" negation="true">
                                    <SA class="SyncAssignVariable" var="mkios_productId" value="[json.productId]"/>
                                    <SA class="SyncAssignVariable" var="mkios_denom" value="[json.denom]"/>
                                    <SA class="SyncAssignVariable" var="mkios_interval" value="[json.interval]"/>
                                 </SA>
                              </case>
                              <case code="default">
                                 <SA class="SyncAssignVariable" var="chargeAppsid" value="[discount_charge_appsid]"/>
                              </case>
                           </SA>
                           <SA class="SyncAssignVariable" var="chargePassword" value="[discount_charge_password]"/>
                           <SA class="SyncAssignVariable" var="nominal" value="[discount_nominal]"/>
                           <SA class="SyncSwitch" input="category">
                              <case code="RECHARGE">
                                 <SA class="SyncExplode" var="r" input="[discount_bonus_appsid]" separator="\|"/>
                                 <SA class="SyncAssignVariable" var="bonusAppsid" value="[r.0]"/>
                                 <SA class="JsonParse" var="json" input="[r.1]"/>
                                 <SA class="SyncIf" var="json.productId" compare="|null|NULL" negation="true">
                                    <SA class="SyncAssignVariable" var="recharge_reseller" value="[json.reseller]"/>
                                    <SA class="SyncAssignVariable" var="recharge_denom" value="[json.denom]"/>
                                    <SA class="SyncAssignVariable" var="recharge_productId" value="[json.productId]"/>
                                 </SA>
                              </case>
                              <case code="default">
                                 <SA class="SyncAssignVariable" var="bonusAppsid" value="[discount_bonus_appsid]"/>
                                 <!--NEW VAR SAPC-->
                                 <SA class="SyncAssignVariable" var="ProvSapcPackage" value="[discount_sapc_package]"/>
                                 <SA class="SyncAssignVariable" var="ProvAddSapcPackage" value="[discount_additional_sapc_package]"/>
                                 <SA class="SyncIf" var="ProvSapcPackage" compare="|null|NULL">
                                    <SA class="SyncAssignVariable" var="ProvSapcPackage" value="[product_sapc_package]"/>
                                 </SA>
                                 <SA class="SyncIf" var="ProvAddSapcPackage" compare="|null|NULL">
                                    <SA class="SyncAssignVariable" var="ProvAddSapcPackage" value="[product_additional_sapc_package]"/>
                                 </SA>
                              </case>
                           </SA>
                           <SA class="SyncAssignVariable" var="bonusPassword" value="[discount_bonus_password]"/>
                           <SA class="SyncAssignVariable" var="product_volume" value="[discount_volume]"/>
                           <SA class="SyncAssignVariable" var="product_product_length" value="[discount_product_length]"/>
                           <SA class="SyncAssignVariable" var="interval" value="[discount_product_length]"/>
                           <SA class="SyncAssignVariable" var="discount_id" value="[discount_discount_id]"/>
                           <SA id="ExplodeChunk" class="SyncExplode" separator="\|" var="aBizDesc" input="[discount_biz_desc]"/>
                           <SA class="SyncAssignVariable" var="product_biz_desc" value="[aBizDesc.0]"/>
                           <!--Add Task-->
                           <SA class="SyncAssignVariable" var="product_added_task" value="[discount_added_task]"/>
                           <!--Get Parameter for Multi Offer-->
                           <SA class="SyncIf" var="discount_multi_offer" compare="null" negation="true">
                              <SA class="JsonParse" var="json" input="[discount_multi_offer]"/>
                              <SA class="SyncIf" var="json.bonus_appsid2" compare="|null|NULL" negation="true">
                                 <SA class="SyncAssignVariable" var="bonusAppsid2" value="[json.bonus_appsid2]"/>
                                 <SA class="SyncAssignVariable" var="bonusPassword2" value="[json.bonus_password2]"/>
                              </SA>
                              <SA class="SyncIf" var="json.bonus_appsid3" compare="|null|NULL" negation="true">
                                 <SA class="SyncAssignVariable" var="bonusAppsid3" value="[json.bonus_appsid3]"/>
                                 <SA class="SyncAssignVariable" var="bonusPassword3" value="[json.bonus_password3]"/>
                              </SA>
                              <SA class="SyncIf" var="json.bonus_appsid4" compare="|null|NULL" negation="true">
                                 <SA class="SyncAssignVariable" var="bonusAppsid4" value="[json.bonus_appsid4]"/>
                                 <SA class="SyncAssignVariable" var="bonusPassword4" value="[json.bonus_password4]"/>
                                 <SA class="SyncAssignVariable" var="bonus_volume" value="[json.bonus4_volume]"/>
                              </SA>
                              <SA class="SyncIf" var="json.bonus_appsid5" compare="|null|NULL" negation="true">
                                 <SA class="SyncAssignVariable" var="bonusAppsid5" value="[json.bonus_appsid5]"/>
                                 <SA class="SyncAssignVariable" var="bonusPassword5" value="[json.bonus_password5]"/>
                              </SA>
                              <SA class="SyncIf" var="json.bonus_appsid6" compare="|null|NULL" negation="true">
                                 <SA class="SyncAssignVariable" var="bonusAppsid6" value="[json.bonus_appsid6]"/>
                                 <SA class="SyncAssignVariable" var="bonusPassword6" value="[json.bonus_password6]"/>
                              </SA>
                              <!--Set Conf ON/OFF-->
                              <SA class="SyncAssignVariable" var="isMultiOffer" value="{dbconfig:fsd.param.isMultiOffer}"/>
                              <SA class="SyncIf" var="isMultiOffer" compare="ON">
                                 <SA class="SyncIf" var="json.bonus_appsid7" compare="|null|NULL" negation="true">
                                    <SA class="SyncAssignVariable" var="bonusAppsid7" value="[json.bonus_appsid7]"/>
                                    <SA class="SyncAssignVariable" var="bonusPassword7" value="[json.bonus_password7]"/>
                                 </SA>
                                 <SA class="SyncIf" var="json.bonus_appsid8" compare="|null|NULL" negation="true">
                                    <SA class="SyncAssignVariable" var="bonusAppsid8" value="[json.bonus_appsid8]"/>
                                    <SA class="SyncAssignVariable" var="bonusPassword8" value="[json.bonus_password8]"/>
                                 </SA>
                                 <SA class="SyncIf" var="json.bonus_appsid9" compare="|null|NULL" negation="true">
                                    <SA class="SyncAssignVariable" var="bonusAppsid9" value="[json.bonus_appsid9]"/>
                                    <SA class="SyncAssignVariable" var="bonusPassword9" value="[json.bonus_password9]"/>
                                 </SA>
                              </SA>
                              <SA class="SyncIf" var="json.bonus_extendAppsid" compare="|null|NULL" negation="true">
                                 <SA class="SyncAssignVariable" var="bonusExtendAppsid" value="[json.bonus_extendAppsid]"/>
                                 <SA class="SyncAssignVariable" var="bonusExtendPassword" value="[json.bonus_extendPassword]"/>
                                 <SA class="INPlugin" id="balance" saveValue="true" Type="balance" bMsisdn="[bonusMsisdn]" InpluginTimeout="{dbconfig:InpluginTimeout}"/>
                                 <SA class="SyncIf" var="balance" compare="2" negation="true">
                                    <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="FI03||[balance]||error while checking balance||{dbconfig:fsd.[category].notif.syserror}_-_[additional_notif_flu]"/>
                                    <SA class="SyncIf" var="isFlu" compare="1">
                                       <SA class="SyncAssignVariable" var="SMS" value="NOSMS"/>
                                    </SA>
                                    <SA class="SyncTempRequest" service="FSD" option="remove"/>
                                    <SA class="SyncBreak"/>
                                 </SA>
                                 <SA class="SyncAssignVariable" var="alreadyCheckBalance" value="TRUE"/>
                                 <SA class="SyncIf" var="balance.active" compare="0">
                                    <SA class="SyncIf" var="command" compare="GIFT|MKIOS" negation="true">
                                       <!--grace-->
                                       <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="OK01||notActive||grace number||{dbconfig:fsd.notif.[notifCommand]notActive}"/>
                                       <SA class="SyncIf" var="isFlu" compare="1">
                                          <SA class="SyncAssignVariable" var="SMS" value="NOSMS"/>
                                       </SA>
                                       <SA class="SyncTempRequest" service="FSD" option="remove"/>
                                       <SA class="SyncBreak"/>
                                    </SA>
                                 </SA>
                                 <!--Get active date yyyy-MM-dd-->
                                 <SA class="SyncAssignVariable" var="activeDate" value="[balance.activeDate]"/>
                                 <SA class="SyncSwitch" input="isMkios">
                                    <case code="TRUE">
                                       <SA class="SyncAssignVariable" var="extendLifeCycle" value="TRUE"/>
                                       <SA class="SyncIf" var="balance.active" compare="0">
                                          <SA class="DateUtility" id="today" saveValue="true" Option="Today" Param1="yyyy-MM-dd" Param2="yyyy-MM-dd"/>
                                          <!--<SA class="DateUtility" id="newActiveDate" saveValue="true" Option="add_date2" Param1="yyyy-MM-dd" Param2="yyyy-MM-dd" Param5="[today]" Param6="[mkios_interval]"/>-->
                                          <SA Input2="1" Input1="[mkios_interval]" Operator="+" Msisdn="" id="newAddLifeCycle" saveValue="True" Information="" class="Arithmetic"/>
                                          <SA class="DateUtility" id="newActiveDate" saveValue="true" Option="add_date2" Param1="yyyy-MM-dd" Param2="yyyy-MM-dd" Param5="[today]" Param6="[newAddLifeCycle]"/>
                                       </SA>
                                       <SA class="SyncIf" var="balance.active" compare="0" negation="true">
                                          <!--Get date next years-->
                                          <SA class="DateUtility" id="dateNextYear" saveValue="true" Option="date_next_year" Param2="yyyy-MM-dd"/>
                                          <!--<SA class="DateUtility" id="newActiveDate" saveValue="true" Option="add_date2" Param1="yyyy-MM-dd" Param2="yyyy-MM-dd" Param5="[activeDate]" Param6="[mkios_interval]"/>-->
                                          <SA Input2="1" Input1="[mkios_interval]" Operator="+" Msisdn="" id="newAddLifeCycle" saveValue="True" Information="" class="Arithmetic"/>
                                          <SA class="DateUtility" id="newActiveDate" saveValue="true" Option="add_date2" Param1="yyyy-MM-dd" Param2="yyyy-MM-dd" Param5="[today]" Param6="[newAddLifeCycle]"/>
                                          <SA id="ActiveStatus" class="DateUtility" Option="is_expired2" Param5="[newActiveDate]" Param3="[activeDate]" saveValue="true"/>
                                          <SA class="SyncIf" var="ActiveStatus" compare="1" negation="true">
                                             <SA class="SyncAssignVariable" var="extendLifeCycle" value="FALSE"/>
                                             <SA class="SyncAssignVariable" var="bonusExtend" value="notExtend"/>
                                          </SA>
                                          <SA class="SyncIf" var="ActiveStatus" compare="1">
                                             <SA id="ActiveStatus2" class="DateUtility" Option="is_expired2" Param5="[newActiveDate]" Param3="[dateNextYear]" saveValue="true"/>
                                             <SA class="SyncIf" var="ActiveStatus2" compare="1" negation="true">
                                                <SA class="SyncAssignVariable" var="extendLifeCycle" value="FALSE"/>
                                                <SA class="SyncAssignVariable" var="bonusExtend" value="notExtend"/>
                                             </SA>
                                          </SA>
                                       </SA>
                                    </case>
                                    <case code="default">
                                       <SA class="DateUtility" id="today" saveValue="true" Option="Today" Param1="yyyy-MM-dd" Param2="yyyy-MM-dd"/>
                                       <!--<SA class="DateUtility" id="newActiveDate" saveValue="true" Option="add_date2" Param1="yyyy-MM-dd" Param2="yyyy-MM-dd" Param5="[today]" Param6="[interval]"/>-->
                                       <SA Input2="1" Input1="[interval]" Operator="+" Msisdn="" id="newAddLifeCycle" saveValue="True" Information="" class="Arithmetic"/>
                                       <SA class="DateUtility" id="newActiveDate" saveValue="true" Option="add_date2" Param1="yyyy-MM-dd" Param2="yyyy-MM-dd" Param5="[today]" Param6="[newAddLifeCycle]"/>
                                       <SA id="ActiveStatus" class="DateUtility" Option="is_expired2" Param5="[newActiveDate]" Param3="[activeDate]" saveValue="true"/>
                                       <SA class="SyncAssignVariable" var="extendLifeCycle" value="TRUE"/>
                                       <SA class="SyncIf" var="ActiveStatus" compare="1" negation="true">
                                          <SA class="SyncAssignVariable" var="extendLifeCycle" value="FALSE"/>
                                          <SA class="SyncAssignVariable" var="bonusExtend" value="notExtend"/>
                                       </SA>
                                    </case>
                                 </SA>
                              </SA>
                              <SA class="SyncIf" var="json.act_status_nbp" compare="|null|NULL" negation="true">
                                 <SA class="SyncAssignVariable" var="actStatusNbp" value="NULL"/>
                                 <!--Reset Value actStatusNbp-->
                                 <SA class="DateUtility" id="todayNBP" saveValue="true" Option="Today" Param1="yyyy-MM-dd" Param2="yyyy-MM-dd"/>
                                 <SA class="SyncAssignVariable" var="actStatusNbp" value="[json.act_status_nbp]"/>
                                 <SA class="SyncAssignVariable" var="actAdnNbp" value="[json.act_adn_nbp]"/>
                              </SA>
                              <SA class="SyncIf" var="json.act_status_nbp2" compare="|null|NULL" negation="true">
                                 <SA class="SyncAssignVariable" var="actStatusNbp2" value="NULL"/>
                                 <!--Reset Value actStatusNbp2-->
                                 <SA class="DateUtility" id="todayNBP" saveValue="true" Option="Today" Param1="yyyy-MM-dd" Param2="yyyy-MM-dd"/>
                                 <SA class="SyncAssignVariable" var="actStatusNbp2" value="[json.act_status_nbp2]"/>
                                 <SA class="SyncAssignVariable" var="actAdnNbp2" value="[json.act_adn_nbp2]"/>
                              </SA>
                              <SA class="SyncIf" var="json.act_status_nbp3" compare="|null|NULL" negation="true">
                                 <SA class="SyncAssignVariable" var="actStatusNbp3" value="NULL"/>
                                 <!--Reset Value actStatusNbp3-->
                                 <SA class="DateUtility" id="todayNBP" saveValue="true" Option="Today" Param1="yyyy-MM-dd" Param2="yyyy-MM-dd"/>
                                 <SA class="SyncAssignVariable" var="actStatusNbp3" value="[json.act_status_nbp3]"/>
                                 <SA class="SyncAssignVariable" var="actAdnNbp3" value="[json.act_adn_nbp3]"/>
                              </SA>
                              <SA class="SyncIf" var="json.act_status_nbp4" compare="|null|NULL" negation="true">
                                 <SA class="SyncAssignVariable" var="actStatusNbp4" value="NULL"/>
                                 <!--Reset Value actStatusNbp4-->
                                 <SA class="DateUtility" id="todayNBP" saveValue="true" Option="Today" Param1="yyyy-MM-dd" Param2="yyyy-MM-dd"/>
                                 <SA class="SyncAssignVariable" var="actStatusNbp4" value="[json.act_status_nbp4]"/>
                                 <SA class="SyncAssignVariable" var="actAdnNbp4" value="[json.act_adn_nbp4]"/>
                              </SA>
                              <SA class="SyncIf" var="json.act_status_nbp5" compare="|null|NULL" negation="true">
                                 <SA class="SyncAssignVariable" var="actStatusNbp5" value="NULL"/>
                                 <!--Reset Value actStatusNbp5-->
                                 <SA class="DateUtility" id="todayNBP" saveValue="true" Option="Today" Param1="yyyy-MM-dd" Param2="yyyy-MM-dd"/>
                                 <SA class="SyncAssignVariable" var="actStatusNbp5" value="[json.act_status_nbp5]"/>
                                 <SA class="SyncAssignVariable" var="actAdnNbp5" value="[json.act_adn_nbp5]"/>
                              </SA>
                           </SA>
                           <SA class="SyncAssignVariable" var="product_wording_success" value="[discount_wording_success]"/>
                        </SA>
                     </SA>
                  </SA>
               </SA>
            </SA>
         </SA>
      </SA>
      <!--Use Parameter Level Product-->
      <SA class="SyncIf" var="chargeAppsid" compare="|null|NULL">
         <!--Get IMEI-->
         <SA class="SyncIf" var="product_check_imei_product" compare="1">
            <SA class="SyncIf" var="imei" compare="|null|NULL">
               <SA class="SyncAssignVariable" var="add.imei" value="[getDSP.imei]"/>
               <SA class="SyncIf" var="getDSP.imei" compare="|null|NULL">
                  <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="FR09||imeiNotFound||[getDSP.imei]||{dbconfig:fsd.[category].notif.[notifCommand]notAllowImei}_-_[additional_notif_flu]"/>
                  <SA class="SyncIf" var="isFlu" compare="1">
                     <SA class="SyncAssignVariable" var="SMS" value="NOSMS"/>
                  </SA>
                  <SA class="SyncTempRequest" service="FSD" option="remove"/>
                  <SA class="SyncBreak"/>
               </SA>
               <SA class="SyncAssignVariable" var="imei" value="[add.imei]"/>
               <SA id="SubstringMessage" class="SyncSubstring" var="tac" input="[imei]" start="0" stop="8"/>
            </SA>
         </SA>
         <!--Get Location Product-->
         <SA class="SyncAssignVariable" var="location.prod" value=""/>
         <SA class="SyncIf" var="product_check_location_product" compare="1">
            <SA class="SyncAssignVariable" var="location.prod" value="[location.home]"/>
         </SA>
         <SA class="SyncSwitch" input="product_sub_category">
            <case code="PRELOAD">
               <SA class="SyncAssignVariable" var="verify_program_name" value=""/>
               <SA class="SyncIf" var="product_check_whitelist_product" compare="1">
                  <SA class="SyncDbSingleQuery" dataSource="jdbc/whitelist" varPrefix="verify_">SELECT msisdn, program_name FROM fsd_product_eligible_whitelist WHERE msisdn='[bonusMsisdn]' AND product_id='[product_product_id]'</SA>
                  <SA class="SyncIf" var="verify_msisdn" compare="|null|NULL">
                     <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="OK01||msisdnNotAllow||not allow msisdn||{dbconfig:fsd.[category].notif.[notifCommand]notAllowMsisdn}"/>
                     <SA class="SyncIf" var="isFlu" compare="1">
                        <SA class="SyncAssignVariable" var="SMS" value="NOSMS"/>
                     </SA>
                     <SA class="SyncTempRequest" service="FSD" option="remove"/>
                     <SA class="SyncBreak"/>
                  </SA>
               </SA>
               <SA class="SyncIf" var="product_check_imei_product" compare="1">
                  <SA class="SyncDbSingleQuery" dataSource="jdbc/whitelist" varPrefix="verify_imei_">SELECT imei FROM fsd_product_imei WHERE imei='[imei]' AND product_id='[product_product_id]'</SA>
                  <SA class="SyncIf" var="verify_imei_imei" compare="|null|NULL">
                     <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="OK01||imeiNotAllow||not allow imei||{dbconfig:fsd.[category].notif.[notifCommand]notAllowImei}"/>
                     <SA class="SyncIf" var="isFlu" compare="1">
                        <SA class="SyncAssignVariable" var="SMS" value="NOSMS"/>
                     </SA>
                     <SA class="SyncTempRequest" service="FSD" option="remove"/>
                     <SA class="SyncBreak"/>
                  </SA>
               </SA>
               <SA class="SyncDbSingleQuery" dataSource="jdbc/whitelist" varPrefix="preload_">SELECT island_id, city_id, volume FROM fsd_preload_location WHERE product_id='[product_product_id]' AND home='[location.prod]'</SA>
               <SA class="SyncSwitch" input="preload_island_id">
                  <case code="|null|NULL"></case>
                  <case code="default">
                     <SA class="SyncDbSingleQuery" dataSource="jdbc/whitelist" varPrefix="island_">SELECT appsid FROM fsd_preload_island WHERE island_id='[preload_island_id]'</SA>
                     <SA class="SyncIf" var="island_appsid" compare="|null|NULL" negation="true">
                        <SA class="JsonParse" var="json" input="[island_appsid]"/>
                        <SA class="SyncIf" var="json.appsid" compare="|null|NULL" negation="true">
                           <SA class="SyncAssignVariable" var="bonusAppsid2" value="[json.appsid]"/>
                           <SA class="SyncAssignVariable" var="bonusPassword2" value="[json.password]"/>
                        </SA>
                        <SA class="SyncIf" var="preload_city_id" compare="|null|NULL" negation="true">
                           <SA class="SyncDbSingleQuery" dataSource="jdbc/whitelist" varPrefix="city_">SELECT appsid FROM fsd_preload_city WHERE city_id='[preload_city_id]'</SA>
                           <SA class="SyncIf" var="city_appsid" compare="|null|NULL" negation="true">
                              <SA class="JsonParse" var="json" input="[city_appsid]"/>
                              <SA class="SyncIf" var="json.appsid" compare="|null|NULL" negation="true">
                                 <SA class="SyncAssignVariable" var="bonusAppsid3" value="[json.appsid]"/>
                                 <SA class="SyncAssignVariable" var="bonusPassword3" value="[json.password]"/>
                              </SA>
                           </SA>
                        </SA>
                        <SA class="SyncAssignVariable" var="product_volume" value="[preload_volume]"/>
                     </SA>
                  </case>
               </SA>
            </case>
            <case code="default">
               <SA class="SyncAssignVariable" var="checkProdIML" value="[product_check_imei_product]-[product_check_whitelist_product]-[product_check_location_product]"/>
               <SA class="SyncIf" var="checkProdIML" compare="1-1-1">
                  <SA class="SyncDbSingleQuery" dataSource="jdbc/whitelist" varPrefix="verify_">(
								SELECT fpm.program_name, fpi.product_id, fp.start_date, 'prodIML' AS valTable
								FROM fsd_product fp, fsd_product_imei fpi, fsd_product_eligible_whitelist fpm, fsd_product_location fpl
								WHERE fp.product_id = fpi.product_id 
									AND fp.product_id = fpm.product_id AND fp.product_id = fpl.product_id AND fp.product_id = '[product_product_id]' AND fpi.imei = '[imei]'
									AND fpm.msisdn = '[bonusMsisdn]' AND fpl.home = '[location.prod]' AND fp.check_location_product = '1' AND fp.check_imei_product = '1' 
									AND fp.check_whitelist_product = '1' AND (CURDATE() BETWEEN fp.start_date AND fp.end_date)
									AND (fp.prepaid_type='ALL' OR fp.prepaid_type LIKE CONCAT('%|','[prepaidType]', '|%')) 
							) UNION (
								SELECT fpm.program_name, fpi.product_id, fp.start_date, 'prodIML2' AS valTable
								FROM fsd_product fp, fsd_product_imei fpi, fsd_product_eligible_whitelist fpm, fsd_product_location fpl
								WHERE fp.product_id = fpi.product_id 
									AND fp.product_id = fpm.product_id AND fp.product_id = fpl.product_id AND fp.product_id = '[product_product_id]' AND fpi.imei = '[tac]'
									AND fpm.msisdn = '[bonusMsisdn]' AND fpl.home = '[location.prod]' AND fp.check_location_product = '1' AND fp.check_imei_product = '1' 
									AND fp.check_whitelist_product = '1' AND (CURDATE() BETWEEN fp.start_date AND fp.end_date)
									AND (fp.prepaid_type='ALL' OR fp.prepaid_type LIKE CONCAT('%|','[prepaidType]', '|%')) 
							) ORDER BY start_date DESC LIMIT 1;</SA>
               </SA>
               <SA class="SyncIf" var="verify_product_id" compare="null">
                  <SA class="SyncDbSingleQuery" dataSource="jdbc/whitelist" varPrefix="verify_">(
								SELECT fpm.program_name, fpi.product_id, fp.start_date, 'prodIM' AS valTable
								FROM fsd_product fp, fsd_product_imei fpi, fsd_product_eligible_whitelist fpm
								WHERE fp.product_id = fpi.product_id 
									AND fp.product_id = fpm.product_id AND fp.product_id = '[product_product_id]' AND fpi.imei = '[imei]'
									AND fpm.msisdn = '[bonusMsisdn]' AND fp.check_location_product is NULL AND fp.check_imei_product = '1' 
									AND fp.check_whitelist_product = '1' AND (CURDATE() BETWEEN fp.start_date AND fp.end_date)
									AND (fp.prepaid_type='ALL' OR fp.prepaid_type LIKE CONCAT('%|','[prepaidType]', '|%')) 
							) UNION (
								SELECT fpm.program_name, fpi.product_id, fp.start_date, 'prodIM2' AS valTable
								FROM fsd_product fp, fsd_product_imei fpi, fsd_product_eligible_whitelist fpm
								WHERE fp.product_id = fpi.product_id 
									AND fp.product_id = fpm.product_id AND fp.product_id = '[product_product_id]' AND fpi.imei = '[tac]'
									AND fpm.msisdn = '[bonusMsisdn]' AND fp.check_location_product is NULL AND fp.check_imei_product = '1' 
									AND fp.check_whitelist_product = '1' AND (CURDATE() BETWEEN fp.start_date AND fp.end_date)
									AND (fp.prepaid_type='ALL' OR fp.prepaid_type LIKE CONCAT('%|','[prepaidType]', '|%')) 
							) UNION (
								SELECT '' AS program_name, fpi.product_id, fp.start_date, 'prodIL' AS valTable
								FROM fsd_product fp, fsd_product_imei fpi, fsd_product_location fpl
								WHERE fp.product_id = fpi.product_id 
									AND fp.product_id = fpl.product_id AND fp.product_id = '[product_product_id]' AND fpi.imei = '[imei]'
									AND fpl.home = '[location.prod]' AND fp.check_location_product = '1' AND fp.check_imei_product = '1' 
									AND fp.check_whitelist_product is NULL AND (CURDATE() BETWEEN fp.start_date AND fp.end_date)
									AND (fp.prepaid_type='ALL' OR fp.prepaid_type LIKE CONCAT('%|','[prepaidType]', '|%')) 
							) UNION (
								SELECT '' AS program_name, fpi.product_id, fp.start_date, 'prodIL2' AS valTable
								FROM fsd_product fp, fsd_product_imei fpi, fsd_product_location fpl
								WHERE fp.product_id = fpi.product_id 
									AND fp.product_id = fpl.product_id AND fp.product_id = '[product_product_id]' AND fpi.imei = '[tac]'
									AND fpl.home = '[location.prod]' AND fp.check_location_product = '1' AND fp.check_imei_product = '1' 
									AND fp.check_whitelist_product is NULL AND (CURDATE() BETWEEN fp.start_date AND fp.end_date)
									AND (fp.prepaid_type='ALL' OR fp.prepaid_type LIKE CONCAT('%|','[prepaidType]', '|%')) 
							) UNION (
								SELECT '' AS program_name, fpi.product_id, fp.start_date, 'prodI' AS valTable
								FROM fsd_product fp, fsd_product_imei fpi
								WHERE fp.product_id = fpi.product_id 
									AND fp.product_id = '[product_product_id]' AND fpi.imei = '[imei]' AND fp.check_location_product is NULL 
									AND fp.check_imei_product = '1' AND fp.check_whitelist_product is NULL 
									AND (CURDATE() BETWEEN fp.start_date AND fp.end_date)
									AND (fp.prepaid_type='ALL' OR fp.prepaid_type LIKE CONCAT('%|','[prepaidType]', '|%')) 
							) UNION (
								SELECT '' AS program_name, fpi.product_id, fp.start_date, 'prodI2' AS valTable
								FROM fsd_product fp, fsd_product_imei fpi
								WHERE fp.product_id = fpi.product_id 
									AND fp.product_id = '[product_product_id]' AND fpi.imei = '[tac]' AND fp.check_location_product is NULL 
									AND fp.check_imei_product = '1' AND fp.check_whitelist_product is NULL 
									AND (CURDATE() BETWEEN fp.start_date AND fp.end_date)
									AND (fp.prepaid_type='ALL' OR fp.prepaid_type LIKE CONCAT('%|','[prepaidType]', '|%')) 
							) UNION (
								SELECT fpm.program_name, fpl.product_id, fp.start_date, 'prodLM' AS valTable
								FROM fsd_product fp, fsd_product_location fpl, fsd_product_eligible_whitelist fpm
								WHERE fp.product_id = fpl.product_id 
									AND fp.product_id = fpm.product_id AND fp.product_id = '[product_product_id]' AND fpl.home = '[location.prod]' 
									AND fpm.msisdn = '[bonusMsisdn]' AND fp.check_location_product = '1' AND fp.check_imei_product is NULL 
									AND fp.check_whitelist_product = '1' AND (CURDATE() BETWEEN fp.start_date AND fp.end_date)
									AND (fp.prepaid_type='ALL' OR fp.prepaid_type LIKE CONCAT('%|','[prepaidType]', '|%')) 
							) UNION (
								SELECT fpm.program_name, fpm.product_id, fp.start_date, 'prodM' AS valTable
								FROM fsd_product fp, fsd_product_eligible_whitelist fpm
								WHERE fp.product_id = fpm.product_id 
									AND fp.product_id = '[product_product_id]' AND fpm.msisdn = '[bonusMsisdn]' AND fp.check_location_product is NULL 
									AND fp.check_imei_product is NULL AND fp.check_whitelist_product = '1' 
									AND (CURDATE() BETWEEN fp.start_date AND fp.end_date)
									AND (fp.prepaid_type='ALL' OR fp.prepaid_type LIKE CONCAT('%|','[prepaidType]', '|%')) 
							) UNION (
								SELECT '' AS program_name, fpl.product_id, fp.start_date, 'prodL' AS valTable
								FROM fsd_product fp, fsd_product_location fpl
								WHERE fp.product_id = fpl.product_id 
									AND fp.product_id = '[product_product_id]' AND fpl.home = '[location.prod]' AND fp.check_location_product = '1' 
									AND fp.check_imei_product is NULL AND fp.check_whitelist_product is NULL 
									AND (CURDATE() BETWEEN fp.start_date AND fp.end_date)
									AND (fp.prepaid_type='ALL' OR fp.prepaid_type LIKE CONCAT('%|','[prepaidType]', '|%')) 
							) ORDER BY start_date DESC LIMIT 1;</SA>
               </SA>
               <SA class="SyncIf" var="verify_product_id" compare="null">
                  <SA class="SyncAssignVariable" var="prodCode" value="[product_check_imei_product]-[product_check_whitelist_product]-[product_check_location_product]"/>
                  <SA class="SyncSwitch" input="prodCode">
                     <case code="1-null-null">
                        <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="OK01||imeiNotAllow||not allow imei||{dbconfig:fsd.[category].notif.[notifCommand]notAllowImei}"/>
                        <SA class="SyncIf" var="isFlu" compare="1">
                           <SA class="SyncAssignVariable" var="SMS" value="NOSMS"/>
                        </SA>
                        <SA class="SyncTempRequest" service="FSD" option="remove"/>
                        <SA class="SyncBreak"/>
                     </case>
                     <case code="null-1-null">
                        <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="OK01||msisdnNotAllow||not allow msisdn||{dbconfig:fsd.[category].notif.[notifCommand]notAllowMsisdn}"/>
                        <SA class="SyncIf" var="isFlu" compare="1">
                           <SA class="SyncAssignVariable" var="SMS" value="NOSMS"/>
                        </SA>
                        <SA class="SyncTempRequest" service="FSD" option="remove"/>
                        <SA class="SyncBreak"/>
                     </case>
                     <case code="null-null-1">
                        <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="OK01||locationNotAllow||not allow location||{dbconfig:fsd.[category].notif.[notifCommand]notAllowLocation}"/>
                        <SA class="SyncIf" var="isFlu" compare="1">
                           <SA class="SyncAssignVariable" var="SMS" value="NOSMS"/>
                        </SA>
                        <SA class="SyncTempRequest" service="FSD" option="remove"/>
                        <SA class="SyncBreak"/>
                     </case>
                     <case code="1-1-null">
                        <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="OK01||imeiMsisdnNotAllow||not allow imei msisdn||{dbconfig:fsd.[category].notif.[notifCommand]notAllowImeiMsisdn}"/>
                        <SA class="SyncIf" var="isFlu" compare="1">
                           <SA class="SyncAssignVariable" var="SMS" value="NOSMS"/>
                        </SA>
                        <SA class="SyncTempRequest" service="FSD" option="remove"/>
                        <SA class="SyncBreak"/>
                     </case>
                     <case code="1-null-1">
                        <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="OK01||imeiLocationNotAllow||not allow imei location||{dbconfig:fsd.[category].notif.[notifCommand]notAllowImeiLocation}"/>
                        <SA class="SyncIf" var="isFlu" compare="1">
                           <SA class="SyncAssignVariable" var="SMS" value="NOSMS"/>
                        </SA>
                        <SA class="SyncTempRequest" service="FSD" option="remove"/>
                        <SA class="SyncBreak"/>
                     </case>
                     <case code="null-1-1">
                        <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="OK01||locationMsisdnNotAllow||not allow location msisdn||{dbconfig:fsd.[category].notif.[notifCommand]notAllowLocationMsisdn}"/>
                        <SA class="SyncIf" var="isFlu" compare="1">
                           <SA class="SyncAssignVariable" var="SMS" value="NOSMS"/>
                        </SA>
                        <SA class="SyncTempRequest" service="FSD" option="remove"/>
                        <SA class="SyncBreak"/>
                     </case>
                     <case code="1-1-1">
                        <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="OK01||imeiLocationMsisdnNotAllow||not allow imei location msisdn||{dbconfig:fsd.[category].notif.[notifCommand]notAllowImeiLocationMsisdn}"/>
                        <SA class="SyncIf" var="isFlu" compare="1">
                           <SA class="SyncAssignVariable" var="SMS" value="NOSMS"/>
                        </SA>
                        <SA class="SyncTempRequest" service="FSD" option="remove"/>
                        <SA class="SyncBreak"/>
                     </case>
                  </SA>
               </SA>
            </case>
         </SA>
         <!--check LOS: Product-->
         <SA class="SyncIf" var="product_check_los" compare="null" negation="true">
            <SA class="INPlugin" id="lengthOfStay" saveValue="true" Type="get" bNumber="[adn]" bMsisdn="[bonusMsisdn]" InpluginTimeout="{dbconfig:InpluginTimeout}" InpluginAppsid="{dbconfig:bonus.getActiveDate.appsid}" InpluginPwd="{dbconfig:bonus.getActiveDate.password}" InpluginOrderid="GetActiveDate" InpluginCpname="Reflex"/>
            <SA class="SyncIf" var="lengthOfStay" compare="0|REJECT|null|FAILED|HTTP_FAILED">
               <!--retry hit-->
               <SA class="INPlugin" id="lengthOfStay" saveValue="true" Type="get" bNumber="[adn]" bMsisdn="[bonusMsisdn]" InpluginTimeout="{dbconfig:InpluginTimeout}" InpluginAppsid="{dbconfig:bonus.getActiveDate.appsid}" InpluginPwd="{dbconfig:bonus.getActiveDate.password}" InpluginOrderid="GetActiveDate" InpluginCpname="Reflex"/>
               <SA class="SyncIf" var="lengthOfStay" compare="0|REJECT|null|FAILED|HTTP_FAILED">
                  <SA class="SyncAssignVariable" var="errCode||detailz||SMS" value="FI06||checkLOSFailed||{dbconfig:fsd.[category].notif.syserror}"/>
                  <SA class="SyncTempRequest" service="FSD" option="remove"/>
                  <SA class="SyncBreak"/>
               </SA>
            </SA>
            <SA class="SyncDbSingleQuery" dataSource="jdbc/reflex" varPrefix="dblos_">SELECT TO_DAYS(CURDATE())-TO_DAYS(DATE_FORMAT('[lengthOfStay]','%Y-%m-%d')) AS days</SA>
            <!--single value-->
            <SA id="chekcLOS" class="SyncAssertExpression" var="dblos_days" operator="&lt;" value="[product_check_los]" saveValue="true"/>
            <SA class="SyncIf" var="chekcLOS" compare="1">
               <SA class="SyncIf" var="product_sub_category" compare="tcashloop">
                  <SA class="SyncIf" var="foundBonusID" compare="FALSE">
                     <SA class="SyncAssignVariable" var="errCode||detailz" value="OK01||NotAllowedLOS-Required LOS: [product_check_los] days"/>
                     <SA class="SyncAssignVariable" var="SMS" value="{dbconfig:fsd.notif.notAllowedLOS}"/>
                     <SA class="SyncTempRequest" service="FSD" option="remove"/>
                     <SA class="SyncBreak"/>
                  </SA>
               </SA>
               <SA class="SyncIf" var="product_sub_category" compare="tcashloop" negation="true">
                  <SA class="SyncAssignVariable" var="errCode||detailz" value="OK01||NotAllowedLOS-Required LOS: [product_check_los] days"/>
                  <SA class="SyncAssignVariable" var="SMS" value="{dbconfig:fsd.TAU.notif.notAllowedLOS}"/>
                  <SA class="SyncTempRequest" service="FSD" option="remove"/>
                  <SA class="SyncBreak"/>
               </SA>
            </SA>
            <!--between range0 and range1-->
            <!--<SA id="outputDays1" class="SyncAssertExpression" var="db_days" operator="&lt;" value="[ld.0]" saveValue="true"/>-->
            <!--<SA class="SyncIf" var="outputDays1" compare="1">-->
            <!--<SA class="SyncAssignVariable" var="errCode||detailz" value="OK01||NotAllowedLOS-activeDay[outputDays1]" />-->
            <!--<SA class="SyncAssignVariable" var="SMS" value="{dbconfig:DynDa.[mappingParam].notif.notAllowedLOS}" />-->
            <!--<SA class="SyncTempRequest" service="DynDa_[mappingParam]" option="remove"/>-->
            <!--<SA class="SyncBreak"/>-->
            <!--</SA>-->
            <!--<SA id="outputDays2" class="SyncAssertExpression" var="db_days" operator="&gt;" value="[ld.1]" saveValue="true"/>-->
            <!--<SA class="SyncIf" var="outputDays2" compare="1">-->
            <!--<SA class="SyncAssignVariable" var="errCode||detailz" value="OK01||NotAllowedLOS-activeDay[outputDays2]" />-->
            <!--<SA class="SyncAssignVariable" var="SMS" value="{dbconfig:DynDa.[mappingParam].notif.notAllowedLOS}" />-->
            <!--<SA class="SyncTempRequest" service="DynDa_[mappingParam]" option="remove"/>-->
            <!--<SA class="SyncBreak"/>-->
            <!--</SA>-->
         </SA>
         <!--Check New Imei Product-->
         <SA class="SyncIf" var="product_check_new_imei" compare="|null|NULL" negation="true">
            <SA class="SyncExplode" var="c" input="[product_check_new_imei]" separator="\|"/>
            <SA class="SyncAssignVariable" var="queryNewImei" value="[c.0]"/>
            <SA class="SyncAssignVariable" var="provOldImei" value="[c.1]"/>
            <SA class="SyncIf" var="provOldImei" compare="1">
               <SA class="SyncIf" var="imei" compare="|null|NULL">
                  <SA class="SyncAssignVariable" var="add.imei" value="[getDSP.imei]"/>
                  <SA class="SyncIf" var="getDSP.imei" compare="|null|NULL">
                     <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="FR09||imeiNotFound||[getDSP.imei]||{dbconfig:fsd.[category].notif.[notifCommand]notAllowImei}_-_[additional_notif_flu]"/>
                     <SA class="SyncTempRequest" service="FSD" option="remove"/>
                     <SA class="SyncBreak"/>
                  </SA>
                  <SA class="SyncAssignVariable" var="imei" value="[add.imei]"/>
               </SA>
            </SA>
            <SA class="SyncIf" var="queryNewImei" compare="1">
               <!--Check is New Imei-->
               <SA class="SyncSwitch" input="getDSP.newImeiFlag">
                  <case code="1">
                     <!--Check Device is 3G-->
                     <SA class="SyncAssignVariable" var="is3G" value="HSUPA:[getDSP.hsupa]-UMTS:[getDSP.umts]-HSDPA:[getDSP.hsdpa]-EDGE:[getDSP.edge]-LTE:[getDSP.lte]"/>
                     <SA class="SyncIf" var="is3G" compare="{dbconfig:fsd.network.3G.categories}" negation="true">
                        <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="OK01||not3GDevice||[is3G]||{dbconfig:fsd.[category].notif.[notifCommand]not3GDevice}_-_[additional_notif_flu]"/>
                        <SA class="SyncTempRequest" service="FSD" option="remove"/>
                        <SA class="SyncBreak"/>
                     </SA>
                  </case>
                  <case code="0">
                     <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="OK01||notNewImei||[getDSP.newImeiFlag]||{dbconfig:fsd.[category].notif.[notifCommand]notNewImei}_-_[additional_notif_flu]"/>
                     <SA class="SyncTempRequest" service="FSD" option="remove"/>
                     <SA class="SyncBreak"/>
                  </case>
                  <case code="default">
                     <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="FR09||newImeiNotFound||[getDSP.newImeiFlag]||{dbconfig:fsd.[category].notif.[notifCommand]notNewImei}_-_[additional_notif_flu]"/>
                     <SA class="SyncTempRequest" service="FSD" option="remove"/>
                     <SA class="SyncBreak"/>
                  </case>
               </SA>
            </SA>
         </SA>
         <!--Verify IMEI-->
         <SA class="SyncIf" var="product_check_imei_product" compare="1">
            <SA class="SyncIf" var="verify_valTable" compare="prodIML|prodIML2|prodIM|prodIM2|prodI|prodI2|prodIL|prodIL2">
               <SA class="SyncAssignVariable" var="maksImeiClaimProdId" value="{dbconfig:fsd.[product_product_id].maksImeiClaimProdId}"/>
               <SA class="SyncIf" var="maksImeiClaimProdId" compare="|null">
                  <SA class="SyncAssignVariable" var="maksImeiClaimProdId" value="-1"/>
               </SA>
               <SA class="SyncIf" var="maksImeiClaimProdId" compare="-1" negation="true">
                  <SA class="SyncDbSingleQuery" dataSource="jdbc/whitelist" varPrefix="imeiClaim2_">SELECT counter FROM fsd_product_imei_counter WHERE product_id = '[product_product_id]' AND imei = '[imei]'</SA>
                  <SA class="SyncIf" var="imeiClaim2_counter" compare="null" negation="true">
                     <SA id="remainingImeiClaimProdId" class="SyncAssertExpression" var="imeiClaim2_counter" operator="&lt;" value="[maksImeiClaimProdId]" saveValue="true"/>
                     <SA class="SyncIf" var="remainingImeiClaimProdId" compare="1" negation="true">
                        <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="OK01||[verify_valTable]||counterImeiEceedLimit||{dbconfig:fsd.[category].notif.[notifCommand]imeiAlreadyClaim}"/>
                        <SA class="SyncIf" var="isFlu" compare="1">
                           <SA class="SyncAssignVariable" var="SMS" value="NOSMS"/>
                        </SA>
                        <SA class="SyncTempRequest" service="FSD" option="remove"/>
                        <SA class="SyncBreak"/>
                     </SA>
                  </SA>
               </SA>
            </SA>
         </SA>
         <!--counting imei without whitelist-->
         <SA class="SyncIf" var="product_check_imei_product" compare="1" negation="true">
            <SA class="SyncIf" var="jsonflag.checkImei" compare="|null|NULL" negation="true">
               <SA class="SyncAssignVariable" var="verify_valTable" value="prodI"/>
               <SA class="SyncAssignVariable" var="imei" value="[getDSP.imei]"/>
               <SA class="SyncAssignVariable" var="counterImeiWithoutWhitelist" value="[jsonflag.checkImei]"/>
               <SA class="SyncAssignVariable" var="maksImeiClaimProdId" value="{dbconfig:fsd.[product_product_id].maksImeiClaimProdId}"/>
               <SA class="SyncIf" var="maksImeiClaimProdId" compare="|null">
                  <SA class="SyncAssignVariable" var="maksImeiClaimProdId" value="0"/>
               </SA>
               <SA class="SyncIf" var="maksImeiClaimProdId" compare="0" negation="true">
                  <SA class="SyncDbSingleQuery" dataSource="jdbc/whitelist" varPrefix="imeiClaim2_">SELECT counter FROM fsd_product_imei_counter WHERE product_id = '[product_product_id]' AND imei = '[imei]'</SA>
                  <SA class="SyncIf" var="imeiClaim2_counter" compare="null" negation="true">
                     <SA id="remainingImeiClaimProdId" class="SyncAssertExpression" var="imeiClaim2_counter" operator="&lt;" value="[maksImeiClaimProdId]" saveValue="true"/>
                     <SA class="SyncIf" var="remainingImeiClaimProdId" compare="1" negation="true">
                        <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="OK01||[verify_valTable]||counterImeiEceedLimit||{dbconfig:fsd.[category].notif.[notifCommand]imeiAlreadyClaim}"/>
                        <SA class="SyncTempRequest" service="FSD" option="remove"/>
                        <SA class="SyncBreak"/>
                     </SA>
                  </SA>
               </SA>
            </SA>
         </SA>
         <!--Verify Counter-->
         <SA class="SyncDbSingleQuery" dataSource="jdbc/whitelist" varPrefix="prodTarget_">SELECT product_id FROM fsd_product WHERE product_id='[product_product_id]' AND category = '[category]' AND (target='ALL' OR target LIKE '%|[counter_counter]|%')</SA>
         <SA class="SyncIf" var="prodTarget_product_id" compare="null">
            <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="OK01||counterProdExceedLimit||counter not allow||{dbconfig:fsd.[category].notif.[notifCommand]notAllowCounter}"/>
            <SA class="SyncIf" var="isFlu" compare="1">
               <SA class="SyncAssignVariable" var="SMS" value="NOSMS"/>
            </SA>
            <SA class="SyncTempRequest" service="FSD" option="remove"/>
            <SA class="SyncBreak"/>
         </SA>
         <!--Verify Maks Quota Product-->
         <SA class="SyncIf" var="product_maxCount" compare="0" negation="true">
            <SA class="SyncDbSingleQuery" dataSource="jdbc/reflex" varPrefix="fpdc2_">SELECT counter, reset_date FROM fsd_product_discount_counter WHERE product_id = '[product_product_id]' AND discount_id = ''</SA>
            <SA class="SyncIf" var="fpdc2_counter" compare="null" negation="true">
               <SA class="SyncAssignVariable" var="curCounterProd||maxCounterProd" value="[fpdc2_counter]||[product_maxCount]"/>
               <SA id="remainingQuotaProdId" class="SyncAssertExpression" var="fpdc2_counter" operator="&lt;" value="[product_maxCount]" saveValue="true"/>
               <SA class="SyncIf" var="remainingQuotaProdId" compare="1" negation="true">
                  <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="OK01||counterMaxProdExceedLimit||counter Max Product not allow||{dbconfig:fsd.[category].notif.[notifCommand]reachMaxCount}"/>
                  <SA class="SyncIf" var="isFlu" compare="1">
                     <SA class="SyncAssignVariable" var="SMS" value="NOSMS"/>
                  </SA>
                  <SA class="SyncTempRequest" service="FSD" option="remove"/>
                  <SA class="SyncBreak"/>
               </SA>
            </SA>
         </SA>
         <!--Assignment Parameter Provisioning LEVEL Product-->
         <SA class="SyncSwitch" input="isMkios">
            <case code="TRUE">
               <SA class="SyncExplode" var="m" input="[product_charge_appsid]" separator="\|"/>
               <SA class="SyncAssignVariable" var="chargeAppsid" value="[m.0]"/>
               <SA class="JsonParse" var="json" input="[m.1]"/>
               <SA class="SyncIf" var="json.productId" compare="|null|NULL" negation="true">
                  <SA class="SyncAssignVariable" var="mkios_productId" value="[json.productId]"/>
                  <SA class="SyncAssignVariable" var="mkios_denom" value="[json.denom]"/>
                  <SA class="SyncAssignVariable" var="mkios_interval" value="[json.interval]"/>
               </SA>
            </case>
            <case code="default">
               <SA class="SyncAssignVariable" var="chargeAppsid" value="[product_charge_appsid]"/>
            </case>
         </SA>
         <SA class="SyncAssignVariable" var="chargePassword" value="[product_charge_password]"/>
         <SA class="SyncAssignVariable" var="nominal" value="[product_nominal]"/>
         <SA class="SyncSwitch" input="category">
            <case code="RECHARGE">
               <SA class="SyncExplode" var="r" input="[product_bonus_appsid]" separator="\|"/>
               <SA class="SyncAssignVariable" var="bonusAppsid" value="[r.0]"/>
               <SA class="JsonParse" var="json" input="[r.1]"/>
               <SA class="SyncIf" var="json.productId" compare="|null|NULL" negation="true">
                  <SA class="SyncAssignVariable" var="recharge_reseller" value="[json.reseller]"/>
                  <SA class="SyncAssignVariable" var="recharge_denom" value="[json.denom]"/>
                  <SA class="SyncAssignVariable" var="recharge_productId" value="[json.productId]"/>
               </SA>
            </case>
            <case code="default">
               <SA class="SyncAssignVariable" var="bonusAppsid" value="[product_bonus_appsid]"/>
               <!--NEW VAR SAPC-->
               <SA class="SyncAssignVariable" var="ProvSapcPackage" value="[product_sapc_package]"/>
               <SA class="SyncAssignVariable" var="ProvAddSapcPackage" value="[product_additional_sapc_package]"/>
            </case>
         </SA>
         <SA class="SyncAssignVariable" var="bonusPassword" value="[product_bonus_password]"/>
         <SA class="SyncAssignVariable" var="discount_id" value="NULL"/>
         <SA class="SyncAssignVariable" var="interval" value="[product_product_length]"/>
         <SA class="SyncAssignVariable" var="sapcPackage" value="[product_sapc_package]"/>
         <SA id="ExplodeChunk" class="SyncExplode" separator="\|" var="aBizDesc" input="[product_biz_desc]"/>
         <SA class="SyncAssignVariable" var="product_biz_desc" value="[aBizDesc.0]"/>
         <SA class="SyncAssignVariable" var="get_program_name" value="[verify_program_name]"/>
         <SA class="SyncSwitch" input="product_sub_category">
            <case code="PRELOAD"></case>
            <case code="default">
               <!--GET PARAMETER FOR MULTI OFFER-->
               <SA class="SyncIf" var="product_multi_offer" compare="null" negation="true">
                  <SA class="JsonParse" var="json" input="[product_multi_offer]"/>
                  <SA class="SyncIf" var="json.bonus_appsid2" compare="|null|NULL" negation="true">
                     <SA class="SyncAssignVariable" var="bonusAppsid2" value="[json.bonus_appsid2]"/>
                     <SA class="SyncAssignVariable" var="bonusPassword2" value="[json.bonus_password2]"/>
                  </SA>
                  <SA class="SyncIf" var="json.bonus_appsid3" compare="|null|NULL" negation="true">
                     <SA class="SyncAssignVariable" var="bonusAppsid3" value="[json.bonus_appsid3]"/>
                     <SA class="SyncAssignVariable" var="bonusPassword3" value="[json.bonus_password3]"/>
                  </SA>
                  <SA class="SyncIf" var="json.bonus_appsid4" compare="|null|NULL" negation="true">
                     <SA class="SyncAssignVariable" var="bonusAppsid4" value="[json.bonus_appsid4]"/>
                     <SA class="SyncAssignVariable" var="bonusPassword4" value="[json.bonus_password4]"/>
                     <SA class="SyncAssignVariable" var="bonus_volume" value="[json.bonus4_volume]"/>
                  </SA>
                  <SA class="SyncIf" var="json.bonus_appsid5" compare="|null|NULL" negation="true">
                     <SA class="SyncAssignVariable" var="bonusAppsid5" value="[json.bonus_appsid5]"/>
                     <SA class="SyncAssignVariable" var="bonusPassword5" value="[json.bonus_password5]"/>
                  </SA>
                  <SA class="SyncIf" var="json.bonus_appsid6" compare="|null|NULL" negation="true">
                     <SA class="SyncAssignVariable" var="bonusAppsid6" value="[json.bonus_appsid6]"/>
                     <SA class="SyncAssignVariable" var="bonusPassword6" value="[json.bonus_password6]"/>
                  </SA>
                  <!--Set Conf ON/OFF-->
                  <SA class="SyncAssignVariable" var="isMultiOffer" value="{dbconfig:fsd.param.isMultiOffer}"/>
                  <SA class="SyncIf" var="isMultiOffer" compare="ON">
                     <SA class="SyncIf" var="json.bonus_appsid7" compare="|null|NULL" negation="true">
                        <SA class="SyncAssignVariable" var="bonusAppsid7" value="[json.bonus_appsid7]"/>
                        <SA class="SyncAssignVariable" var="bonusPassword7" value="[json.bonus_password7]"/>
                     </SA>
                     <SA class="SyncIf" var="json.bonus_appsid8" compare="|null|NULL" negation="true">
                        <SA class="SyncAssignVariable" var="bonusAppsid8" value="[json.bonus_appsid8]"/>
                        <SA class="SyncAssignVariable" var="bonusPassword8" value="[json.bonus_password8]"/>
                     </SA>
                     <SA class="SyncIf" var="json.bonus_appsid9" compare="|null|NULL" negation="true">
                        <SA class="SyncAssignVariable" var="bonusAppsid9" value="[json.bonus_appsid9]"/>
                        <SA class="SyncAssignVariable" var="bonusPassword9" value="[json.bonus_password9]"/>
                     </SA>
                  </SA>
                  <SA class="SyncIf" var="json.bonus_extendAppsid" compare="|null|NULL" negation="true">
                     <SA class="SyncAssignVariable" var="bonusExtendAppsid" value="[json.bonus_extendAppsid]"/>
                     <SA class="SyncAssignVariable" var="bonusExtendPassword" value="[json.bonus_extendPassword]"/>
                     <SA class="SyncIf" var="alreadyCheckBalance" compare="TRUE" negation="true">
                        <SA class="INPlugin" id="balance" saveValue="true" Type="balance" bMsisdn="[bonusMsisdn]" InpluginTimeout="{dbconfig:InpluginTimeout}"/>
                        <SA class="SyncIf" var="balance" compare="2" negation="true">
                           <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="FI03||[balance]||error while checking balance||{dbconfig:fsd.[category].notif.syserror}_-_[additional_notif_flu]"/>
                           <SA class="SyncIf" var="isFlu" compare="1">
                              <SA class="SyncAssignVariable" var="SMS" value="NOSMS"/>
                           </SA>
                           <SA class="SyncTempRequest" service="FSD" option="remove"/>
                           <SA class="SyncBreak"/>
                        </SA>
                     </SA>
                     <SA class="SyncIf" var="balance.active" compare="0">
                        <SA class="SyncIf" var="command" compare="GIFT|MKIOS" negation="true">
                           <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="OK01||notActive||grace number||{dbconfig:fsd.notif.[notifCommand]notActive}"/>
                           <SA class="SyncIf" var="isFlu" compare="1">
                              <SA class="SyncAssignVariable" var="SMS" value="NOSMS"/>
                           </SA>
                           <SA class="SyncTempRequest" service="FSD" option="remove"/>
                           <SA class="SyncBreak"/>
                        </SA>
                     </SA>
                     <!--Get active date yyyy-MM-dd-->
                     <SA class="SyncAssignVariable" var="activeDate" value="[balance.activeDate]"/>
                     <SA class="SyncSwitch" input="isMkios">
                        <case code="TRUE">
                           <SA class="SyncAssignVariable" var="extendLifeCycle" value="TRUE"/>
                           <SA class="SyncIf" var="balance.active" compare="0">
                              <SA class="DateUtility" id="today" saveValue="true" Option="Today" Param1="yyyy-MM-dd" Param2="yyyy-MM-dd"/>
                              <!--<SA class="DateUtility" id="newActiveDate" saveValue="true" Option="add_date2" Param1="yyyy-MM-dd" Param2="yyyy-MM-dd" Param5="[today]" Param6="[mkios_interval]"/>-->
                              <SA Input2="1" Input1="[mkios_interval]" Operator="+" Msisdn="" id="newAddLifeCycle" saveValue="True" Information="" class="Arithmetic"/>
                              <SA class="DateUtility" id="newActiveDate" saveValue="true" Option="add_date2" Param1="yyyy-MM-dd" Param2="yyyy-MM-dd" Param5="[today]" Param6="[newAddLifeCycle]"/>
                           </SA>
                           <SA class="SyncIf" var="balance.active" compare="0" negation="true">
                              <!--Get date next years-->
                              <SA class="DateUtility" id="dateNextYear" saveValue="true" Option="date_next_year" Param2="yyyy-MM-dd"/>
                              <!--<SA class="DateUtility" id="newActiveDate" saveValue="true" Option="add_date2" Param1="yyyy-MM-dd" Param2="yyyy-MM-dd" Param5="[activeDate]" Param6="[mkios_interval]"/>-->
                              <SA Input2="1" Input1="[mkios_interval]" Operator="+" Msisdn="" id="newAddLifeCycle" saveValue="True" Information="" class="Arithmetic"/>
                              <SA class="DateUtility" id="newActiveDate" saveValue="true" Option="add_date2" Param1="yyyy-MM-dd" Param2="yyyy-MM-dd" Param5="[today]" Param6="[newAddLifeCycle]"/>
                              <SA id="ActiveStatus" class="DateUtility" Option="is_expired2" Param5="[newActiveDate]" Param3="[activeDate]" saveValue="true"/>
                              <SA class="SyncIf" var="ActiveStatus" compare="1" negation="true">
                                 <SA class="SyncAssignVariable" var="extendLifeCycle" value="FALSE"/>
                                 <SA class="SyncAssignVariable" var="bonusExtend" value="notExtend"/>
                              </SA>
                              <SA class="SyncIf" var="ActiveStatus" compare="1">
                                 <SA id="ActiveStatus2" class="DateUtility" Option="is_expired2" Param5="[newActiveDate]" Param3="[dateNextYear]" saveValue="true"/>
                                 <SA class="SyncIf" var="ActiveStatus2" compare="1" negation="true">
                                    <SA class="SyncAssignVariable" var="extendLifeCycle" value="FALSE"/>
                                    <SA class="SyncAssignVariable" var="bonusExtend" value="notExtend"/>
                                 </SA>
                              </SA>
                           </SA>
                        </case>
                        <case code="default">
                           <SA class="DateUtility" id="today" saveValue="true" Option="Today" Param1="yyyy-MM-dd" Param2="yyyy-MM-dd"/>
                           <!--<SA class="DateUtility" id="newActiveDate" saveValue="true" Option="add_date2" Param1="yyyy-MM-dd" Param2="yyyy-MM-dd" Param5="[today]" Param6="[interval]"/>-->
                           <SA Input2="1" Input1="[interval]" Operator="+" Msisdn="" id="newAddLifeCycle" saveValue="True" Information="" class="Arithmetic"/>
                           <SA class="DateUtility" id="newActiveDate" saveValue="true" Option="add_date2" Param1="yyyy-MM-dd" Param2="yyyy-MM-dd" Param5="[today]" Param6="[newAddLifeCycle]"/>
                           <SA id="ActiveStatus" class="DateUtility" Option="is_expired2" Param5="[newActiveDate]" Param3="[activeDate]" saveValue="true"/>
                           <SA class="SyncAssignVariable" var="extendLifeCycle" value="TRUE"/>
                           <SA class="SyncIf" var="ActiveStatus" compare="1" negation="true">
                              <SA class="SyncAssignVariable" var="extendLifeCycle" value="FALSE"/>
                              <SA class="SyncAssignVariable" var="bonusExtend" value="notExtend"/>
                           </SA>
                        </case>
                     </SA>
                  </SA>
                  <SA class="SyncIf" var="json.act_status_nbp" compare="|null|NULL" negation="true">
                     <SA class="SyncAssignVariable" var="actStatusNbp" value="NULL"/>
                     <!--Reset Value actStatusNbp-->
                     <SA class="DateUtility" id="todayNBP" saveValue="true" Option="Today" Param1="yyyy-MM-dd" Param2="yyyy-MM-dd"/>
                     <SA class="SyncAssignVariable" var="actStatusNbp" value="[json.act_status_nbp]"/>
                     <SA class="SyncAssignVariable" var="actAdnNbp" value="[json.act_adn_nbp]"/>
                  </SA>
                  <SA class="SyncIf" var="json.act_status_nbp2" compare="|null|NULL" negation="true">
                     <SA class="SyncAssignVariable" var="actStatusNbp2" value="NULL"/>
                     <!--Reset Value actStatusNbp2-->
                     <SA class="DateUtility" id="todayNBP" saveValue="true" Option="Today" Param1="yyyy-MM-dd" Param2="yyyy-MM-dd"/>
                     <SA class="SyncAssignVariable" var="actStatusNbp2" value="[json.act_status_nbp2]"/>
                     <SA class="SyncAssignVariable" var="actAdnNbp2" value="[json.act_adn_nbp2]"/>
                  </SA>
                  <SA class="SyncIf" var="json.act_status_nbp3" compare="|null|NULL" negation="true">
                     <SA class="SyncAssignVariable" var="actStatusNbp3" value="NULL"/>
                     <!--Reset Value actStatusNbp3-->
                     <SA class="DateUtility" id="todayNBP" saveValue="true" Option="Today" Param1="yyyy-MM-dd" Param2="yyyy-MM-dd"/>
                     <SA class="SyncAssignVariable" var="actStatusNbp3" value="[json.act_status_nbp3]"/>
                     <SA class="SyncAssignVariable" var="actAdnNbp3" value="[json.act_adn_nbp3]"/>
                  </SA>
                  <SA class="SyncIf" var="json.act_status_nbp4" compare="|null|NULL" negation="true">
                     <SA class="SyncAssignVariable" var="actStatusNbp4" value="NULL"/>
                     <!--Reset Value actStatusNbp4-->
                     <SA class="DateUtility" id="todayNBP" saveValue="true" Option="Today" Param1="yyyy-MM-dd" Param2="yyyy-MM-dd"/>
                     <SA class="SyncAssignVariable" var="actStatusNbp4" value="[json.act_status_nbp4]"/>
                     <SA class="SyncAssignVariable" var="actAdnNbp4" value="[json.act_adn_nbp4]"/>
                  </SA>
                  <SA class="SyncIf" var="json.act_status_nbp5" compare="|null|NULL" negation="true">
                     <SA class="SyncAssignVariable" var="actStatusNbp5" value="NULL"/>
                     <!--Reset Value actStatusNbp5-->
                     <SA class="DateUtility" id="todayNBP" saveValue="true" Option="Today" Param1="yyyy-MM-dd" Param2="yyyy-MM-dd"/>
                     <SA class="SyncAssignVariable" var="actStatusNbp5" value="[json.act_status_nbp5]"/>
                     <SA class="SyncAssignVariable" var="actAdnNbp5" value="[json.act_adn_nbp5]"/>
                  </SA>
               </SA>
            </case>
         </SA>
      </SA>
      <!--Assign Additional SAPC existing-->
      <SA class="SyncIf" var="ProvSapcPackage" compare="|null|NULL" negation="true">
         <SA class="SyncIf" var="ProvAddSapcPackage" compare="|null|NULL" negation="true">
            <SA class="SyncAssignVariable" var="ProvSapcPackage" value="[ProvSapcPackage]||[ProvAddSapcPackage]"/>
            <SA id="ExplodeChunk" class="SyncExplode" separator="\|\|" var="sapcExplode" input="[ProvSapcPackage]"/>
         </SA>
      </SA>
      <!--Validate Max Additional Profile-->
      <SA id="maxProfileUpccSize" class="SyncAssertExpression" var="sapcExplode.size" operator=">" value="2" saveValue="true"/>
      <SA class="SyncIf" var="maxProfileUpccSize" compare="1">
         <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="OK01||productUpccProfileExceedMax||productUpccProfileExceedMax Please Check FSD Product||{dbconfig:fsd.[category].notif.[notifCommand]productNotAvailable}"/>
         <SA class="SyncIf" var="isFlu" compare="1">
            <SA class="SyncAssignVariable" var="SMS" value="NOSMS"/>
         </SA>
         <SA class="SyncTempRequest" service="FSD" option="remove"/>
         <SA class="SyncBreak"/>
      </SA>
      <!--FSD SUB Open Restriction-->
      <SA class="SyncAssignVariable" var="_productId" value="[product_product_id]"/>
      <SA class="SyncAssignVariable" var="_discountId" value="[discount_id]"/>
      <SA class="SyncAssignVariable" var="_subscriptionType" value="[subscriptionType]"/>
      <SA class="SyncAssignVariable" var="dontExtend" value="0"/>
      <SA class="SyncIf" var="purchase_type" compare="null" negation="true">
         <SA class="SyncSwitch" input="purchase_type">
            <case code="CON">
               <SA class="SyncDbSingleQuery" dataSource="dbsession" varPrefix="__" requestor="[bonusMsisdn]">SELECT IF(DATEDIFF(end_date, ADDDATE(CURDATE(), INTERVAL ([interval]-1) DAY)) > 0, '1', '0') AS dontExtend, DATE_FORMAT(ADDDATE(end_date, INTERVAL 1 DAY), '%d-%m-%Y') AS end_date_sapc
						FROM fsd_subscription WHERE msisdn='[bonusMsisdn]' AND category='[category]'</SA>
               <SA class="SyncIf" var="__dontExtend" compare="1">
                  <SA class="SyncAssignVariable" var="dontExtend" value="1"/>
               </SA>
            </case>
            <case code="default">
               <SA class="SyncAssignVariable" var="_subscriptionType" value="SUB"/>
               <SA class="SyncAssignVariable" var="newPurchaseSubscriptionType" value="[purchase_type]-[subscriptionType]"/>
               <SA class="SyncSwitch" input="newPurchaseSubscriptionType">
                  <case code="ON-ON">
                     <SA class="SyncAssignVariable" var="_subscriptionType" value="ON"/>
                  </case>
                  <case code="SUB-ON">
                     <SA class="SyncAssignVariable" var="_productId" value="[_product_id]"/>
                     <SA class="SyncAssignVariable" var="_discountId" value="[_discount_id]"/>
                  </case>
               </SA>
               <SA class="SyncDbSingleQuery" dataSource="dbsession" varPrefix="__" requestor="[bonusMsisdn]">SELECT IF(DATEDIFF(end_date, ADDDATE(CURDATE(), INTERVAL ([interval]-1) DAY)) > 0, '1', '0') AS dontExtend, DATE_FORMAT(ADDDATE(end_date, INTERVAL 1 DAY), '%d-%m-%Y') AS end_date_sapc
						FROM fsd_subscription WHERE msisdn='[bonusMsisdn]' AND category='[category]'</SA>
               <SA class="SyncIf" var="__dontExtend" compare="1">
                  <SA class="SyncAssignVariable" var="dontExtend" value="1"/>
               </SA>
            </case>
         </SA>
      </SA>
      <!--Get Profile SAPC existing-->
      <SA class="SyncAssignVariable" var="allowFSDProvSAPC" value="{dbconfig:fsd.allowFSDProvSAPC}"/>
      <SA class="SyncIf" var="allowFSDProvSAPC" compare="TRUE">
         <SA class="SyncIf" var="ProvSapcPackage" compare="|null|NULL" negation="true">
            <!--force to UPCC-->
            <SA class="SyncAssignVariable" var="_PCRF_NAME" value="UPCC"/>
            <SA class="UpccProvisioning" id="checkProfile" type="query" msisdn="[bonusMsisdn]"/>
            <SA class="SyncIf" var="checkProfile" compare="1" negation="true">
               <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="FP12||[checkProfile.detail]||Check Profile UPCC failed||{dbconfig:fsd.[category].notif.syserror}_-_[additional_notif_flu]"/>
               <SA class="SyncIf" var="isFlu" compare="1">
                  <SA class="SyncAssignVariable" var="SMS" value="NOSMS"/>
               </SA>
               <SA class="SyncTempRequest" service="FSD" option="remove"/>
               <SA class="SyncBreak"/>
            </SA>
            <SA class="SyncAssignVariable" var="sapcProfilePrevious" value=""/>
            <SA class="SyncIf" var="checkProfile.infoSapcPackages" compare="{dbconfig:flashunl.list.emptyProfile}" negation="true">
               <SA class="SyncStringUtility" type="replaceAll" param1="[checkProfile.infoSapcPackages]" param2="\," param3="\|" var="listProfileSapc"/>
               <SA class="SyncIf" var="ProvAddSapcPackage" compare="|null|NULL">
                  <SA class="SyncIf" var="ProvSapcPackage" compare="[listProfileSapc]">
                     <SA class="SyncAssignVariable" var="sapcProfilePrevious" value="[ProvSapcPackage]"/>
                  </SA>
               </SA>
               <SA class="SyncIf" var="ProvAddSapcPackage" compare="|null|NULL" negation="true">
                  <SA Input2="1" Input1="[sapcExplode.size]" Operator="-" Msisdn="" saveValue="True" id="sapcExplodeSize" class="Arithmetic"/>
                  <SA class="SyncLoopIterator" var="iter" start="0" end="[sapcExplodeSize]">
                     <SA class="SyncAssignVariable" var="sapcExplodeProfile" value="[sapcExplode.[iter]]"/>
                     <SA class="SyncIf" var="sapcExplodeProfile" compare="[listProfileSapc]">
                        <SA class="SyncAssignVariable" var="sapcProfilePrevious" value="[sapcExplodeProfile]"/>
                     </SA>
                  </SA>
               </SA>
               <!--Check UPCC Profile Restriction-->
               <SA id="checkRestriction" class="UpccProvisioning" type="check_restriction" msisdn="[bonusMsisdn]" sapcPackage="[ProvSapcPackage]"/>
               <SA class="SyncSwitch" input="checkRestriction">
                  <case code="ERR|-1">
                     <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="FP12||ERR in checkRestriction||[checkRestriction.detail]||{dbconfig:fsd.[category].notif.syserror}_-_[additional_notif_flu]"/>
                     <SA class="SyncIf" var="isFlu" compare="1">
                        <SA class="SyncAssignVariable" var="SMS" value="NOSMS"/>
                     </SA>
                     <SA class="SyncTempRequest" service="FSD" option="remove"/>
                     <SA class="SyncBreak"/>
                  </case>
                  <case code="1"></case>
                  <case code="default">
                     <SA class="SyncAssignVariable" var="restriction" value="{dbconfig:RegService.[checkRestriction].restriction}"/>
                     <SA class="SyncIf" var="restriction" compare="|null">
                        <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="OK01||upccRestrict||[checkRestriction]||{dbconfig:fsd.notif.restriction2}"/>
                        <SA class="SyncIf" var="isFlu" compare="1">
                           <SA class="SyncAssignVariable" var="SMS" value="NOSMS"/>
                        </SA>
                        <SA class="SyncTempRequest" service="FSD" option="remove"/>
                        <SA class="SyncBreak"/>
                     </SA>
                     <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="OK01||upccRestrict||[checkRestriction]||{dbconfig:fsd.notif.restriction}"/>
                     <SA class="SyncIf" var="isFlu" compare="1">
                        <SA class="SyncAssignVariable" var="SMS" value="NOSMS"/>
                     </SA>
                     <SA class="SyncTempRequest" service="FSD" option="remove"/>
                     <SA class="SyncBreak"/>
                  </case>
               </SA>
            </SA>
         </SA>
      </SA>
      <SA class="SyncAssignVariable" var="adn" value="{dbconfig:fsd.charge.bnumber}"/>
      <SA class="SyncAssignVariable" var="orderid" value="[product_product_id]"/>
      <SA class="SyncIf" var="discount_id" compare="|null|NULL" negation="true">
         <SA class="SyncAssignVariable" var="orderid" value="[orderid]__[discount_id]"/>
      </SA>
      <!--<SA class="SyncAssignVariable" var="cpname" value="[orderid]" />-->
      <SA class="SyncAssignVariable" var="cpname" value="{dbconfig:fsd.charge.cpname}"/>
      <!--New CPName Flag-->
      <SA class="SyncIf" var="jsonflag.cpname_prefix" compare="|null|NULL" negation="true">
         <SA class="SyncStringUtility" var="CpnamePrefix" type="strlength" param1="[jsonflag.cpname_prefix]"/>
         <SA id="isValidCpnamePrefix" class="SyncAssertExpression" var="CpnamePrefix" operator=">" value="5" saveValue="true"/>
         <SA class="SyncIf" var="isValidCpnamePrefix" compare="1">
            <SA id="SubstringMessage" class="SyncSubstring" var="CPnamesubs" input="[jsonflag.cpname_prefix]" start="0" stop="5"/>
            <SA class="SyncAssignVariable" var="cpname" value="[CPnamesubs]_[cpname]"/>
         </SA>
         <SA class="SyncIf" var="isValidCpnamePrefix" compare="1" negation="true">
            <SA class="SyncAssignVariable" var="cpname" value="[jsonflag.cpname_prefix]_[cpname]"/>
         </SA>
      </SA>
      <SA class="SyncIf" var="command" compare="|null" negation="true">
         <SA class="SyncStringUtility" var="commandLength" type="strlength" param1="[command]"/>
         <SA id="isValidNewCPname" class="SyncAssertExpression" var="commandLength" operator=">" value="5" saveValue="true"/>
         <SA class="SyncIf" var="isValidNewCPname" compare="1">
            <SA id="SubstringMessage" class="SyncSubstring" var="CPnamesubss" input="[command]" start="0" stop="5"/>
            <SA class="SyncAssignVariable" var="cpname" value="[cpname]_[CPnamesubss]"/>
            <SA class="SyncStringUtility" var="ALLCpname" type="strlength" param1="[cpname]"/>
            <SA id="isValidCpnameCommand" class="SyncAssertExpression" var="ALLCpname" operator=">" value="29" saveValue="true"/>
            <SA class="SyncIf" var="isValidCpnameCommand" compare="1">
               <SA id="SubstringMessage" class="SyncSubstring" var="NewCPname" input="[cpname]" start="0" stop="29"/>
               <SA class="SyncAssignVariable" var="cpname" value="[NewCPname]"/>
            </SA>
         </SA>
         <SA class="SyncIf" var="isValidNewCPname" compare="1" negation="true">
            <SA class="SyncAssignVariable" var="cpname" value="[cpname]_[command]"/>
            <SA class="SyncStringUtility" var="ALLCpname" type="strlength" param1="[cpname]"/>
            <SA id="isValidCpnameCommand" class="SyncAssertExpression" var="ALLCpname" operator=">" value="29" saveValue="true"/>
            <SA class="SyncIf" var="isValidCpnameCommand" compare="1">
               <SA id="SubstringMessage" class="SyncSubstring" var="NewCPname" input="[cpname]" start="0" stop="29"/>
               <SA class="SyncAssignVariable" var="cpname" value="[NewCPname]"/>
            </SA>
         </SA>
      </SA>
      <!--Check CPNAME Without Flag Product-->
      <SA class="SyncStringUtility" var="ALLCpname2" type="strlength" param1="[cpname]"/>
      <SA id="isValidCpnameCommand2" class="SyncAssertExpression" var="ALLCpname2" operator=">" value="29" saveValue="true"/>
      <SA class="SyncIf" var="isValidCpnameCommand2" compare="1">
         <SA id="SubstringMessage" class="SyncSubstring" var="NewCPname2" input="[cpname]" start="0" stop="29"/>
         <SA class="SyncAssignVariable" var="cpname" value="[NewCPname2]"/>
      </SA>
      <!--Need Recharge History Check-->
      <SA class="SyncAssignVariable" var="RechargeNeed" value="{dbconfig:fsd.[product_product_id].RechargeNeed.Check}"/>
      <SA class="SyncIf" var="RechargeNeed" compare="ON">
         <SA class="SyncGenerateTxid" var="RechargeNeedTxid"/>
         <SA class="SyncAssignVariable" var="RechargeNeedAppsid" value="{dbconfig:fsd.RechargeNeed.Bonus.[product_product_id]}"/>
         <SA class="SyncAssignVariable" var="RechargeNeedPwd" value="{dbconfig:fsd.RechargeNeed.Pwd.[product_product_id]}"/>
         <SA class="INPlugin" id="CheckRechargeNeed" saveValue="true" Type="charge" bMsisdn="[msisdn]" bNumber="[adn]" InpluginTimeout="{dbconfig:InpluginTimeout}" InpluginAppsid="[RechargeNeedAppsid]" InpluginPwd="[RechargeNeedPwd]" InpluginOrderid="[orderid]" InpluginCpname="[cpname]" InpluginTrxid="[RechargeNeedTxid]"/>
         <SA class="SyncIf" var="CheckRechargeNeed" compare="FAILED|HTTP_FAILED">
            <SA class="INPlugin" id="CheckRechargeNeed" saveValue="true" Type="charge" bMsisdn="[msisdn]" bNumber="[adn]" InpluginTimeout="{dbconfig:InpluginTimeout}" InpluginAppsid="[RechargeNeedAppsid]" InpluginPwd="[RechargeNeedPwd]" InpluginOrderid="[orderid]" InpluginCpname="[cpname]" InpluginTrxid="[RechargeNeedTxid]"/>
         </SA>
         <SA class="SyncIf" var="CheckRechargeNeed" compare="2" negation="true">
            <SA class="SyncAssignVariable" var="errCode||detailz||SMS" value="OK01||RechargeNeed||{dbconfig:fsd.RechargeNeed.notif}"/>
            <SA class="SyncTempRequest" service="FSD" option="remove"/>
            <SA class="SyncBreak"/>
         </SA>
      </SA>
      <SA class="SyncIf" var="command" compare="ASK">
         <!--if discount_id != null set charge @table fsd_discount-->
         <SA class="SyncIf" var="discount_id" compare="|null|NULL" negation="TRUE">
            <SA class="JsonParse" var="a" input="[discount_flag]"/>
            <SA class="SyncIf" var="a.askappsid" compare="|null|NULL" negation="TRUE">
               <SA class="SyncAssignVariable" var="chargeAppsid" value="[a.askappsid]"/>
               <SA class="SyncAssignVariable" var="chargePassword" value="[a.askpass]"/>
               <SA class="SyncAssignVariable" var="nominal" value="[a.asknominal]"/>
            </SA>
         </SA>
         <SA class="SyncIf" var="discount_id" compare="|null|NULL">
            <SA class="JsonParse" var="b" input="[product_flag]"/>
            <SA class="SyncIf" var="b.askappsid" compare="|null|NULL" negation="TRUE">
               <SA class="SyncAssignVariable" var="chargeAppsid" value="[b.askappsid]"/>
               <SA class="SyncAssignVariable" var="chargePassword" value="[b.askpass]"/>
               <SA class="SyncAssignVariable" var="nominal" value="[b.asknominal]"/>
            </SA>
         </SA>
      </SA>
      <!--Charge-->
      <SA class="SyncSwitch" input="isMkios">
         <case code="TRUE">
            <SA var="charge" class="MKIOSPlugin" msisdn="[chargeMsisdn]" type="charge" pin="[mkios_pin]" bMsisdn="[bonusMsisdn]" lac="[mkios_lac]" ci="[mkios_ci]" productId="[mkios_productId]" denom="[mkios_denom]"/>
            <SA class="SyncIf" var="charge" compare="0" negation="true">
               <SA class="SyncSwitch" input="charge.detail">
                  <case code="FAILED">
                     <SA var="status" class="MKIOSPlugin" msisdn="[chargeMsisdn]" type="status" pin="[mkios_pin]" bMsisdn="[bonusMsisdn]" lac="[mkios_lac]" ci="[mkios_ci]" productId="[mkios_productId]" oriTxid="[charge.txid]"/>
                     <SA class="SyncIf" var="status" compare="0" negation="true">
                        <!--Gagal view status, asumsi stock tidak terpotong-->
                        <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="FI10||[charge.detail]||failed deduct stock||{dbconfig:fsd.[category].notif.syserror}_-_[additional_notif_flu]"/>
                        <SA class="SyncIf" var="isFlu" compare="1">
                           <SA class="SyncAssignVariable" var="SMS" value="NOSMS"/>
                        </SA>
                        <SA class="SyncTempRequest" service="FSD" option="remove"/>
                        <SA class="SyncBreak"/>
                     </SA>
                     <SA class="SyncIf" var="status.oriTransStatus" compare="0" negation="true">
                        <SA class="SyncIf" var="status.oriTransStatus" compare="4">
                           <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="OK01||stockNotEnough||[status.oriTransStatus]||{dbconfig:fsd.[category].notif.[notifCommand]stockNotEnough}"/>
                           <SA class="SyncIf" var="isFlu" compare="1">
                              <SA class="SyncAssignVariable" var="SMS" value="NOSMS"/>
                           </SA>
                           <SA class="SyncTempRequest" service="FSD" option="remove"/>
                           <SA class="SyncBreak"/>
                        </SA>
                        <SA class="SyncIf" var="status.oriTransStatus" compare="5">
                           <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="OK01||denomNotExist||[status.oriTransStatus]||{dbconfig:fsd.[category].notif.[notifCommand]denomNotExist}"/>
                           <SA class="SyncIf" var="isFlu" compare="1">
                              <SA class="SyncAssignVariable" var="SMS" value="NOSMS"/>
                           </SA>
                           <SA class="SyncTempRequest" service="FSD" option="remove"/>
                           <SA class="SyncBreak"/>
                        </SA>
                        <SA class="SyncIf" var="status.oriTransStatus" compare="10">
                           <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="OK01||pinIncorrect||[status.oriTransStatus]||{dbconfig:fsd.[category].notif.[notifCommand]pinIncorrect}"/>
                           <SA class="SyncIf" var="isFlu" compare="1">
                              <SA class="SyncAssignVariable" var="SMS" value="NOSMS"/>
                           </SA>
                           <SA class="SyncTempRequest" service="FSD" option="remove"/>
                           <SA class="SyncBreak"/>
                        </SA>
                        <!--Valid stock belum kepotong-->
                        <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="FI10||[status.oriTransStatus]||[charge.detail]||{dbconfig:fsd.[category].notif.syserror}_-_[additional_notif_flu]"/>
                        <SA class="SyncIf" var="isFlu" compare="1">
                           <SA class="SyncAssignVariable" var="SMS" value="NOSMS"/>
                        </SA>
                        <SA class="SyncTempRequest" service="FSD" option="remove"/>
                        <SA class="SyncBreak"/>
                     </SA>
                     <SA class="SyncAssignVariable" var="charge" value="0"/>
                  </case>
                  <case code="default">
                     <SA class="SyncIf" var="charge" compare="4">
                        <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="OK01||stockNotEnough||[charge]||{dbconfig:fsd.[category].notif.[notifCommand]stockNotEnough}"/>
                        <SA class="SyncIf" var="isFlu" compare="1">
                           <SA class="SyncAssignVariable" var="SMS" value="NOSMS"/>
                        </SA>
                        <SA class="SyncTempRequest" service="FSD" option="remove"/>
                        <SA class="SyncBreak"/>
                     </SA>
                     <SA class="SyncIf" var="charge" compare="5">
                        <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="OK01||denomNotExist||[charge]||{dbconfig:fsd.[category].notif.[notifCommand]denomNotExist}"/>
                        <SA class="SyncIf" var="isFlu" compare="1">
                           <SA class="SyncAssignVariable" var="SMS" value="NOSMS"/>
                        </SA>
                        <SA class="SyncTempRequest" service="FSD" option="remove"/>
                        <SA class="SyncBreak"/>
                     </SA>
                     <SA class="SyncIf" var="charge" compare="10">
                        <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="OK01||pinIncorrect||[charge]||{dbconfig:fsd.[category].notif.[notifCommand]pinIncorrect}"/>
                        <SA class="SyncIf" var="isFlu" compare="1">
                           <SA class="SyncAssignVariable" var="SMS" value="NOSMS"/>
                        </SA>
                        <SA class="SyncTempRequest" service="FSD" option="remove"/>
                        <SA class="SyncBreak"/>
                     </SA>
                     <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="FI10||[charge]||[charge.detail]||{dbconfig:fsd.[category].notif.syserror}_-_[additional_notif_flu]"/>
                     <SA class="SyncIf" var="isFlu" compare="1">
                        <SA class="SyncAssignVariable" var="SMS" value="NOSMS"/>
                     </SA>
                     <SA class="SyncTempRequest" service="FSD" option="remove"/>
                     <SA class="SyncBreak"/>
                  </case>
               </SA>
            </SA>
         </case>
         <case code="default">
            <SA class="INPlugin" id="charge" saveValue="true" Type="charge" bMsisdn="[chargeMsisdn]" bNumber="[adn]" InpluginTimeout="{dbconfig:InpluginTimeout}" InpluginAppsid="[chargeAppsid]" InpluginPwd="[chargePassword]" InpluginOrderid="[orderid]" InpluginCpname="[cpname]"/>
            <SA class="SyncIf" var="charge" compare="3:21|3:27">
               <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="OK01||notEnoughBalance||[charge]||{dbconfig:fsd.[category].notif.[notifCommand]minimumBalanceAfterCharge}"/>
               <SA class="SyncIf" var="isFlu" compare="1">
                  <SA class="SyncAssignVariable" var="SMS" value="NOSMS"/>
               </SA>
               <!--FLASH GIFT AUTO RENEW TAKEOUT-->
               <SA class="SyncIf" var="giftautorenew" compare="TRUE">
                  <SA class="SyncDbUpdate" dataSource="dbsession" requestor="[bonusMsisdn]">DELETE FROM fsd_gift_subscription WHERE bmsisdn='[bonusMsisdn]' AND amsisdn='[chargeMsisdn]'</SA>
               </SA>
               <SA class="SyncTempRequest" service="FSD" option="remove"/>
               <SA class="SyncBreak"/>
            </SA>
            <SA class="SyncIf" var="charge" compare="2" negation="true">
               <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="FI01||[charge]||charging failed||{dbconfig:fsd.[category].notif.syserror}_-_[additional_notif_flu]"/>
               <SA class="SyncIf" var="isFlu" compare="1">
                  <SA class="SyncAssignVariable" var="SMS" value="NOSMS"/>
               </SA>
               <!--FLASH GIFT AUTO RENEW TAKEOUT-->
               <SA class="SyncIf" var="giftautorenew" compare="TRUE">
                  <SA class="SyncDbUpdate" dataSource="dbsession" requestor="[bonusMsisdn]">DELETE FROM fsd_gift_subscription WHERE bmsisdn='[bonusMsisdn]' AND amsisdn='[chargeMsisdn]'</SA>
               </SA>
               <SA class="SyncTempRequest" service="FSD" option="remove"/>
               <SA class="SyncBreak"/>
            </SA>
         </case>
      </SA>
      <!--Get Parameter for dm offer-->
      <SA class="SyncIf" var="product_dm_offer" compare="|null|NULL" negation="true">
         <SA class="JsonParse" var="jsonDM" input="[product_dm_offer]"/>
         <SA class="SyncIf" var="jsonDM.dm_ON" compare="|null|NULL" negation="true">
            <SA class="SyncAssignVariable" var="dm_ON" value="[jsonDM.dm_ON]"/>
            <SA class="SyncAssignVariable" var="dm_OFF" value="[jsonDM.dm_OFF]"/>
         </SA>
      </SA>
      <SA class="SyncIf" var="discount_dm_offer" compare="|null|NULL" negation="true">
         <SA class="JsonParse" var="jsonDM" input="[discount_dm_offer]"/>
         <SA class="SyncIf" var="jsonDM.dm_ON" compare="|null|NULL" negation="true">
            <SA class="SyncAssignVariable" var="dm_ON" value="[jsonDM.dm_ON]"/>
            <SA class="SyncAssignVariable" var="dm_OFF" value="[jsonDM.dm_OFF]"/>
         </SA>
      </SA>
      <!--Provisioning DM-->
      <SA class="SyncIf" var="dm_ON" compare="|null|NULL" negation="true">
         <SA class="SyncAssignVariable" var="dm_adn" value="{dbconfig:dm.adn}"/>
         <SA class="SyncDbSingleQuery" dataSource="jdbc/reflex" varPrefix="dm_">select DATE_FORMAT(ADDDATE(CURDATE(), INTERVAL ([interval]-1) DAY), '%Y%m%d') end_date</SA>
         <SA class="SyncSubmitDM" id="dm_response" saveValue="true" RequestMethod="POST" AppKey="{dbconfig:dm.username}" AppSecret="{dbconfig:dm.password}" ContentType="text/plain" urlStr="{dbconfig:dm.url}" contentBody="{dbconfig:dm.content}"/>
         <SA class="SyncIf" var="dm_response" compare="|null|NULL">
            <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="FDM01||null||dm timeout||{dbconfig:fsd.[category].notif.syserror}_-_[additional_notif_flu]"/>
            <SA class="SyncIf" var="isFlu" compare="1">
               <SA class="SyncAssignVariable" var="SMS" value="NOSMS"/>
            </SA>
            <SA class="SyncTempRequest" service="FSD" option="remove"/>
            <SA class="SyncBreak"/>
         </SA>
         <SA class="SyncStringUtility" var="dm_success" type="regex" param1="[dm_response]" param2=".*&quot;resp_code&quot;:\s*&quot;200&quot;.*"/>
         <SA class="SyncIf" var="dm_success" compare="1" negation="true">
            <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="FDM02||[dm_response]||dm failed||{dbconfig:fsd.[category].notif.syserror}_-_[additional_notif_flu]"/>
            <SA class="SyncIf" var="isFlu" compare="1">
               <SA class="SyncAssignVariable" var="SMS" value="NOSMS"/>
            </SA>
            <SA class="SyncTempRequest" service="FSD" option="remove"/>
            <SA class="SyncBreak"/>
         </SA>
      </SA>
      <!--Provisioning SAPC-->
      <SA class="SyncIf" var="allowFSDProvSAPC" compare="TRUE">
         <SA class="SyncIf" var="ProvSapcPackage" compare="|null|NULL" negation="true">
            <SA class="UpccProvisioning" id="QoSProfile" type="add" msisdn="[bonusMsisdn]" sapcPackage="[ProvSapcPackage]"/>
            <SA class="SyncIf" var="QoSProfile" compare="1" negation="true">
               <SA class="SyncSwitch" input="isMkios">
                  <case code="TRUE">
                     <SA var="refund" class="MKIOSPlugin" msisdn="[chargeMsisdn]" type="refund" pin="[mkios_pin]" bMsisdn="[bonusMsisdn]" lac="[mkios_lac]" ci="[mkios_ci]" productId="[mkios_productId]" oriTxid="[charge.txid]"/>
                     <SA class="SyncIf" var="refund" compare="0" negation="true">
                        <SA class="SyncSwitch" input="refund.detail">
                           <case code="FAILED">
                              <SA var="status" class="MKIOSPlugin" msisdn="[chargeMsisdn]" type="status" pin="[mkios_pin]" bMsisdn="[bonusMsisdn]" lac="[mkios_lac]" ci="[mkios_ci]" productId="[mkios_productId]" oriTxid="[refund.txid]"/>
                              <SA class="SyncIf" var="status" compare="0" negation="true">
                                 <!--Gagal view status, asumsi refund gagal-->
                                 <SA class="SyncDbUpdate" saveValue="true" dataSource="dbsession" requestor="[chargeMsisdn]">INSERT IGNORE INTO refund_mkios (service, trx_id, msisdn, bMsisdn, pin, lac, ci, productId, trx_date, last_try, last_result) VALUES ('FSD', '[charge.txid]', '[chargeMsisdn]', '[bonusMsisdn]', '[mkios_pin]', '[mkios_lac]', '[mkios_ci]', '[mkios_productId]', CURDATE(), NULL, NULL);</SA>
                                 <SA class="SyncAssignVariable" var="note" value="refund MKIOS failed ([refund.detail])"/>
                              </SA>
                              <SA class="SyncIf" var="status" compare="0">
                                 <SA class="SyncIf" var="status.oriTransStatus" compare="0" negation="true">
                                    <!--Valid refund gagal-->
                                    <SA class="SyncDbUpdate" saveValue="true" dataSource="dbsession" requestor="[chargeMsisdn]">INSERT IGNORE INTO refund_mkios (service, trx_id, msisdn, bMsisdn, pin, lac, ci, productId, trx_date, last_try, last_result) VALUES ('FSD', '[charge.txid]', '[chargeMsisdn]', '[bonusMsisdn]', '[mkios_pin]', '[mkios_lac]', '[mkios_ci]', '[mkios_productId]', CURDATE(), NULL, NULL);</SA>
                                    <SA class="SyncAssignVariable" var="note" value="refund MKIOS failed ([status.oriTransStatus])"/>
                                 </SA>
                              </SA>
                           </case>
                           <case code="default">
                              <SA class="SyncDbUpdate" saveValue="true" dataSource="dbsession" requestor="[chargeMsisdn]">INSERT IGNORE INTO refund_mkios (service, trx_id, msisdn, bMsisdn, pin, lac, ci, productId, trx_date, last_try, last_result) VALUES ('FSD', '[charge.txid]', '[chargeMsisdn]', '[bonusMsisdn]', '[mkios_pin]', '[mkios_lac]', '[mkios_ci]', '[mkios_productId]', CURDATE(), NULL, NULL);</SA>
                              <SA class="SyncAssignVariable" var="note" value="refund MKIOS failed ([refund.detail])"/>
                           </case>
                        </SA>
                     </SA>
                  </case>
                  <case code="default">
                     <SA class="INPlugin" id="refund" saveValue="true" Type="refund" bMsisdn="[chargeMsisdn]" bNumber="[adn]" InpluginTimeout="{dbconfig:InpluginTimeout}" InpluginAppsid="[chargeAppsid]" InpluginPwd="[chargePassword]" InpluginOrderid="[orderid]" InpluginCpname="[cpname]"/>
                     <SA class="SyncIf" var="refund" compare="2" negation="true">
                        <SA class="SyncDbUpdate" saveValue="true" dataSource="dbsession" requestor="[chargeMsisdn]">INSERT INTO refund VALUES('FSD', '[txid]', '[chargeMsisdn]', '[chargeAppsid]', '[chargePassword]')</SA>
                        <SA class="SyncAssignVariable" var="note" value="refund failed([refund])"/>
                     </SA>
                  </case>
               </SA>
               <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="FP12||[QoSProfile.detail]||SAPC failed, refund success||{dbconfig:fsd.[category].notif.syserror}_-_[additional_notif_flu]"/>
               <SA class="SyncIf" var="isFlu" compare="1">
                  <SA class="SyncAssignVariable" var="SMS" value="NOSMS"/>
               </SA>
               <SA class="SyncTempRequest" service="FSD" option="remove"/>
               <!--Rollback DM-->
               <SA class="SyncIf" var="dm_success" compare="1">
                  <SA class="SyncAssignVariable" var="dm_ON" value="[dm_OFF]"/>
                  <SA class="SyncSubmitDM" id="dm_rollback" saveValue="true" RequestMethod="POST" AppKey="{dbconfig:dm.username}" AppSecret="{dbconfig:dm.password}" ContentType="text/plain" urlStr="{dbconfig:dm.url}" contentBody="{dbconfig:dm.content}"/>
                  <SA class="SyncStringUtility" var="dm_rollback_success" type="regex" param1="[dm_rollback]" param2=".*&quot;resp_code&quot;:\s*&quot;200&quot;.*"/>
                  <SA class="SyncIf" var="dm_rollback_success" compare="1" negation="true">
                     <!--Insert to pending action-->
                     <SA class="SyncDbUpdate" dataSource="dbsession" requestor="[bonusMsisdn]">INSERT IGNORE INTO pending_action (msisdn, service, type, ts, txid, info) 
								VALUES ('[bonusMsisdn]', 'DM', 'retry', NOW(), '[txid]', '[dm_end_date];[dm_ON]')</SA>
                  </SA>
               </SA>
               <SA class="SyncBreak"/>
            </SA>
         </SA>
      </SA>
      <!--Inject bucket-->
      <SA class="SyncSwitch" input="category">
         <case code="RECHARGE">
            <SA var="bonus" class="RechargePlugin" reseller="[recharge_reseller]" bMsisdn="[bonusMsisdn]" lac="" ci="" lac_subs="[recharge_lac]" ci_subs="[recharge_ci]" productId="[recharge_productId]" denom="[recharge_denom]" dspnode="" dspnodeSubs="[getDSP.node]"/>
            <SA class="SyncIf" var="bonus" compare="0" negation="true">
               <SA class="SyncAssignVariable" var="note" value=""/>
               <SA class="INPlugin" id="refund" saveValue="true" Type="refund" bMsisdn="[chargeMsisdn]" bNumber="[adn]" InpluginTimeout="{dbconfig:InpluginTimeout}" InpluginAppsid="[chargeAppsid]" InpluginPwd="[chargePassword]" InpluginOrderid="[orderid]" InpluginCpname="[cpname]"/>
               <SA class="SyncIf" var="refund" compare="2" negation="true">
                  <SA class="SyncDbUpdate" saveValue="true" dataSource="dbsession" requestor="[chargeMsisdn]">INSERT INTO refund VALUES('FSD', '[txid]', '[chargeMsisdn]', '[chargeAppsid]', '[chargePassword]')</SA>
                  <SA class="SyncAssignVariable" var="note" value="refund failed([refund])"/>
               </SA>
               <!--Reset SAPC-->
               <SA class="SyncIf" var="allowFSDProvSAPC" compare="TRUE">
                  <SA class="SyncIf" var="sapcProfilePrevious" compare="">
                     <SA class="SyncIf" var="ProvSapcPackage" compare="|null|NULL" negation="true">
                        <SA id="deleteSapcProvision" class="UpccProvisioning" type="remove" msisdn="[bonusMsisdn]" sapcPackage="[ProvSapcPackage]"/>
                        <SA class="SyncIf" var="deleteSapcProvision" compare="1" negation="true">
                           <!--Failed, we will try again in Pending Action-->
                           <SA class="SyncDbUpdate" dataSource="dbsession" requestor="[bonusMsisdn]">INSERT IGNORE INTO pending_action (msisdn, service, type, ts, txid, info) 
										VALUES ('[bonusMsisdn]', 'RS', 'RemoveQoSProfile3', NOW(), '[txid]', '[ProvSapcPackage] [_productId]')</SA>
                           <SA class="SyncAssignVariable" var="note" value="[note], remove Upcc failed([deleteSapcProvision.detail])"/>
                        </SA>
                     </SA>
                  </SA>
               </SA>
               <!--Rollback DM-->
               <SA class="SyncIf" var="dm_success" compare="1">
                  <SA class="SyncAssignVariable" var="dm_ON" value="[dm_OFF]"/>
                  <SA class="SyncSubmitDM" id="dm_rollback" saveValue="true" RequestMethod="POST" AppKey="{dbconfig:dm.username}" AppSecret="{dbconfig:dm.password}" ContentType="text/plain" urlStr="{dbconfig:dm.url}" contentBody="{dbconfig:dm.content}"/>
                  <SA class="SyncIf" var="dm_rollback" compare="|null|NULL">
                     <!--Insert to pending action-->
                     <SA class="SyncDbUpdate" dataSource="dbsession" requestor="[bonusMsisdn]">INSERT IGNORE INTO pending_action (msisdn, service, type, ts, txid, info) 
								VALUES ('[bonusMsisdn]', 'DM', retry, NOW(), '[txid]', '[dm_end_date];[dm_ON]')</SA>
                  </SA>
                  <SA class="SyncStringUtility" var="dm_rollback_success" type="regex" param1="[dm_rollback]" param2=".*&quot;resp_code&quot;:\s*&quot;200&quot;.*"/>
                  <SA class="SyncIf" var="dm_rollback_success" compare="1" negation="true">
                     <!--Insert to pending action-->
                     <SA class="SyncDbUpdate" dataSource="dbsession" requestor="[bonusMsisdn]">INSERT IGNORE INTO pending_action (msisdn, service, type, ts, txid, info) 
								VALUES ('[bonusMsisdn]', 'DM', 'retry', NOW(), '[txid]', '[dm_end_date];[dm_ON]')</SA>
                  </SA>
               </SA>
               <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="FI12||[bonus]||bonus failed||{dbconfig:fsd.[category].notif.syserror}_-_[additional_notif_flu]"/>
               <SA class="SyncIf" var="isFlu" compare="1">
                  <SA class="SyncAssignVariable" var="SMS" value="NOSMS"/>
               </SA>
               <SA class="SyncTempRequest" service="FSD" option="remove"/>
               <SA class="SyncBreak"/>
            </SA>
         </case>
         <case code="default">
            <SA class="INPlugin" id="bonus" saveValue="true" Type="bonus" bMsisdn="[bonusMsisdn]" bNumber="[adn]" InpluginTimeout="{dbconfig:InpluginTimeout}" InpluginAppsid="[bonusAppsid]" InpluginPwd="[bonusPassword]" InpluginOrderid="[orderid]" InpluginCpname="[cpname]"/>
            <SA class="SyncIf" var="bonus" compare="2" negation="true">
               <SA class="SyncAssignVariable" var="note" value=""/>
               <SA class="SyncSwitch" input="isMkios">
                  <case code="TRUE">
                     <SA var="refund" class="MKIOSPlugin" msisdn="[chargeMsisdn]" type="refund" pin="[mkios_pin]" bMsisdn="[bonusMsisdn]" lac="[mkios_lac]" ci="[mkios_ci]" productId="[mkios_productId]" oriTxid="[charge.txid]"/>
                     <SA class="SyncIf" var="refund" compare="0" negation="true">
                        <SA class="SyncSwitch" input="refund.detail">
                           <case code="FAILED">
                              <SA var="status" class="MKIOSPlugin" msisdn="[chargeMsisdn]" type="status" pin="[mkios_pin]" bMsisdn="[bonusMsisdn]" lac="[mkios_lac]" ci="[mkios_ci]" productId="[mkios_productId]" oriTxid="[refund.txid]"/>
                              <SA class="SyncIf" var="status" compare="0" negation="true">
                                 <SA class="SyncDbUpdate" saveValue="true" dataSource="dbsession" requestor="[chargeMsisdn]">INSERT IGNORE INTO refund_mkios (service, trx_id, msisdn, bMsisdn, pin, lac, ci, productId, trx_date, last_try, last_result) VALUES ('FSD', '[charge.txid]', '[chargeMsisdn]', '[bonusMsisdn]', '[mkios_pin]', '[mkios_lac]', '[mkios_ci]', '[mkios_productId]', CURDATE(), NULL, NULL);</SA>
                                 <SA class="SyncAssignVariable" var="note" value="refund Mkios failed ([refund.detail])"/>
                              </SA>
                              <SA class="SyncIf" var="status" compare="0">
                                 <SA class="SyncIf" var="status.oriTransStatus" compare="0" negation="true">
                                    <!--Valid refund gagal-->
                                    <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="FI11||[status.oriTransStatus]||bonus failed, refund failed = [refund.detail]||{dbconfig:fsd.[category].notif.syserror}_-_[additional_notif_flu]"/>
                                    <SA class="SyncDbUpdate" saveValue="true" dataSource="dbsession" requestor="[chargeMsisdn]">INSERT IGNORE INTO refund_mkios (service, trx_id, msisdn, bMsisdn, pin, lac, ci, productId, trx_date, last_try, last_result) VALUES ('FSD', '[charge.txid]', '[chargeMsisdn]', '[bonusMsisdn]', '[mkios_pin]', '[mkios_lac]', '[mkios_ci]', '[mkios_productId]', CURDATE(), NULL, NULL);</SA>
                                    <SA class="SyncAssignVariable" var="note" value="refund Mkios failed ([status.oriTransStatus])"/>
                                 </SA>
                              </SA>
                           </case>
                           <case code="default">
                              <SA class="SyncDbUpdate" saveValue="true" dataSource="dbsession" requestor="[chargeMsisdn]">INSERT IGNORE INTO refund_mkios (service, trx_id, msisdn, bMsisdn, pin, lac, ci, productId, trx_date, last_try, last_result) VALUES ('FSD', '[charge.txid]', '[chargeMsisdn]', '[bonusMsisdn]', '[mkios_pin]', '[mkios_lac]', '[mkios_ci]', '[mkios_productId]', CURDATE(), NULL, NULL);</SA>
                              <SA class="SyncAssignVariable" var="note" value="refund Mkios failed ([refund.detail])"/>
                           </case>
                        </SA>
                     </SA>
                  </case>
                  <case code="default">
                     <SA class="INPlugin" id="refund" saveValue="true" Type="refund" bMsisdn="[chargeMsisdn]" bNumber="[adn]" InpluginTimeout="{dbconfig:InpluginTimeout}" InpluginAppsid="[chargeAppsid]" InpluginPwd="[chargePassword]" InpluginOrderid="[orderid]" InpluginCpname="[cpname]"/>
                     <SA class="SyncIf" var="refund" compare="2" negation="true">
                        <SA class="SyncDbUpdate" saveValue="true" dataSource="dbsession" requestor="[chargeMsisdn]">INSERT INTO refund VALUES('FSD', '[txid]', '[chargeMsisdn]', '[chargeAppsid]', '[chargePassword]')</SA>
                        <SA class="SyncAssignVariable" var="note" value="refund failed ([refund])"/>
                     </SA>
                  </case>
               </SA>
               <!--Reset SAPC-->
               <SA class="SyncIf" var="allowFSDProvSAPC" compare="TRUE">
                  <SA class="SyncIf" var="sapcProfilePrevious" compare="">
                     <SA class="SyncIf" var="ProvSapcPackage" compare="|null|NULL" negation="true">
                        <SA id="deleteSapcProvision" class="UpccProvisioning" type="remove" msisdn="[bonusMsisdn]" sapcPackage="[ProvSapcPackage]"/>
                        <SA class="SyncIf" var="deleteSapcProvision" compare="1" negation="true">
                           <!--Failed, we will try again in Pending Action-->
                           <SA class="SyncDbUpdate" dataSource="dbsession" requestor="[bonusMsisdn]">INSERT IGNORE INTO pending_action (msisdn, service, type, ts, txid, info) 
										VALUES ('[bonusMsisdn]', 'RS', 'RemoveQoSProfile3', NOW(), '[txid]', '[ProvSapcPackage] [_productId]')</SA>
                           <SA class="SyncAssignVariable" var="note" value="[note], remove Upcc failed([deleteSapcProvision.detail])"/>
                        </SA>
                     </SA>
                  </SA>
               </SA>
               <!--Rollback DM-->
               <SA class="SyncIf" var="dm_success" compare="1">
                  <SA class="SyncAssignVariable" var="dm_ON" value="[dm_OFF]"/>
                  <SA class="SyncSubmitDM" id="dm_rollback" saveValue="true" RequestMethod="POST" AppKey="{dbconfig:dm.username}" AppSecret="{dbconfig:dm.password}" ContentType="text/plain" urlStr="{dbconfig:dm.url}" contentBody="{dbconfig:dm.content}"/>
                  <SA class="SyncIf" var="dm_rollback" compare="|null|NULL">
                     <!--Insert to pending action-->
                     <SA class="SyncDbUpdate" dataSource="dbsession" requestor="[bonusMsisdn]">INSERT IGNORE INTO pending_action (msisdn, service, type, ts, txid, info) 
								VALUES ('[bonusMsisdn]', 'DM', retry, NOW(), '[txid]', '[dm_end_date];[dm_ON]')</SA>
                  </SA>
                  <SA class="SyncStringUtility" var="dm_rollback_success" type="regex" param1="[dm_rollback]" param2=".*&quot;resp_code&quot;:\s*&quot;200&quot;.*"/>
                  <SA class="SyncIf" var="dm_rollback_success" compare="1" negation="true">
                     <!--Insert to pending action-->
                     <SA class="SyncDbUpdate" dataSource="dbsession" requestor="[bonusMsisdn]">INSERT IGNORE INTO pending_action (msisdn, service, type, ts, txid, info) 
								VALUES ('[bonusMsisdn]', 'DM', 'retry', NOW(), '[txid]', '[dm_end_date];[dm_ON]')</SA>
                  </SA>
               </SA>
               <SA class="SyncAssignVariable" var="errCode||detailz||desc||SMS" value="FI04||[bonus]||bonus failed||{dbconfig:fsd.[category].notif.syserror}_-_[additional_notif_flu]"/>
               <SA class="SyncIf" var="isFlu" compare="1">
                  <SA class="SyncAssignVariable" var="SMS" value="NOSMS"/>
               </SA>
               <SA class="SyncTempRequest" service="FSD" option="remove"/>
               <SA class="SyncBreak"/>
            </SA>
         </case>
      </SA>
      <!--Provisioning Multi Offer-->
      <SA class="SyncIf" var="bonusAppsid2" compare="|null|NULL" negation="true">
         <SA class="INPlugin" id="bonus2" saveValue="true" Type="bonus" bMsisdn="[bonusMsisdn]" bNumber="[adn]" InpluginTimeout="{dbconfig:InpluginTimeout}" InpluginAppsid="[bonusAppsid2]" InpluginPwd="[bonusPassword2]" InpluginOrderid="[orderid]" InpluginCpname="[cpname]"/>
         <SA class="SyncIf" var="bonus2" compare="2" negation="true">
            <!--Insert into pending bonus-->
            <SA class="SyncDbUpdate" dataSource="dbsession" requestor="[bonusMsisdn]">INSERT INTO pending_bonus (msisdn, type, bonusAppsId, bonusPwd, ts, txid, adn) 
					VALUES ('[bonusMsisdn]', 'FSD', '[bonusAppsid2]', '[bonusPassword2]', NOW(), '[txid]', '[adn]')
					ON DUPLICATE KEY UPDATE bonusAppsId = '[bonusAppsid2]', bonusPwd = '[bonusPassword2]', ts = NOW(), txid='[txid]'</SA>
         </SA>
      </SA>
      <SA class="SyncIf" var="bonusAppsid3" compare="|null|NULL" negation="true">
         <SA class="INPlugin" id="bonus3" saveValue="true" Type="bonus" bMsisdn="[bonusMsisdn]" bNumber="[adn]" InpluginTimeout="{dbconfig:InpluginTimeout}" InpluginAppsid="[bonusAppsid3]" InpluginPwd="[bonusPassword3]" InpluginOrderid="[orderid]" InpluginCpname="[cpname]"/>
         <SA class="SyncIf" var="bonus3" compare="2" negation="true">
            <!--Insert into pending bonus-->
            <SA class="SyncDbUpdate" dataSource="dbsession" requestor="[bonusMsisdn]">INSERT INTO pending_bonus (msisdn, type, bonusAppsId, bonusPwd, ts, txid, adn) 
					VALUES ('[bonusMsisdn]', 'FSD', '[bonusAppsid3]', '[bonusPassword3]', NOW(), '[txid]', '[adn]')
					ON DUPLICATE KEY UPDATE bonusAppsId = '[bonusAppsid3]', bonusPwd = '[bonusPassword3]', ts = NOW(), txid='[txid]'</SA>
         </SA>
      </SA>
      <!--Bonus IGI GiftMoreGetMore-->
      <SA class="SyncIf" var="IGI_giftMoreGetMore" compare="TRUE">
         <SA class="SyncIf" var="bonusAppsid4" compare="|null|NULL" negation="true">
            <SA class="INPlugin" id="bonus4" saveValue="true" Type="bonus" bMsisdn="[chargeMsisdn]" bNumber="[adn]" InpluginTimeout="{dbconfig:InpluginTimeout}" InpluginAppsid="[bonusAppsid4]" InpluginPwd="[bonusPassword4]" InpluginOrderid="[orderid]" InpluginCpname="[cpname]"/>
            <SA class="SyncIf" var="bonus4" compare="2" negation="true">
               <!--Insert into pending bonus-->
               <SA class="SyncDbUpdate" dataSource="dbsession" requestor="[chargeMsisdn]">INSERT INTO pending_bonus (msisdn, type, bonusAppsId, bonusPwd, ts, txid, adn) 
						VALUES ('[chargeMsisdn]', 'FSD', '[bonusAppsid4]', '[bonusPassword4]', NOW(), '[txid]', '[adn]')
						ON DUPLICATE KEY UPDATE bonusAppsId = '[bonusAppsid4]', bonusPwd = '[bonusPassword4]', ts = NOW(), txid='[txid]'</SA>
            </SA>
         </SA>
      </SA>
      <SA class="SyncIf" var="bonusAppsid5" compare="|null|NULL" negation="true">
         <SA class="INPlugin" id="bonus5" saveValue="true" Type="bonus" bMsisdn="[bonusMsisdn]" bNumber="[adn]" InpluginTimeout="{dbconfig:InpluginTimeout}" InpluginAppsid="[bonusAppsid5]" InpluginPwd="[bonusPassword5]" InpluginOrderid="[orderid]" InpluginCpname="[cpname]"/>
         <SA class="SyncIf" var="bonus5" compare="2" negation="true">
            <!--Insert into pending bonus-->
            <SA class="SyncDbUpdate" dataSource="dbsession" requestor="[bonusMsisdn]">INSERT INTO pending_bonus (msisdn, type, bonusAppsId, bonusPwd, ts, txid, adn) 
					VALUES ('[bonusMsisdn]', 'FSD', '[bonusAppsid5]', '[bonusPassword5]', NOW(), '[txid]', '[adn]')
					ON DUPLICATE KEY UPDATE bonusAppsId = '[bonusAppsid5]', bonusPwd = '[bonusPassword5]', ts = NOW(), txid='[txid]'</SA>
         </SA>
      </SA>
      <SA class="SyncIf" var="bonusAppsid6" compare="|null|NULL" negation="true">
         <SA class="INPlugin" id="bonus6" saveValue="true" Type="bonus" bMsisdn="[bonusMsisdn]" bNumber="[adn]" InpluginTimeout="{dbconfig:InpluginTimeout}" InpluginAppsid="[bonusAppsid6]" InpluginPwd="[bonusPassword6]" InpluginOrderid="[orderid]" InpluginCpname="[cpname]"/>
         <SA class="SyncIf" var="bonus6" compare="2" negation="true">
            <!--Insert into pending bonus-->
            <SA class="SyncDbUpdate" dataSource="dbsession" requestor="[bonusMsisdn]">INSERT INTO pending_bonus (msisdn, type, bonusAppsId, bonusPwd, ts, txid, adn) 
					VALUES ('[bonusMsisdn]', 'FSD', '[bonusAppsid6]', '[bonusPassword6]', NOW(), '[txid]', '[adn]')
					ON DUPLICATE KEY UPDATE bonusAppsId = '[bonusAppsid6]', bonusPwd = '[bonusPassword6]', ts = NOW(), txid='[txid]'</SA>
         </SA>
      </SA>
      <SA class="SyncIf" var="bonusAppsid7" compare="|null|NULL" negation="true">
         <SA class="INPlugin" id="bonus7" saveValue="true" Type="bonus" bMsisdn="[bonusMsisdn]" bNumber="[adn]" InpluginTimeout="{dbconfig:InpluginTimeout}" InpluginAppsid="[bonusAppsid7]" InpluginPwd="[bonusPassword7]" InpluginOrderid="[orderid]" InpluginCpname="[cpname]"/>
         <SA class="SyncIf" var="bonus7" compare="2" negation="true">
            <!--Insert into pending bonus-->
            <SA class="SyncDbUpdate" dataSource="dbsession" requestor="[bonusMsisdn]">INSERT INTO pending_bonus (msisdn, type, bonusAppsId, bonusPwd, ts, txid, adn) 
					VALUES ('[bonusMsisdn]', 'FSD', '[bonusAppsid7]', '[bonusPassword7]', NOW(), '[txid]', '[adn]')
					ON DUPLICATE KEY UPDATE bonusAppsId = '[bonusAppsid7]', bonusPwd = '[bonusPassword7]', ts = NOW(), txid='[txid]'</SA>
         </SA>
      </SA>
      <SA class="SyncIf" var="bonusAppsid8" compare="|null|NULL" negation="true">
         <SA class="INPlugin" id="bonus8" saveValue="true" Type="bonus" bMsisdn="[bonusMsisdn]" bNumber="[adn]" InpluginTimeout="{dbconfig:InpluginTimeout}" InpluginAppsid="[bonusAppsid8]" InpluginPwd="[bonusPassword8]" InpluginOrderid="[orderid]" InpluginCpname="[cpname]"/>
         <SA class="SyncIf" var="bonus8" compare="2" negation="true">
            <!--Insert into pending bonus-->
            <SA class="SyncDbUpdate" dataSource="dbsession" requestor="[bonusMsisdn]">INSERT INTO pending_bonus (msisdn, type, bonusAppsId, bonusPwd, ts, txid, adn) 
					VALUES ('[bonusMsisdn]', 'FSD', '[bonusAppsid8]', '[bonusPassword8]', NOW(), '[txid]', '[adn]')
					ON DUPLICATE KEY UPDATE bonusAppsId = '[bonusAppsid8]', bonusPwd = '[bonusPassword8]', ts = NOW(), txid='[txid]'</SA>
         </SA>
      </SA>
      <SA class="SyncIf" var="bonusExtendAppsid" compare="|null|NULL" negation="true">
         <SA class="SyncIf" var="extendLifeCycle" compare="TRUE">
            <SA class="INPlugin" id="bonusExtend" saveValue="true" Type="bonus" bMsisdn="[bonusMsisdn]" bNumber="[adn]" InpluginTimeout="{dbconfig:InpluginTimeout}" InpluginAppsid="[bonusExtendAppsid]" InpluginPwd="[bonusExtendPassword]" InpluginOrderid="[orderid]" InpluginCpname="[cpname]" Param="[newActiveDate]"/>
            <SA class="SyncIf" var="bonusExtend" compare="2" negation="true">
               <!--Insert into pending bonus-->
               <SA class="SyncDbUpdate" dataSource="dbsession" requestor="[bonusMsisdn]">INSERT INTO pending_bonus (msisdn, type, bonusAppsId, bonusPwd, param, ts, txid, adn) 
						VALUES ('[bonusMsisdn]', 'FSD', '[bonusExtendAppsid]', '[bonusExtendPassword]', '[newActiveDate]', NOW(), '[txid]', '[adn]')
						ON DUPLICATE KEY UPDATE bonusAppsId = '[bonusExtendAppsid]', bonusPwd = '[bonusExtendPassword]', param = '[newActiveDate]', ts = NOW(), txid='[txid]'</SA>
            </SA>
         </SA>
      </SA>
      <!--IN GW Open Block-->
      <SA class="SyncAssignVariable" var="allowOpenBlock" value="{dbconfig:fsd.allow.openBlock}"/>
      <SA class="SyncIf" var="allowOpenBlock" compare="TRUE">
         <SA var="openINGw" class="SyncHttpDelete" timeout="{dbconfig:accessDefault.param.openInGwTimeOut}">{dbconfig:accessDefault.param.openInGwEndPoint}msisdn=[bonusMsisdn]</SA>
         <SA class="SyncIf" var="openINGw" compare="OK" negation="true">
            <!--Insert into pending action-->
            <SA class="SyncDbUpdate" dataSource="dbsession" requestor="[bonusMsisdn]">INSERT IGNORE INTO pending_action (msisdn, service, type, ts, txid, info) VALUES ('[bonusMsisdn]', 'LandingPage', 'OpenInGw', NOW(), '[txid]', '')</SA>
         </SA>
      </SA>
      <!--Provisioning profile 3G+-->
      <SA class="SyncIf" var="prov3GPlus" compare="TRUE">
         <SA id="syncProv3GPlus" class="SyncHttpGet" saveValue="true" assertValue="" timeout="12000">{dbconfig:fsd.provision.3gplus.url}&amp;msisdn=[bonusMsisdn]&amp;trx_id=[txid]&amp;qos=[qosTPLID]</SA>
         <SA id="ExplodeChunk" class="SyncExplode" separator="\:" var="provDsp" input="[syncProv3GPlus]"/>
         <SA class="SyncIf" var="provDsp.0" compare="RO" negation="true">
            <!--Insert into pending action-->
            <SA class="SyncDbUpdate" dataSource="dbsession" requestor="[bonusMsisdn]">INSERT IGNORE INTO pending_action (msisdn, service, type, ts, txid, info) VALUES ('[bonusMsisdn]', 'Prov3GPlus', '[qosTPLID]', NOW(), '[txid]', '')</SA>
         </SA>
      </SA>
      <!--Provisioning Old-ing Imei-->
      <SA class="SyncIf" var="provOldImei" compare="1">
         <SA class="SyncIf" var="imei" compare="|null|NULL" negation="true">
            <SA class="DateUtility" id="dateOldImei" saveValue="true" Option="Today" Param1="yyyy-MM-dd" Param2="d-MMM-yy"/>
            <SA class="SyncStringUtility" var="dateOldImei" type="touppercase" param1="[dateOldImei]"/>
            <SA id="syncProvOldImei" class="SyncHttpGet" saveValue="true" assertValue="" timeout="12000"><![CDATA[{dbconfig:fsd.provision.oldImei.url}&msisdn=[bonusMsisdn]&trx_id=[txid]&show=json&imei=[imei]&flag=0&date=[dateOldImei]]]></SA>
         </SA>
      </SA>
      <!--Notification and update profile-->
      <SA class="SyncIf" var="ProvAddSapcPackage" compare="|null|NULL">
         <SA class="SyncSwitch" input="dontExtend">
            <case code="1">
               <SA class="SyncDbUpdate" dataSource="dbsession" requestor="[bonusMsisdn]">INSERT INTO fsd_subscription (msisdn, purchase_type, last_update, end_date, product_id, discount_id, reg_time, reg_location, reg_imei, category) 
						VALUES ('[bonusMsisdn]', '[_subscriptionType]', NOW(), ADDDATE(CURDATE(), INTERVAL ([interval]-1) DAY), '[_productId]', '[_discountId]', NOW(), '[location.home]', '[imei]', '[category]') 
						ON DUPLICATE KEY UPDATE last_update=NOW(), product_id='[_productId]', discount_id='[_discountId]', purchase_type='[_subscriptionType]', reg_location='[location.home]', reg_imei='[imei]';;; 

						INSERT INTO fsd_subscription_counter (msisdn, product_id, counter, status) VALUES ('[bonusMsisdn]', '[product_product_id]', 1,'1') ON DUPLICATE KEY UPDATE counter=counter+1;;; 

						INSERT INTO fsd_sapc_subscription (msisdn, category, sapc_package, product_id) VALUES ('[bonusMsisdn]', '[category]', '[ProvSapcPackage]', '[_productId]') ON DUPLICATE KEY UPDATE product_id = '[_productId]'</SA>
            </case>
            <case code="default">
               <SA class="SyncDbUpdate" dataSource="dbsession" requestor="[bonusMsisdn]">INSERT INTO fsd_subscription (msisdn, purchase_type, last_update, end_date, product_id, discount_id, reg_time, reg_location, reg_imei, category) 
						VALUES ('[bonusMsisdn]', '[_subscriptionType]', NOW(), ADDDATE(CURDATE(), INTERVAL ([interval]-1) DAY), '[_productId]', '[_discountId]', NOW(), '[location.home]', '[imei]', '[category]') 
						ON DUPLICATE KEY UPDATE last_update=NOW(), end_date=ADDDATE(CURDATE(), INTERVAL ([interval]-1) DAY), product_id='[_productId]', discount_id='[_discountId]', purchase_type='[_subscriptionType]', reg_location='[location.home]', reg_imei='[imei]';;; 

						INSERT INTO fsd_subscription_counter (msisdn, product_id, counter, status) VALUES ('[bonusMsisdn]', '[product_product_id]', 1,'1') ON DUPLICATE KEY UPDATE counter=counter+1;;; 

						INSERT INTO fsd_sapc_subscription (msisdn, category, sapc_package, product_id) VALUES ('[bonusMsisdn]', '[category]', '[ProvSapcPackage]', '[_productId]') ON DUPLICATE KEY UPDATE product_id = '[_productId]'</SA>
            </case>
         </SA>
      </SA>
      <SA class="SyncIf" var="ProvAddSapcPackage" compare="|null|NULL" negation="true">
         <SA class="SyncSwitch" input="dontExtend">
            <case code="1">
               <SA class="SyncDbUpdate" dataSource="dbsession" requestor="[bonusMsisdn]">INSERT INTO fsd_subscription (msisdn, purchase_type, last_update, end_date, product_id, discount_id, reg_time, reg_location, reg_imei, category) 
						VALUES ('[bonusMsisdn]', '[_subscriptionType]', NOW(), ADDDATE(CURDATE(), INTERVAL ([interval]-1) DAY), '[_productId]', '[_discountId]', NOW(), '[location.home]', '[imei]', '[category]') 
						ON DUPLICATE KEY UPDATE last_update=NOW(), product_id='[_productId]', discount_id='[_discountId]', purchase_type='[_subscriptionType]', reg_location='[location.home]', reg_imei='[imei]';;; 

						INSERT INTO fsd_subscription_counter (msisdn, product_id, counter, status) VALUES ('[bonusMsisdn]', '[product_product_id]', 1,'1') ON DUPLICATE KEY UPDATE counter=counter+1;;; 

						INSERT INTO fsd_sapc_subscription (msisdn, category, sapc_package, product_id) VALUES ('[bonusMsisdn]', '[category]', '[sapcExplode.0]', '[_productId]') ON DUPLICATE KEY UPDATE product_id = '[_productId]';;;
						INSERT INTO fsd_sapc_subscription (msisdn, category, sapc_package, product_id) VALUES ('[bonusMsisdn]', '[category]', '[sapcExplode.1]', '[_productId]') ON DUPLICATE KEY UPDATE product_id = '[_productId]'</SA>
            </case>
            <case code="default">
               <SA class="SyncDbUpdate" dataSource="dbsession" requestor="[bonusMsisdn]">INSERT INTO fsd_subscription (msisdn, purchase_type, last_update, end_date, product_id, discount_id, reg_time, reg_location, reg_imei, category) 
						VALUES ('[bonusMsisdn]', '[_subscriptionType]', NOW(), ADDDATE(CURDATE(), INTERVAL ([interval]-1) DAY), '[_productId]', '[_discountId]', NOW(), '[location.home]', '[imei]', '[category]') 
						ON DUPLICATE KEY UPDATE last_update=NOW(), end_date=ADDDATE(CURDATE(), INTERVAL ([interval]-1) DAY), product_id='[_productId]', discount_id='[_discountId]', purchase_type='[_subscriptionType]', reg_location='[location.home]', reg_imei='[imei]';;; 

						INSERT INTO fsd_subscription_counter (msisdn, product_id, counter, status) VALUES ('[bonusMsisdn]', '[product_product_id]', 1,'1') ON DUPLICATE KEY UPDATE counter=counter+1;;; 

						INSERT INTO fsd_sapc_subscription (msisdn, category, sapc_package, product_id) VALUES ('[bonusMsisdn]', '[category]', '[sapcExplode.0]', '[_productId]') ON DUPLICATE KEY UPDATE product_id = '[_productId]';;;
						INSERT INTO fsd_sapc_subscription (msisdn, category, sapc_package, product_id) VALUES ('[bonusMsisdn]', '[category]', '[sapcExplode.1]', '[_productId]') ON DUPLICATE KEY UPDATE product_id = '[_productId]'</SA>
            </case>
         </SA>
      </SA>
      <!--FLASH GIFT AUTO RENEWAL-->
      <SA class="SyncIf" var="giftautorenew" compare="TRUE">
         <SA class="SyncDbUpdate" dataSource="dbsession" requestor="[bonusMsisdn]">INSERT INTO fsd_gift_subscription (bmsisdn, amsisdn, keyword, renewal_date, last_update) 
				VALUES ('[bonusMsisdn]', '[chargeMsisdn]', '[nextKeywords]', ADDDATE(CURDATE(), INTERVAL ([interval]-1) DAY), NOW())
				ON DUPLICATE KEY UPDATE keyword='[nextKeywords]', last_update=NOW(), renewal_date=ADDDATE(CURDATE(), INTERVAL ([interval]-1) DAY)</SA>
      </SA>
      <SA class="SyncIf" var="giftPrepaid" compare="TRUE">
         <SA class="SyncDbUpdate" dataSource="dbsession" requestor="[msisdn]">INSERT INTO fsd_counter2 (msisdn, product_id, counter_renewal, counter_restriction, counter_redeem, end_date_restriction, end_date_redeem,counter_rule,last_activation_date,counter_gift,end_date_gift) VALUES ('[msisdn]', 'GIFT_[msisdn]', 0, 0,0, CURDATE(), CURDATE(), 0,CURDATE(),'[_counter_gift]','[newEndDateGift]') ON DUPLICATE KEY UPDATE counter_gift=[_counter_gift], end_date_gift='[newEndDateGift]'</SA>
      </SA>
      <!--Update fsd Counter Profile-->
      <SA class="SyncIf" var="product_max_counter_inperiod" compare="|null|NULL" negation="true">
         <SA class="SyncIf" var="resetRestrictCounter" compare="1" negation="true">
            <SA class="SyncDbUpdate" dataSource="dbsession" requestor="[bonusMsisdn]">INSERT INTO fsd_counter2 (msisdn, product_id, counter_renewal, counter_restriction, counter_redeem, end_date_restriction, end_date_redeem,counter_rule,last_activation_date,counter_gift,end_date_gift) VALUES ('[bonusMsisdn]', '[product_product_id]', 0, [fsd_counter_counter_restriction],[fsd_counter_counter_redeem]+1, '[fsd_counter_end_date_restriction]', ADDDATE(CURDATE(), INTERVAL ([interval]-1) DAY), 0,CURDATE(),0,CURDATE()) ON DUPLICATE KEY UPDATE counter_renewal=counter_renewal, counter_restriction=[fsd_counter_counter_restriction], counter_redeem=[fsd_counter_counter_redeem]+1, end_date_redeem=ADDDATE(CURDATE(), INTERVAL ([interval]-1) DAY),last_activation_date=CURDATE()</SA>
         </SA>
         <SA class="SyncIf" var="resetRestrictCounter" compare="1">
            <SA class="SyncDbUpdate" dataSource="dbsession" requestor="[bonusMsisdn]">INSERT INTO fsd_counter2 (msisdn, product_id, counter_renewal, counter_restriction, counter_redeem, end_date_restriction, end_date_redeem,counter_rule,last_activation_date,counter_gift,end_date_gift) VALUES ('[bonusMsisdn]', '[product_product_id]', 0, 1, [fsd_counter_counter_redeem]+1, ADDDATE(CURDATE(), INTERVAL ([interval]-1) DAY), ADDDATE(CURDATE(), INTERVAL ([interval]-1) DAY), 0,CURDATE(),0,CURDATE()) ON DUPLICATE KEY UPDATE counter_renewal=counter_renewal, counter_restriction=1, counter_redeem=[fsd_counter_counter_redeem]+1, end_date_restriction=ADDDATE(CURDATE(), INTERVAL ([interval]-1) DAY), end_date_redeem=ADDDATE(CURDATE(), INTERVAL ([interval]-1) DAY),last_activation_date=CURDATE()</SA>
         </SA>
      </SA>
      <!--Update Child Profile-->
      <SA class="SyncIf" var="command" compare="|null|NULL">
         <SA class="SyncAssignVariable" var="parent_child_role" value="[product_parent_child_role]"/>
         <SA class="SyncAssignVariable" var="parent_child_config" value="[product_parent_child_config]"/>
         <SA class="SyncIf" var="discount_id" compare="|null|NULL" negation="true">
            <SA class="SyncAssignVariable" var="parent_child_role" value="[discount_parent_child_role]"/>
            <SA class="SyncAssignVariable" var="parent_child_config" value="[discount_parent_child_config]"/>
         </SA>
         <SA class="SyncStringUtility" var="parent_child_role" type="touppercase" param1="[parent_child_role]"/>
         <SA class="SyncIf" var="parent_child_role" compare="PARENT">
            <SA class="SyncIf" var="parent_child_config" compare="|null|NULL" negation="true">
               <SA class="SyncExplode" var="parentConfig" input="[parent_child_config]" separator="\|"/>
               <SA class="SyncAssignVariable" var="interval_act_child" value="[parentConfig.0]"/>
               <SA class="SyncAssignVariable" var="adn_child" value="[parentConfig.1]"/>
               <SA class="SyncAssignVariable" var="msg_child" value="[parentConfig.2]"/>
               <SA class="SyncAssignVariable" var="category_child" value="[parentConfig.3]"/>
               <SA class="SyncAssignVariable" var="package_keyword_child" value="[parentConfig.4]"/>
               <SA class="SyncDbUpdate" dataSource="dbsession" requestor="[bonusMsisdn]">INSERT INTO `reservation` (`registration_date`, `activation_date`, `adn`, `keyword`, `msisdn`, `type`, `reminder_config`) VALUES (CURDATE(), ADDDATE(CURDATE(), INTERVAL ([interval_act_child]-1) DAY), '[adn_child]', '[msg_child]', '[bonusMsisdn]', 'CHILD_FSD_REGULAR', '[category_child]|[package_keyword_child]');</SA>
            </SA>
         </SA>
         <SA class="SyncIf" var="parent_child_role" compare="CHILD">
            <SA class="SyncAssignVariable" var="id_child" value="[k.1]"/>
            <SA class="SyncDbUpdate" dataSource="dbsession" requestor="[bonusMsisdn]">DELETE FROM reservation WHERE msisdn = '[bonusMsisdn]' AND id = '[id_child]'</SA>
         </SA>
      </SA>
      <SA class="SyncIf" var="isNEWWL" compare="TRUE">
         <SA class="SyncIf" var="schema" compare="XGETY">
            <SA class="SyncIf" var="XGETYisReset" compare="TRUE">
               <SA class="SyncDbUpdate" dataSource="dbsession" requestor="[bonusMsisdn]">INSERT INTO fsd_counter2 (msisdn, product_id, counter_renewal, counter_restriction, counter_redeem, end_date_restriction, end_date_redeem, counter_rule,last_activation_date,counter_gift,end_date_gift) VALUES ('[bonusMsisdn]', '[product_product_id]', 0, 0, 0, CURDATE(), CURDATE(), 1,CURDATE(),0,CURDATE()) ON DUPLICATE KEY UPDATE counter_rule=1,last_activation_date=CURDATE()</SA>
            </SA>
            <SA class="SyncIf" var="XGETYisReset" compare="TRUE" negation="true">
               <SA class="SyncDbUpdate" dataSource="dbsession" requestor="[bonusMsisdn]">INSERT INTO fsd_counter2 (msisdn, product_id, counter_renewal, counter_restriction, counter_redeem, end_date_restriction, end_date_redeem, counter_rule,last_activation_date,counter_gift,end_date_gift) VALUES ('[bonusMsisdn]', '[product_product_id]', 0, 0, 0, CURDATE(), CURDATE(), 1,CURDATE(),0,CURDATE()) ON DUPLICATE KEY UPDATE counter_rule=counter_rule+1,last_activation_date=CURDATE()</SA>
            </SA>
         </SA>
      </SA>
      <SA class="SyncDbSingleQuery" dataSource="dbsession" varPrefix="new_" requestor="[bonusMsisdn]">SELECT NOW() AS time, DATE_FORMAT(end_date, '%d/%m/%Y') AS end_date FROM fsd_subscription WHERE msisdn='[bonusMsisdn]' AND category = '[category]'</SA>
      <!--Post Completion to NBP, content 1-->
      <SA class="SyncIf" var="actStatusNbp" compare="|null|NULL" negation="true">
         <SA id="respPostNbp" class="SyncHttpGet" saveValue="true" assertValue="" timeout="7000">{dbconfig:fsd.postcompletion.nbp.url}adn=[actAdnNbp]&amp;sms=[actStatusNbp]&amp;msisdn=[bonusMsisdn]</SA>
         <SA class="SyncIf" var="respPostNbp" compare="FAILED|HTTP_FAILED">
            <!--Insert into pending action-->
            <SA class="SyncDbUpdate" dataSource="dbsession" requestor="[bonusMsisdn]">INSERT IGNORE INTO pending_action (msisdn, service, type, ts, txid, info) VALUES ('[bonusMsisdn]', 'NBP', '[actStatusNbp];[actAdnNbp]', NOW(), '[txid]', '')</SA>
         </SA>
      </SA>
      <!--Post Completion to NBP, content 2-->
      <SA class="SyncIf" var="actStatusNbp2" compare="|null|NULL" negation="true">
         <SA id="respPostNbp2" class="SyncHttpGet" saveValue="true" assertValue="" timeout="7000">{dbconfig:fsd.postcompletion.nbp.url}adn=[actAdnNbp2]&amp;sms=[actStatusNbp2]&amp;msisdn=[bonusMsisdn]</SA>
         <SA class="SyncIf" var="respPostNbp2" compare="FAILED|HTTP_FAILED">
            <!--Insert into pending action-->
            <SA class="SyncDbUpdate" dataSource="dbsession" requestor="[bonusMsisdn]">INSERT IGNORE INTO pending_action (msisdn, service, type, ts, txid, info) VALUES ('[bonusMsisdn]', 'NBP', '[actStatusNbp2];[actAdnNbp2]', NOW(), '[txid]', '')</SA>
         </SA>
      </SA>
      <!--Post Completion to NBP, content 3-->
      <SA class="SyncIf" var="actStatusNbp3" compare="|null|NULL" negation="true">
         <SA id="respPostNbp3" class="SyncHttpGet" saveValue="true" assertValue="" timeout="7000">{dbconfig:fsd.postcompletion.nbp.url}adn=[actAdnNbp3]&amp;sms=[actStatusNbp3]&amp;msisdn=[bonusMsisdn]</SA>
         <SA class="SyncIf" var="respPostNbp3" compare="FAILED|HTTP_FAILED">
            <!--Insert into pending action-->
            <SA class="SyncDbUpdate" dataSource="dbsession" requestor="[bonusMsisdn]">INSERT IGNORE INTO pending_action (msisdn, service, type, ts, txid, info) VALUES ('[bonusMsisdn]', 'NBP', '[actStatusNbp3];[actAdnNbp3]', NOW(), '[txid]', '')</SA>
         </SA>
      </SA>
      <!--Post Completion to NBP, content 4-->
      <SA class="SyncIf" var="actStatusNbp4" compare="|null|NULL" negation="true">
         <SA id="respPostNbp4" class="SyncHttpGet" saveValue="true" assertValue="" timeout="7000">{dbconfig:fsd.postcompletion.nbp.url}adn=[actAdnNbp4]&amp;sms=[actStatusNbp4]&amp;msisdn=[bonusMsisdn]</SA>
         <SA class="SyncIf" var="respPostNbp4" compare="FAILED|HTTP_FAILED">
            <!--Insert into pending action-->
            <SA class="SyncDbUpdate" dataSource="dbsession" requestor="[bonusMsisdn]">INSERT IGNORE INTO pending_action (msisdn, service, type, ts, txid, info) VALUES ('[bonusMsisdn]', 'NBP', '[actStatusNbp4];[actAdnNbp4]', NOW(), '[txid]', '')</SA>
         </SA>
      </SA>
      <!--Post Completion to NBP, content 5-->
      <SA class="SyncIf" var="actStatusNbp5" compare="|null|NULL" negation="true">
         <SA id="respPostNbp5" class="SyncHttpGet" saveValue="true" assertValue="" timeout="7000">{dbconfig:fsd.postcompletion.nbp.url}adn=[actAdnNbp5]&amp;sms=[actStatusNbp5]&amp;msisdn=[bonusMsisdn]</SA>
         <SA class="SyncIf" var="respPostNbp5" compare="FAILED|HTTP_FAILED">
            <!--Insert into pending action-->
            <SA class="SyncDbUpdate" dataSource="dbsession" requestor="[bonusMsisdn]">INSERT IGNORE INTO pending_action (msisdn, service, type, ts, txid, info) VALUES ('[bonusMsisdn]', 'NBP', '[actStatusNbp5];[actAdnNbp5]', NOW(), '[txid]', '')</SA>
         </SA>
      </SA>
      <SA class="SyncSwitch" input="discount_id">
         <case code="|null|NULL">
            <!--LEVEL PRODUCT-->
            <!--Counter Reset-->
            <SA class="SyncSwitch" input="product_maxCount">
               <case code="0">
                  <SA class="SyncDbUpdate" dataSource="jdbc/reflex">INSERT INTO fsd_product_discount_counter (product_id, counter) VALUES ('[_productId]', 1) ON DUPLICATE KEY UPDATE counter=counter+1, reset_date = '2070-12-31'</SA>
               </case>
               <case code="default">
                  <SA class="SyncAssignVariable" var="intervalResetQuota" value="{dbconfig:fsd.param.[_productId].intervalResetQuota}"/>
                  <SA class="SyncSwitch" input="intervalResetQuota">
                     <case code="|null|NULL">
                        <SA class="SyncDbUpdate" dataSource="jdbc/reflex">INSERT INTO fsd_product_discount_counter (product_id, counter) VALUES ('[_productId]', 1) ON DUPLICATE KEY UPDATE counter=counter+1, reset_date = '2070-12-31'</SA>
                     </case>
                     <case code="default">
                        <SA class="SyncSwitch" input="fpdc2_reset_date">
                           <case code="|null|NULL|2070-12-31">
                              <SA class="SyncDbUpdate" dataSource="jdbc/reflex">INSERT INTO fsd_product_discount_counter (product_id, counter, reset_date) VALUES ('[_productId]', 1, ADDDATE(CURDATE(), INTERVAL [intervalResetQuota] DAY)) ON DUPLICATE KEY UPDATE counter=counter+1, reset_date = ADDDATE(CURDATE(), INTERVAL [intervalResetQuota] DAY)</SA>
                           </case>
                           <case code="default">
                              <SA class="SyncDbUpdate" dataSource="jdbc/reflex">INSERT INTO fsd_product_discount_counter (product_id, counter) VALUES ('[_productId]', 1) ON DUPLICATE KEY UPDATE counter=counter+1</SA>
                           </case>
                        </SA>
                     </case>
                  </SA>
               </case>
            </SA>
            <SA class="SyncSwitch" input="product_check_imei_product">
               <case code="1">
                  <SA class="SyncIf" var="verify_valTable" compare="prodIML|prodIML2|prodIM|prodIM2|prodI|prodI2|prodIL|prodIL2">
                     <SA class="SyncIf" var="maksImeiClaimProdId" compare="-1" negation="true">
                        <SA class="SyncDbUpdate" dataSource="jdbc/whitelist">INSERT INTO fsd_product_imei_counter (imei, product_id, counter) VALUES ('[imei]', '[_productId]', 1) ON DUPLICATE KEY UPDATE counter=counter+1</SA>
                     </SA>
                  </SA>
               </case>
               <case code="default">
                  <SA class="SyncIf" var="counterImeiWithoutWhitelist" compare="|null|NULL" negation="true">
                     <SA class="SyncIf" var="maksImeiClaimProdId" compare="-1" negation="true">
                        <SA class="SyncDbUpdate" dataSource="jdbc/whitelist">INSERT INTO fsd_product_imei_counter (imei, product_id, counter) VALUES ('[imei]', '[_productId]', 1) ON DUPLICATE KEY UPDATE counter=counter+1</SA>
                     </SA>
                  </SA>
               </case>
            </SA>
         </case>
         <case code="default">
            <!--LEVEL DISCOUNT-->
            <!--Counter Reset-->
            <SA class="SyncSwitch" input="discount_maxCount">
               <case code="0">
                  <SA class="SyncDbUpdate" dataSource="jdbc/reflex">INSERT INTO fsd_product_discount_counter (product_id, discount_id, counter) VALUES ('[_productId]', '[discount_id]', 1) ON DUPLICATE KEY UPDATE counter=counter+1, reset_date = '2070-12-31'</SA>
               </case>
               <case code="default">
                  <SA class="SyncAssignVariable" var="intervalResetQuota" value="{dbconfig:fsd.param.[_productId]-[discount_id].intervalResetQuota}"/>
                  <SA class="SyncSwitch" input="intervalResetQuota">
                     <case code="|null|NULL">
                        <SA class="SyncDbUpdate" dataSource="jdbc/reflex">INSERT INTO fsd_product_discount_counter (product_id, discount_id, counter) VALUES ('[_productId]', '[discount_id]', 1) ON DUPLICATE KEY UPDATE counter=counter+1, reset_date = '2070-12-31'</SA>
                     </case>
                     <case code="default">
                        <SA class="SyncSwitch" input="fpdc_reset_date">
                           <case code="|null|NULL|2070-12-31">
                              <SA class="SyncDbUpdate" dataSource="jdbc/reflex">INSERT INTO fsd_product_discount_counter (product_id, discount_id, counter, reset_date) VALUES ('[_productId]', '[discount_id]', 1, ADDDATE(CURDATE(), INTERVAL [intervalResetQuota] DAY)) ON DUPLICATE KEY UPDATE counter=counter+1, reset_date = ADDDATE(CURDATE(), INTERVAL [intervalResetQuota] DAY)</SA>
                           </case>
                           <case code="default">
                              <SA class="SyncDbUpdate" dataSource="jdbc/reflex">INSERT INTO fsd_product_discount_counter (product_id, discount_id, counter) VALUES ('[_productId]', '[discount_id]', 1) ON DUPLICATE KEY UPDATE counter=counter+1</SA>
                           </case>
                        </SA>
                     </case>
                  </SA>
               </case>
            </SA>
            <SA class="SyncSwitch" input="product_check_imei_discount">
               <case code="1">
                  <SA class="SyncIf" var="get_valTable" compare="discIML|discIML2|discIM|discIM2|discI|discI2|discIL|discIL2">
                     <SA class="SyncIf" var="maksImeiClaimDiscId" compare="-1" negation="true">
                        <SA class="SyncDbUpdate" dataSource="jdbc/whitelist">INSERT INTO fsd_discount_imei_counter (imei, discount_id, counter) VALUES ('[imei]', '[discount_id]', 1) ON DUPLICATE KEY UPDATE counter=counter+1</SA>
                     </SA>
                  </SA>
               </case>
               <case code="default">
                  <SA class="SyncIf" var="counterImeiWithoutWhitelist" compare="|null|NULL" negation="true">
                     <SA class="SyncIf" var="maksImeiClaimDiscId" compare="-1" negation="true">
                        <SA class="SyncDbUpdate" dataSource="jdbc/whitelist">INSERT INTO fsd_discount_imei_counter (imei, discount_id, counter) VALUES ('[imei]', '[discount_id]', 1) ON DUPLICATE KEY UPDATE counter=counter+1</SA>
                     </SA>
                  </SA>
               </case>
            </SA>
         </case>
      </SA>
      <!--Update Status Voucher Code-->
      <SA class="SyncIf" var="voucher_code" compare="|null|NULL" negation="true">
         <SA class="SyncDbUpdate" dataSource="jdbc/whitelist">UPDATE wl_group_voucher_imei SET status = '1' WHERE product_id = '[_productId]' AND imei = '[imei]' AND voucher_code = '[voucher_code]'</SA>
      </SA>
      <!--Delete FLU Whitelist-->
      <SA class="SyncIf" var="isFlu" compare="1">
         <SA class="SyncDbUpdate" dataSource="jdbc/whitelist">DELETE FROM flu_whitelist WHERE msisdn = '[bonusMsisdn]'</SA>
      </SA>
      <!--SMART Charging-->
      <SA class="SyncSwitch" input="isSmart">
         <case code="1">
            <!--Save Product Origin and Product SMART-->
            <SA class="SyncDbUpdate" dataSource="dbsession" requestor="[bonusMsisdn]">INSERT INTO smart_subscription (msisdn, product_ori, product_smart) VALUES ('[bonusMsisdn]', '[smart_ori_product_id]#[smart_ori_purchase_type]', '[smart_smart_product_id]') ON DUPLICATE KEY UPDATE product_smart='[smart_smart_product_id]'</SA>
            <SA class="SyncTempRequest" service="SMART" option="remove"/>
         </case>
         <case code="default">
            <SA class="SyncDbUpdate" dataSource="dbsession" requestor="[bonusMsisdn]">DELETE FROM smart_subscription WHERE msisdn = '[bonusMsisdn]'</SA>
            <SA class="SyncTempRequest" service="SMART" option="remove"/>
         </case>
      </SA>
      <!--Added Task-->
      <SA class="SyncExplode" var="check" input="[product_added_task]" separator="\:"/>
      <SA class="SyncStringUtility" var="check.0" type="touppercase" param1="[check.0]"/>
      <SA class="SyncIf" var="check.0" compare="NEW">
         <SA class="SyncAssignVariable" var="format_addedtask" value="NEW"/>
         <SA class="SyncIf" var="product_added_task" compare="|null|NULL" negation="true">
            `
            <SA class="SyncAssignVariable" var="product_added_task" value="[check.1]"/>
            <SA class="SyncExplode" var="task" input="[product_added_task]" separator="\|"/>
            <SA Input2="1" Input1="[task.size]" Operator="-" Msisdn="" saveValue="True" id="size" class="Arithmetic"/>
            <SA id="valbnumber" class="SyncAssertExpression" var="size" operator=">" value="4" saveValue="true"/>
            <SA class="SyncIf" var="valbnumber" compare="1">
               <SA class="SyncAssignVariable" var="size" value="4"/>
            </SA>
            <SA class="SyncLoopIterator" var="count" start="0" end="[size]">
               <SA class="SyncDbSingleQuery" dataSource="jdbc/whitelist" varPrefix="_">SELECT * FROM fsd_added_task WHERE id = '[task.[count]]'</SA>
               <SA class="SyncAssignVariable" var="added_task" value=""/>
               <SA class="SyncIf" var="_id" compare="|null|NULL" negation="true">
                  <SA class="SyncSwitch" input="_type">
                     <case code="HitFrontend">
                        <SA class="SyncExplode" var="param" input="[_detail]" separator="\|"/>
                        <SA id="added_task" class="HitFrontend" adn="[param.0]" msg="[param.1]" msisdn="[param.2]"/>
                     </case>
                     <case code="InsertDB">
                        <SA class="SyncSwitch" input="discount_id">
                           <case code="|null|NULL">
                              <SA class="SyncAssignVariable" var="product" value="[product_product_id]"/>
                              <SA class="SyncExplode" var="param" input="[_detail]" separator="\|"/>
                              <SA class="SyncDbUpdate" dataSource="[param.0]" requestor="[param.1]">[param.2]</SA>
                              <SA class="SyncAssignVariable" var="added_task" value="Inserted"/>
                           </case>
                           <case code="default">
                              <SA class="SyncAssignVariable" var="product" value="[discount_id]"/>
                              <SA class="SyncExplode" var="param" input="[_detail]" separator="\|"/>
                              <SA class="SyncDbUpdate" dataSource="[param.0]" requestor="[param.1]">[param.2]</SA>
                              <SA class="SyncAssignVariable" var="added_task" value="Inserted"/>
                           </case>
                        </SA>
                     </case>
                     <case code="default">
                        <SA saveValue="true" id="added_task" class="SyncHttpGet" assertValue="^.*$">[_detail]</SA>
                        <SA class="SyncStringUtility" type="replaceAll" param1="[added_task]" param2="\|" param3=" " var="added_task"/>
                     </case>
                  </SA>
               </SA>
               <SA class="SyncSwitch" input="count">
                  <case code="0">
                     <SA class="SyncAssignVariable" var="add1" value="[added_task]"/>
                     <SA class="SyncStringUtility" type="replaceAll" param1="[add1]" param2="\|" param3="\#" var="add1"/>
                  </case>
                  <case code="1">
                     <SA class="SyncAssignVariable" var="add2" value="[added_task]"/>
                     <SA class="SyncStringUtility" type="replaceAll" param1="[add2]" param2="\|" param3="\#" var="add2"/>
                  </case>
                  <case code="2">
                     <SA class="SyncAssignVariable" var="add3" value="[added_task]"/>
                     <SA class="SyncStringUtility" type="replaceAll" param1="[add3]" param2="\|" param3="\#" var="add3"/>
                  </case>
                  <case code="3">
                     <SA class="SyncAssignVariable" var="add4" value="[added_task]"/>
                     <SA class="SyncStringUtility" type="replaceAll" param1="[add4]" param2="\|" param3="\#" var="add4"/>
                  </case>
                  <case code="4">
                     <SA class="SyncAssignVariable" var="add5" value="[added_task]"/>
                     <SA class="SyncStringUtility" type="replaceAll" param1="[add5]" param2="\|" param3="\#" var="add5"/>
                  </case>
               </SA>
               <SA class="SyncAssignVariable" var="_id" value=""/>
            </SA>
         </SA>
      </SA>
      <SA class="SyncIf" var="check.0" compare="NEW" negation="true">
         <SA class="SyncIf" var="product_added_task" compare="|null|NULL" negation="true">
            <SA class="SyncAssignVariable" var="format_addedtask" value="OLD"/>
            <SA class="SyncExplode" var="task" input="[product_added_task]" separator="\|"/>
            <SA class="SyncSwitch" input="task.0">
               <case code="HitFrontend">
                  <SA id="added_task" class="HitFrontend" adn="[task.1]" msg="[task.2]" msisdn="[rewardMsisdn]"/>
                  <SA id="ExplodeChunk" class="SyncExplode" separator="\s+" var="chunk_added_task" input="[added_task]"/>
               </case>
               <case code="HitFrontendGift">
                  <SA id="added_task" class="HitFrontend" adn="[task.1]" msg="[task.2] [bonusMsisdn]" msisdn="[rewardMsisdn]"/>
                  <SA id="ExplodeChunk" class="SyncExplode" separator="\s+" var="chunk_added_task" input="[added_task]"/>
               </case>
               <case code="Anniversary">
                  <SA class="SyncSwitch" input="discount_id">
                     <case code="|null|NULL">
                        <SA class="SyncDbUpdate" dataSource="dbsession" requestor="[rewardMsisdn]">INSERT INTO tsel_point (msisdn, product_id, counter, add_date) VALUES ('[rewardMsisdn]', '[product_product_id]', 1, CURDATE()) ON DUPLICATE KEY UPDATE counter=counter+1</SA>
                     </case>
                     <case code="default">
                        <SA class="SyncDbUpdate" dataSource="dbsession" requestor="[rewardMsisdn]">INSERT INTO tsel_point (msisdn, product_id, counter, add_date) VALUES ('[rewardMsisdn]', '[discount_id]', 1, CURDATE()) ON DUPLICATE KEY UPDATE counter=counter+1</SA>
                     </case>
                  </SA>
               </case>
               <case code="Anniversary2">
                  <SA class="SyncSwitch" input="discount_id">
                     <case code="|null|NULL">
                        <SA class="SyncDbUpdate" dataSource="dbsession" requestor="[bonusMsisdn]">INSERT INTO tsel_point (msisdn, product_id, counter, add_date) VALUES ('[bonusMsisdn]', '[product_product_id]', 1, CURDATE()) ON DUPLICATE KEY UPDATE counter=counter+1</SA>
                     </case>
                     <case code="default">
                        <SA class="SyncDbUpdate" dataSource="dbsession" requestor="[bonusMsisdn]">INSERT INTO tsel_point (msisdn, product_id, counter, add_date) VALUES ('[bonusMsisdn]', '[discount_id]', 1, CURDATE()) ON DUPLICATE KEY UPDATE counter=counter+1</SA>
                     </case>
                  </SA>
               </case>
               <case code="WiFiv2">
                  <SA id="added_task" class="HitFrontend" adn="[task.1]" msg="[task.2]" msisdn="[bonusMsisdn]"/>
                  <SA id="ExplodeChunk" class="SyncExplode" separator="\s+" var="chunk_added_task" input="[added_task]"/>
               </case>
               <case code="default">
                  <SA saveValue="true" id="added_task" class="SyncHttpGet" assertValue="^.*$">[task.0]</SA>
                  <SA id="ExplodeChunk" class="SyncExplode" separator="\s+" var="chunk_added_task" input="[added_task]"/>
                  <SA class="SyncIf" var="task.1" compare="Anniversary">
                     <SA class="SyncSwitch" input="discount_id">
                        <case code="|null|NULL">
                           <SA class="SyncDbUpdate" dataSource="dbsession" requestor="[rewardMsisdn]">INSERT INTO tsel_point (msisdn, product_id, counter, add_date) VALUES ('[rewardMsisdn]', '[product_product_id]', 1, CURDATE()) ON DUPLICATE KEY UPDATE counter=counter+1</SA>
                        </case>
                        <case code="default">
                           <SA class="SyncDbUpdate" dataSource="dbsession" requestor="[rewardMsisdn]">INSERT INTO tsel_point (msisdn, product_id, counter, add_date) VALUES ('[rewardMsisdn]', '[discount_id]', 1, CURDATE()) ON DUPLICATE KEY UPDATE counter=counter+1</SA>
                        </case>
                     </SA>
                  </SA>
               </case>
            </SA>
            <SA class="SyncIf" var="task.1" compare="WiFiv2">
               <SA id="added_task2" class="HitFrontend" adn="[task.2]" msg="[task.3]" msisdn="[bonusMsisdn]"/>
               <SA id="ExplodeChunk" class="SyncExplode" separator="\s+" var="chunk_added_task2" input="[added_task2]"/>
            </SA>
         </SA>
      </SA>
      <!--TCASH LOOP-->
      <SA class="SyncIf" var="product_sub_category" compare="tcashloop">
         <SA class="SyncAssignVariable" var="loop_day_increment_endDate" value="{dbconfig:fsd.tcashloop.increment.day}"/>
         <SA class="SyncAssignVariable" var="loop_day_increment_ResetDate" value="{dbconfig:fsd.tcashloop.increment.day}"/>
         <!--<SA Input2="[loop_day_increment_endDate]" Input1="[loop_day_increment_endDate]" Operator="+" Msisdn="" id="loop_day_increment_ResetDate" saveValue="True" Information="" class="Arithmetic" />-->
         <SA Input2="1" Input1="[loop_day_increment_endDate]" Operator="-" Msisdn="" id="loop_day_increment_endDate" saveValue="True" Information="" class="Arithmetic"/>
         <SA Input2="[loop_day_increment_ResetDate]" Input1="[loop_day_increment_endDate]" Operator="+" Msisdn="" id="loop_day_increment_newProd" saveValue="True" Information="" class="Arithmetic"/>
         <SA class="SyncDbSingleQuery" dataSource="dbsession" varPrefix="tcash_" requestor="[bonusMsisdn]">SELECT * FROM tcash_subscription WHERE msisdn = '[bonusMsisdn]' AND category='[product_sub_category]'</SA>
         <SA class="SyncIf" var="tcash_msisdn" compare="|null|NULL">
            <SA class="SyncAssignVariable" var="isFirstPurchase" value="1"/>
            <SA class="SyncAssignVariable" var="tcash_counter" value="1"/>
            <SA class="SyncAssignVariable" var="tcash_product_id" value="[product_product_id]"/>
            <SA class="DateUtility" id="new_tcash_end_date" saveValue="true" Option="add_date1" Param2="yyyy-MM-dd" Param6="[loop_day_increment_endDate]"/>
            <SA class="DateUtility" id="new_reset_date" saveValue="true" Option="add_date2" Param1="yyyy-MM-dd" Param2="yyyy-MM-dd" Param5="[new_tcash_end_date]" Param6="[loop_day_increment_ResetDate]"/>
            <!--<SA class="DateUtility" id="new_reset_date" saveValue="true" Option="add_date1" Param2="dd-MM-yyyy" Param6="[loop_day_increment_ResetDate]"/>-->
         </SA>
         <SA class="SyncIf" var="tcash_msisdn" compare="|null|NULL" negation="true">
            <SA class="SyncIf" var="tcash_product_id" compare="[product_product_id]">
               <SA class="DateUtility" id="dateToday" saveValue="true" Option="Today" Param2="yyyy-MM-dd"/>
               <SA id="isIncrementTcashLoop" class="DateUtility" Option="is_expired2" Param3="[tcash_end_date]" Param5="[dateToday]" saveValue="true"/>
               <SA class="SyncIf" var="isIncrementTcashLoop" compare="1" negation="true">
                  <SA class="SyncAssignVariable" var="isStay" value="1"/>
                  <SA class="DateUtility" id="new_tcash_end_date" saveValue="true" Option="add_date2" Param1="yyyy-MM-dd" Param2="yyyy-MM-dd" Param5="[tcash_end_date]" Param6="0"/>
               </SA>
               <SA class="SyncIf" var="isIncrementTcashLoop" compare="1">
                  <SA id="isResetTcashLoop" class="DateUtility" Option="is_expired3" Param5="[dateToday]" Param3="[tcash_end_date]" Param4="[tcash_reset_date]" saveValue="true"/>
                  <SA class="SyncIf" var="isResetTcashLoop" compare="1">
                     <SA class="SyncAssignVariable" var="isIncrementTcashLoop" value="0"/>
                     <SA class="SyncAssignVariable" var="tcash_counter" value="1"/>
                     <SA class="DateUtility" id="new_tcash_end_date" saveValue="true" Option="add_date1" Param2="yyyy-MM-dd" Param6="[loop_day_increment_endDate]"/>
                     <SA class="DateUtility" id="new_reset_date" saveValue="true" Option="add_date2" Param1="yyyy-MM-dd" Param2="yyyy-MM-dd" Param5="[new_tcash_end_date]" Param6="[loop_day_increment_ResetDate]"/>
                     <!--<SA class="DateUtility" id="new_reset_date" saveValue="true" Option="add_date1" Param2="dd-MM-yyyy" Param6="[loop_day_increment_ResetDate]"/>-->
                  </SA>
                  <SA class="SyncIf" var="isResetTcashLoop" compare="1" negation="true">
                     <SA Input2="1" Input1="[tcash_counter]" Operator="+" Msisdn="" id="tcash_counter" saveValue="True" Information="" class="Arithmetic"/>
                     <SA class="SyncAssignVariable" var="new_tcash_end_date" value="[tcash_reset_date]"/>
                     <SA class="DateUtility" id="new_reset_date" saveValue="true" Option="add_date2" Param1="yyyy-MM-dd" Param2="yyyy-MM-dd" Param5="[new_tcash_end_date]" Param6="[loop_day_increment_ResetDate]"/>
                  </SA>
               </SA>
            </SA>
            <SA class="SyncIf" var="tcash_product_id" compare="[product_product_id]" negation="true">
               <SA class="SyncAssignVariable" var="tcash_counter" value="1"/>
               <SA class="SyncAssignVariable" var="tcash_loop_isChangeProd" value="1"/>
               <SA class="DateUtility" id="new_tcash_end_date" saveValue="true" Option="add_date1" Param2="yyyy-MM-dd" Param6="[loop_day_increment_endDate]"/>
               <SA class="DateUtility" id="new_reset_date" saveValue="true" Option="add_date1" Param2="yyyy-MM-dd" Param6="[loop_day_increment_newProd]"/>
               <!--KALAU BEDA product id,
					counter jadi 1,
					end_date berubah,
					reset date berubah
					kasih flag ganti product-->
            </SA>
         </SA>
         <SA class="SyncAssignVariable" var="tcashloop_product_plan" value="{dbconfig:fsd.tcashloop.[product_product_id].nominal}"/>
         <SA class="SyncIf" var="tcashloop_product_plan" compare="|null|NULL" negation="true">
            <SA class="DateUtility" id="tcash_trx_date" saveValue="true" Option="Today" Param2="yyyyMMddHHmmss"/>
            <SA class="SyncStringUtility" var="lengthtxid" type="strlength" param1="[txid]"/>
            <SA id="lengthMulai" class="Arithmetic" Input1="[lengthtxid]" Input2="7" Operator="-" Msisdn="" saveValue="True"/>
            <SA id="SubstringMessage" class="SyncSubstring" var="tcash_sequence" input="[txid]" start="[lengthMulai]" stop="[lengthtxid]"/>
            <!--<SA class="SyncAssignVariable" var="tcashloop_parameter" value="[tcash_trx_date],[tcash_sequence],[product_sub_category]" />-->
            <SA class="SyncExplode" var="t" input="[tcashloop_product_plan]" separator=","/>
            <SA Input2="1" Input1="[t.size]" Operator="-" Msisdn="" id="t.size" saveValue="True" Information="" class="Arithmetic"/>
            <SA id="maxIndexNominal" class="SyncAssertExpression" var="tcash_counter" operator=">" value="[t.size]" saveValue="true"/>
            <SA class="SyncIf" var="maxIndexNominal" compare="1" negation="true">
               <SA class="SyncAssignVariable" var="nominalTemp" value="[t.[tcash_counter]]"/>
               <SA class="SyncIf" var="nominalTemp" compare="|null|NULL" negation="true">
                  <SA class="SyncAssignVariable" var="nominalTcash" value="[nominalTemp]"/>
               </SA>
            </SA>
            <SA class="SyncIf" var="maxIndexNominal" compare="1">
               <SA class="SyncAssignVariable" var="nominalTcash" value=""/>
            </SA>
            <SA class="SyncIf" var="nominalTcash" compare="|null|NULL|0" negation="true">
               <SA class="SyncAssignVariable" var="injectBonus" value="false"/>
               <SA id="checkPairingTcash" class="SyncHttpGet" timeout="15000" saveValue="true" assertValue="">{dbconfig:tcashloopnew.checkpairing.url}</SA>
               <!--{"status":"success","tcash":"true","nfc":"true","twallet":"true"}-->
               <SA class="JsonParse" var="pairing" input="[checkPairingTcash]"/>
               <SA class="SyncAssignVariable" var="injectBonus" value="[pairing.nfc]"/>
               <!--BELUM PAIRING-->
               <SA class="SyncIf" var="injectBonus" compare="true" negation="true">
                  <SA class="SyncAssignVariable" var="injectBonus" value="[pairing.twallet]"/>
               </SA>
               <!--JIKA TRUE, INJECT BONUS-->
               <SA class="SyncIf" var="injectBonus" compare="true">
                  <SA class="SyncAssignVariable" var="MFS" value="{dbconfig:tcash.isMigrateMFS}"/>
                  <SA class="SyncIf" var="MFS" compare="TRUE">
                     <SA class="SyncAssignVariable" var="keyEncrypt" value="{dbconfig:tcashloop.encrypt.key}"/>
                     <SA class="SyncAssignVariable" var="IvEncrypt" value="{dbconfig:tcashloop.encrypt.iv}"/>
                     <SA class="SyncAssignVariable" var="merchant" value="{dbconfig:tcashloop.merchant.mfs}"/>
                     <SA class="SyncAssignVariable" var="promo" value="{dbconfig:tcashloop.promo}"/>
                     <SA class="SyncExplode" var="l" input="[merchant]" separator=";"/>
                     <SA class="SyncAssignVariable" var="login" value="[l.0]"/>
                     <SA class="SyncAssignVariable" var="pwdMerchant" value="[l.1]"/>
                     <SA class="SyncCrypto" id="tcash_trx_dateE" Mode="e" Algo="AES128withIV" Key="[keyEncrypt]" Input="[tcash_trx_date]" Iv="[IvEncrypt]"/>
                     <SA class="SyncCrypto" id="trx_typeE" Mode="e" Algo="AES128withIV" Key="[keyEncrypt]" Input="011" Iv="[IvEncrypt]"/>
                     <SA class="SyncCrypto" id="terminalE" Mode="e" Algo="AES128withIV" Key="[keyEncrypt]" Input="[product_sub_category]" Iv="[IvEncrypt]"/>
                     <SA class="SyncCrypto" id="tcash_sequenceE" Mode="e" Algo="AES128withIV" Key="[keyEncrypt]" Input="[tcash_sequence]" Iv="[IvEncrypt]"/>
                     <SA class="SyncCrypto" id="pwdMerchantE" Mode="e" Algo="AES128withIV" Key="[keyEncrypt]" Input="[pwdMerchant]" Iv="[IvEncrypt]"/>
                     <SA class="SyncCrypto" id="bonusMsisdnE" Mode="e" Algo="AES128withIV" Key="[keyEncrypt]" Input="[bonusMsisdn]" Iv="[IvEncrypt]"/>
                     <SA class="SyncCrypto" id="nominalTcashE" Mode="e" Algo="AES128withIV" Key="[keyEncrypt]" Input="[nominalTcash]" Iv="[IvEncrypt]"/>
                     <SA class="SyncCrypto" id="promoE" Mode="e" Algo="AES128withIV" Key="[keyEncrypt]" Input="[promo]" Iv="[IvEncrypt]"/>
                     <!--https://10.49.41.3:30021/payment/HttpService/H2Hform?terminal=[terminalE]&customer=[bonusMsisdnE]&pwd=[pwdMerchantE]&promo=[promoE]&trx_type=[trx_typeE]&login=[login]&sequence_id=[tcash_sequenceE]&trx_date=[tcash_trx_dateE]&tx_amount=[nominalTcashE]-->
                  </SA>
                  <SA id="injectTcash" class="SyncHttpGet" timeout="30000" saveValue="true" assertValue="">{dbconfig:tcashloop.injecttcash.url}</SA>
                  <SA id="ExplodeChunk" class="SyncExplode" separator="\:" var="bonustcash" input="[injectTcash]"/>
                  <SA class="SyncIf" var="bonustcash.0" compare="00" negation="true">
                     <!--INSERT KE TCASH Pending-->
                     <SA class="SyncSendSms" sender="{dbconfig:fsd.bonus.bnumber}" to="[bonusMsisdn]" message="{dbconfig:fsd.tcashloop.inject.failed.notif}"/>
                     <SA class="SyncDbUpdate" dataSource="dbsession" requestor="[bonusMsisdn]">INSERT INTO tcash_pending (msisdn, pairing, nominal, reg_date, latest_claim_date, status_code, type) 
								VALUES ('[bonusMsisdn]', 'YES', '[nominalTcash]', '[dateToday]',ADDDATE(CURDATE(), INTERVAL [loop_day_increment_endDate] DAY), '[injectTcash];[tcash_trx_date];[tcash_sequence]', '[product_sub_category]')</SA>
                  </SA>
                  <SA class="SyncIf" var="isStay" compare="1" negation="true">
                     <SA class="SyncIf" var="isStay" compare="1" negation="true">
                        <SA class="SyncIf" var="tcash_loop_isChangeProd" compare="1">
                           <SA class="SyncDbUpdate" dataSource="dbsession" requestor="[bonusMsisdn]">INSERT INTO tcash_subscription (msisdn, category, product_id, counter, end_date, reset_date) 
										VALUES ('[bonusMsisdn]','[product_sub_category]', '[product_product_id]', '[tcash_counter]', '[new_tcash_end_date]', '[new_reset_date]')
										ON DUPLICATE KEY UPDATE product_id='[product_product_id]', counter = '[tcash_counter]', end_date = '[new_tcash_end_date]', reset_date = '[new_reset_date]'</SA>
                        </SA>
                        <SA class="SyncIf" var="tcash_loop_isChangeProd" compare="1" negation="true">
                           <SA class="SyncDbUpdate" dataSource="dbsession" requestor="[bonusMsisdn]">INSERT INTO tcash_subscription (msisdn, category, product_id, counter, end_date, reset_date) 
										VALUES ('[bonusMsisdn]', '[product_sub_category]','[tcash_product_id]', '[tcash_counter]', '[new_tcash_end_date]', '[new_reset_date]')
										ON DUPLICATE KEY UPDATE counter = '[tcash_counter]', end_date = '[new_tcash_end_date]', reset_date = '[new_reset_date]'</SA>
                        </SA>
                     </SA>
                  </SA>
               </SA>
               <!--JIKA FALSE, INSERT PENDING ACTION-->
               <SA class="SyncIf" var="injectBonus" compare="true" negation="true">
                  <SA class="SyncSendSms" sender="{dbconfig:fsd.bonus.bnumber}" to="[bonusMsisdn]" message="{dbconfig:fsd.tcashloop.inject.failed.notif}"/>
                  <SA class="SyncDbUpdate" dataSource="dbsession" requestor="[bonusMsisdn]">INSERT INTO tcash_pending (msisdn, pairing, nominal, reg_date,latest_claim_date, status_code,type) 
							VALUES ('[bonusMsisdn]', 'NO', '[nominalTcash]', '[dateToday]',ADDDATE(CURDATE(), INTERVAL [loop_day_increment_endDate] DAY),'[checkPairingTcash];[tcash_trx_date];[tcash_sequence]', '[product_sub_category]')</SA>
                  <SA class="SyncIf" var="isStay" compare="1" negation="true">
                     <SA class="SyncIf" var="isStay" compare="1" negation="true">
                        <SA class="SyncIf" var="tcash_loop_isChangeProd" compare="1">
                           <SA class="SyncDbUpdate" dataSource="dbsession" requestor="[bonusMsisdn]">INSERT INTO tcash_subscription (msisdn, category,product_id, counter, end_date, reset_date) 
										VALUES ('[bonusMsisdn]','[product_sub_category]','[product_product_id]', '[tcash_counter]', '[new_tcash_end_date]', '[new_reset_date]')
										ON DUPLICATE KEY UPDATE product_id='[product_product_id]', counter = '[tcash_counter]', end_date = '[new_tcash_end_date]', reset_date = '[new_reset_date]'</SA>
                        </SA>
                        <SA class="SyncIf" var="tcash_loop_isChangeProd" compare="1" negation="true">
                           <SA class="SyncDbUpdate" dataSource="dbsession" requestor="[bonusMsisdn]">INSERT INTO tcash_subscription (msisdn, category, product_id, counter, end_date, reset_date) 
										VALUES ('[bonusMsisdn]','[product_sub_category]','[tcash_product_id]', '[tcash_counter]', '[new_tcash_end_date]', '[new_reset_date]')
										ON DUPLICATE KEY UPDATE counter = '[tcash_counter]', end_date = '[new_tcash_end_date]', reset_date = '[new_reset_date]'</SA>
                        </SA>
                     </SA>
                  </SA>
               </SA>
            </SA>
         </SA>
      </SA>
      <SA class="SyncIf" var="command" compare="|null|NULL" negation="true">
         <SA class="SyncIf" var="command" compare="MKIOS" negation="true">
            <SA class="SyncDbUpdate" dataSource="dbsession" requestor="[rewardMsisdn]">INSERT INTO mgm_point (msisdn, point) VALUES ('[rewardMsisdn]', '[_point]') ON DUPLICATE KEY UPDATE point=point+'[_point]'</SA>
            <SA class="SyncDbSingleQuery" dataSource="dbsession" varPrefix="total_" requestor="[rewardMsisdn]">SELECT point FROM mgm_point WHERE msisdn='[rewardMsisdn]'</SA>
            <SA class="SyncIf" var="total_point" compare="null">
               <SA class="SyncAssignVariable" var="total_point" value="0"/>
            </SA>
         </SA>
         <SA class="SyncAssignVariable" var="errCode||detailz||desc" value="OK00||success||00"/>
         <SA class="SyncSwitch" input="command">
            <case code="GIFT">
               <!--Send SMS to bonusMSISDN-->
               <SA class="SyncSwitch" input="dontExtend">
                  <case code="1">
                     <SA class="SyncAssignVariable" var="generic_wording" value="{dbconfig:fsd.notif.[product_category].[_subscriptionType].dontExtend.[notifCommand]success}"/>
                     <SA class="SyncAssignVariable" var="SMS_MGM" value="[generic_wording] [IGI_GiMoGeMo_NotifSuccess]"/>
                     <SA class="SyncIf" var="product_wording_success" compare="|null|NULL" negation="true">
                        <SA class="SyncAssignVariable" var="SMS_MGM" value="[product_wording_success] [IGI_GiMoGeMo_NotifSuccess]"/>
                     </SA>
                     <SA class="SyncSendSms" sender="{dbconfig:fsd.bonus.bnumber}" to="[bonusMsisdn]" message="[SMS_MGM]"/>
                  </case>
                  <case code="default">
                     <SA class="SyncAssignVariable" var="generic_wording" value="{dbconfig:fsd.notif.[product_category].[_subscriptionType].[notifCommand]success}"/>
                     <SA class="SyncAssignVariable" var="SMS_MGM" value="[generic_wording]"/>
                     <SA class="SyncIf" var="product_wording_success" compare="|null|NULL" negation="true">
                        <SA class="SyncAssignVariable" var="SMS_MGM" value="[product_wording_success]"/>
                     </SA>
                     <SA class="SyncSendSms" sender="{dbconfig:fsd.bonus.bnumber}" to="[bonusMsisdn]" message="[SMS_MGM]"/>
                  </case>
               </SA>
               <SA class="SyncSwitch" input="isAgent">
                  <case code="TRUE">
                     <!--send 2ndCharge request-->
                     <SA class="SyncAssignVariable" var="allow2ndChargeAgent" value="{dbconfig:fsd.allow.2ndCharge.forAgent}"/>
                     <SA class="SyncIf" var="allow2ndChargeAgent" compare="TRUE">
                        <SA id="2nd-Charge" class="HitFrontend" adn="{dbconfig:fsd.bonus.bnumber}" msg="2ndCharge FSD-AGENT [txid] 0" msisdn="[msisdn]"/>
                        <SA id="ExplodeChunk" class="SyncExplode" separator="\s+" var="2ndCharge" input="[2nd-Charge]"/>
                        <SA class="SyncIf" var="2ndCharge.0" compare="Accepted" negation="true">
                           <SA id="2nd-Charge" class="HitFrontend" adn="{dbconfig:fsd.bonus.bnumber}" msg="2ndCharge FSD-AGENT [txid] 0" msisdn="[msisdn]"/>
                           <SA id="ExplodeChunk" class="SyncExplode" separator="\s+" var="2ndCharge" input="[2nd-Charge]"/>
                           <SA class="SyncIf" var="2ndCharge.0" compare="Accepted" negation="true">
                              <SA class="SyncAssignVariable" var="desc" value="failed send request 2ndCharge"/>
                           </SA>
                        </SA>
                     </SA>
                  </case>
                  <case code="default">
                     <!--send 2ndCharge request-->
                     <SA class="SyncAssignVariable" var="allow2ndCharge" value="{dbconfig:mgm.allow.2ndCharge}"/>
                     <SA class="SyncIf" var="allow2ndCharge" compare="TRUE">
                        <SA id="2nd-Charge" class="HitFrontend" adn="{dbconfig:fsd.bonus.bnumber}" msg="2ndCharge FSD [txid] 0" msisdn="[chargeMsisdn]"/>
                        <SA id="ExplodeChunk" class="SyncExplode" separator="\s+" var="2ndCharge" input="[2nd-Charge]"/>
                        <SA class="SyncIf" var="2ndCharge.0" compare="Accepted" negation="true">
                           <SA id="2nd-Charge" class="HitFrontend" adn="{dbconfig:fsd.bonus.bnumber}" msg="2ndCharge FSD [txid] 0" msisdn="[chargeMsisdn]"/>
                           <SA id="ExplodeChunk" class="SyncExplode" separator="\s+" var="2ndCharge" input="[2nd-Charge]"/>
                           <SA class="SyncIf" var="2ndCharge.0" compare="Accepted" negation="true">
                              <SA class="SyncAssignVariable" var="desc" value="failed send request 2ndCharge"/>
                           </SA>
                        </SA>
                     </SA>
                  </case>
               </SA>
               <!--SMS tambahan-->
               <SA class="SyncAssignVariable" var="SMS" value="{dbconfig:fsd.notif.[product_category].[notifCommand]success} [IGI_GiMoGeMo_NotifSuccess]"/>
               <SA class="SyncIf" var="isFlu" compare="1">
                  <SA class="SyncAssignVariable" var="SMS" value="NOSMS"/>
               </SA>
               <SA class="SyncTempRequest" service="FSD" option="remove"/>
               <SA class="SyncBreak"/>
            </case>
            <case code="HELP">
               <!--Send SMS to rewardNumber-->
               <SA class="SyncAssignVariable" var="SMS_MGM" value="{dbconfig:fsd.notif.[product_category].[notifCommand]success}"/>
               <SA class="SyncSendSms" sender="{dbconfig:fsd.bonus.bnumber}" to="[rewardMsisdn]" message="[SMS_MGM]"/>
               <SA class="SyncSwitch" input="dontExtend">
                  <case code="1">
                     <SA class="SyncAssignVariable" var="generic_wording" value="{dbconfig:fsd.notif.[product_category].[_subscriptionType].dontExtend.[notifCommand]success}"/>
                     <SA class="SyncAssignVariable" var="SMS" value="[generic_wording]"/>
                     <SA class="SyncIf" var="product_wording_success" compare="|null|NULL" negation="true">
                        <SA class="SyncAssignVariable" var="SMS" value="[product_wording_success]"/>
                     </SA>
                  </case>
                  <case code="default">
                     <SA class="SyncAssignVariable" var="generic_wording" value="{dbconfig:fsd.notif.[product_category].[_subscriptionType].[notifCommand]success}"/>
                     <SA class="SyncAssignVariable" var="SMS" value="[generic_wording]"/>
                     <SA class="SyncIf" var="product_wording_success" compare="|null|NULL" negation="true">
                        <SA class="SyncAssignVariable" var="SMS" value="[product_wording_success]"/>
                     </SA>
                  </case>
               </SA>
               <SA class="SyncIf" var="isFlu" compare="1">
                  <SA class="SyncAssignVariable" var="SMS" value="NOSMS"/>
               </SA>
               <SA class="SyncTempRequest" service="FSD" option="remove"/>
               <SA class="SyncBreak"/>
            </case>
            <case code="MKIOS">
               <!--Send SMS to bonusMSISDN-->
               <SA class="SyncSwitch" input="dontExtend">
                  <case code="1">
                     <SA class="SyncAssignVariable" var="generic_wording" value="{dbconfig:fsd.notif.[product_category].[_subscriptionType].dontExtend.[notifCommand]success}"/>
                     <SA class="SyncAssignVariable" var="SMS_MGM" value="[generic_wording]"/>
                     <SA class="SyncIf" var="product_wording_success" compare="|null|NULL" negation="true">
                        <SA class="SyncAssignVariable" var="SMS_MGM" value="[product_wording_success]"/>
                     </SA>
                     <SA class="SyncSendSms" sender="{dbconfig:fsd.bonus.bnumber}" to="[bonusMsisdn]" message="[SMS_MGM]"/>
                  </case>
                  <case code="default">
                     <SA class="SyncAssignVariable" var="generic_wording" value="{dbconfig:fsd.notif.[product_category].[_subscriptionType].[notifCommand]success}"/>
                     <SA class="SyncAssignVariable" var="SMS_MGM" value="[generic_wording]"/>
                     <SA class="SyncIf" var="product_wording_success" compare="|null|NULL" negation="true">
                        <SA class="SyncAssignVariable" var="SMS_MGM" value="[product_wording_success]"/>
                     </SA>
                     <SA class="SyncSendSms" sender="{dbconfig:fsd.bonus.bnumber}" to="[bonusMsisdn]" message="[SMS_MGM]"/>
                  </case>
               </SA>
               <!--SMS tambahan-->
               <SA class="SyncAssignVariable" var="SMS" value="{dbconfig:fsd.notif.[product_category].[notifCommand]success}"/>
               <SA class="SyncIf" var="isFlu" compare="1">
                  <SA class="SyncAssignVariable" var="SMS" value="NOSMS"/>
               </SA>
               <SA class="SyncTempRequest" service="FSD" option="remove"/>
               <SA class="SyncBreak"/>
            </case>
            <case code="ASK">
               <!--Update counter-->
               <SA class="SyncDbUpdate" dataSource="dbsession" requestor="[bonusMsisdn]">INSERT INTO flash_addict_member (msisdn, donatur ,start_date, status, counter, trx_date) 
						VALUES ('[bonusMsisdn]', '[msisdn]', CURDATE(), 'temp', '1' , CURDATE())
						ON DUPLICATE KEY UPDATE counter = counter+1, trx_date = CURDATE()</SA>
               <!--Send SMS to rewardNumber-->
               <SA class="SyncAssignVariable" var="SMS_MGM" value="{dbconfig:fsd.notif.[product_category].[notifCommand]success}"/>
               <SA class="SyncSendSms" sender="{dbconfig:fsd.bonus.bnumber}" to="[bonusMsisdn]" message="[SMS_MGM]"/>
               <SA class="SyncSwitch" input="dontExtend">
                  <case code="1">
                     <SA class="SyncAssignVariable" var="generic_wording" value="{dbconfig:fsd.notif.[product_category].[_subscriptionType].dontExtend.[notifCommand]success}"/>
                     <SA class="SyncAssignVariable" var="SMS" value="[generic_wording]"/>
                     <SA class="SyncIf" var="product_wording_success" compare="|null|NULL" negation="true">
                        <SA class="SyncAssignVariable" var="SMS" value="[product_wording_success]"/>
                     </SA>
                  </case>
                  <case code="default">
                     <SA class="SyncAssignVariable" var="generic_wording" value="{dbconfig:fsd.notif.[product_category].[_subscriptionType].[notifCommand]success}"/>
                     <SA class="SyncAssignVariable" var="SMS" value="[generic_wording]"/>
                     <SA class="SyncIf" var="product_wording_success" compare="|null|NULL" negation="true">
                        <SA class="SyncAssignVariable" var="SMS" value="[product_wording_success]"/>
                     </SA>
                  </case>
               </SA>
               <SA class="SyncIf" var="isFlu" compare="1">
                  <SA class="SyncAssignVariable" var="SMS" value="NOSMS"/>
               </SA>
               <SA class="SyncTempRequest" service="FSD" option="remove"/>
               <SA class="SyncBreak"/>
            </case>
         </SA>
      </SA>
      <SA class="SyncSwitch" input="dontExtend">
         <case code="1">
            <SA class="SyncAssignVariable" var="generic_wording" value="{dbconfig:fsd.notif.[product_category].[_subscriptionType].dontExtend.success}"/>
            <SA class="SyncAssignVariable" var="SMS" value="[generic_wording]"/>
            <SA class="SyncIf" var="product_wording_success" compare="|null|NULL" negation="true">
               <SA class="SyncAssignVariable" var="SMS" value="[product_wording_success]"/>
            </SA>
            <SA class="SyncAssignVariable" var="errCode||detailz||desc" value="OK00||S01|| "/>
         </case>
         <case code="default">
            <SA class="SyncAssignVariable" var="generic_wording" value="{dbconfig:fsd.notif.[product_category].[_subscriptionType].success}"/>
            <SA class="SyncAssignVariable" var="SMS" value="[generic_wording]"/>
            <SA class="SyncIf" var="product_wording_success" compare="|null|NULL" negation="true">
               <SA class="SyncAssignVariable" var="SMS" value="[product_wording_success]"/>
            </SA>
            <SA class="SyncAssignVariable" var="errCode||detailz||desc" value="OK00||S01|| "/>
         </case>
      </SA>
      <!--Finalize-->
      <SA class="SyncTempRequest" service="FSD" option="remove"/>
   </Actions>
</ReflexService>